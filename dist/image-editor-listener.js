import{h as p,s as g}from"./xhrStatus.js";document.addEventListener("onImageSave",o=>{f(o.detail)});document.addEventListener("onCanvasStatusMessage",o=>{console.log("onCanvasStatusMessage:",o.detail)});document.addEventListener("onCloseImageEditor",o=>{const n=o.detail.imageEditorInstance,d=n.closest("[data-image-editor-modal]"),e=n.getAttribute("data-initiator-id");document.querySelector("#"+e).dispatchEvent(new CustomEvent("imageEditorModalCloseRequest",{bubbles:!0,composed:!0,detail:{modal:d}}))});const f=o=>{const n=o.imageEditorInstance.closest("[data-image-editor-modal]"),d=n.querySelector(".image-editor-modal-config");if(!d)return;let e={};try{e=JSON.parse(d.value)}catch{console.error("Invalid JSON config")}const l=e.useXhr;if(console.log("config",e),!l){const a=o.file,i=n.querySelector("[data-image-editor-update-form]");let c=i.querySelector('input[type="file"][name="file"]');if(!c)return;const m=new DataTransfer;m.items.add(a),c.files=m.files,i.submit();return}console.log("a");const s=document.querySelector("#"+e.initiatorId);console.log("initiator",s);const r=s.querySelector(".media-manager-row");console.log("container",r),console.log("b"),console.log("collections",e.collections);const u=o.file,t=new FormData;t.append("initiator_id",e.initiatorId),t.append("media_manager_id",e.mediaManagerId??""),t.append("model_type",e.modelType),t.append("model_id",e.modelId??""),t.append("medium_id",e.mediumId),t.append("options",JSON.stringify(e.options)),t.append("collection",e.collection),t.append("temporary_upload_mode",e.temporaryUploadMode),t.append("file",u),Object.entries(e.collections).forEach(([a,i])=>{t.append(`collections[${a}]`,i)}),console.log("c"),console.log("d"),fetch(e.saveUpdatedMediumRoute,{method:"POST",headers:{"X-CSRF-TOKEN":e.csrfToken,Accept:"application/json"},body:t}).then(async a=>{const i=await a.json();if(!a.ok)throw p(a,i,r),new Error("Upload failed");return i}).then(a=>{g(r,{type:"success",message:E("medium_replaced")}),s.dispatchEvent(new CustomEvent("imageEditorModalCloseRequest",{bubbles:!0,composed:!0,detail:{modal:n}})),s.dispatchEvent(new CustomEvent("refreshRequest",{bubbles:!0,composed:!0,detail:[]}))})};function E(o){var n;return((n=window.mediaLibraryTranslations)==null?void 0:n[o])||o}
