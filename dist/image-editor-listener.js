import{h as _,s as g}from"./xhrStatus.js";document.addEventListener("onImageSave",e=>{console.log("onImageSave:",e.detail,e),f(e.detail)});document.addEventListener("onCanvasStatusMessage",e=>{console.log("onCanvasStatusMessage:",e.detail)});document.addEventListener("onCloseImageEditor",e=>{const a=e.detail.imageEditorInstance.closest("[data-image-editor-modal]");s(a)});const s=e=>{if(typeof bootstrap>"u"||!bootstrap.Modal){console.warn("Bootstrap Modal is not available.");return}bootstrap.Modal.getInstance(e).hide()},f=e=>{const a=e.imageEditorInstance.closest("[data-image-editor-modal]"),r=a.getAttribute("data-theme"),d=a.querySelector(".image-editor-modal-config");if(!d)return;let o={};try{o=JSON.parse(d.value)}catch{console.error("Invalid JSON config")}const i=document.querySelector("#"+o.initiator_id),l=i.querySelector(".media-manager-row"),{model_type:h,model_id:v,medium_id:b,collection:I,csrf_token:m,save_updated_medium_route:p,temporary_upload:S}=o,u=e.file,t=new FormData;t.append("initiator_id",o.initiator_id),t.append("model_type",o.model_type),t.append("model_id",o.model_id??""),t.append("medium_id",o.medium_id),t.append("collection",o.collection),t.append("image_collection",o.image_collection),t.append("document_collection",o.document_collection),t.append("youtube_collection",o.youtube_collection),t.append("temporary_upload",o.temporary_upload),t.append("file",u),fetch(p,{method:"POST",headers:{"X-CSRF-TOKEN":m,Accept:"application/json"},body:t}).then(async n=>{const c=await n.json();if(!n.ok)throw _(n,c,l),new Error("Upload failed");return c}).then(n=>{g(l,{type:"success",message:y("medium_replaced")}),i.dispatchEvent(new CustomEvent("refreshRequest",{bubbles:!0,composed:!0,detail:[]}))}).finally(()=>{r==="bootstrap-5"&&s(a)})};function y(e){var a;return((a=window.mediaLibraryTranslations)==null?void 0:a[e])||e}
