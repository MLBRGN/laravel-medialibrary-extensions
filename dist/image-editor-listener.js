import{h as u,s as p}from"./xhrStatus.js";document.addEventListener("onImageSave",t=>{_(t.detail)});document.addEventListener("onCanvasStatusMessage",t=>{console.log("onCanvasStatusMessage:",t.detail)});document.addEventListener("onCloseImageEditor",t=>{const a=t.detail.imageEditorInstance,d=a.closest("[data-image-editor-modal]"),e=a.getAttribute("data-initiator-id");document.querySelector("#"+e).dispatchEvent(new CustomEvent("imageEditorModalCloseRequest",{bubbles:!0,composed:!0,detail:{modal:d}}))});const _=t=>{const a=t.imageEditorInstance.closest("[data-image-editor-modal]"),d=a.querySelector(".image-editor-modal-config");if(!d)return;let e={};try{e=JSON.parse(d.value)}catch{console.error("Invalid JSON config")}const n=document.querySelector("#"+e.initiator_id),r=n.querySelector(".media-manager-row"),{model_type:y,model_id:E,medium_id:f,collection:v,csrf_token:l,save_updated_medium_route:s,temporary_upload:b}=e,m=t.file,o=new FormData;o.append("initiator_id",e.initiator_id),o.append("model_type",e.model_type),o.append("model_id",e.model_id??""),o.append("medium_id",e.medium_id),o.append("collection",e.collection),o.append("image_collection",e.image_collection),o.append("document_collection",e.document_collection),o.append("youtube_collection",e.youtube_collection),o.append("temporary_upload",e.temporary_upload),o.append("file",m),fetch(s,{method:"POST",headers:{"X-CSRF-TOKEN":l,Accept:"application/json"},body:o}).then(async i=>{const c=await i.json();if(!i.ok)throw u(i,c,r),new Error("Upload failed");return c}).then(i=>{p(r,{type:"success",message:g("medium_replaced")}),n.dispatchEvent(new CustomEvent("imageEditorModalCloseRequest",{bubbles:!0,composed:!0,detail:{modal:a}})),n.dispatchEvent(new CustomEvent("refreshRequest",{bubbles:!0,composed:!0,detail:[]}))})};function g(t){var a;return((a=window.mediaLibraryTranslations)==null?void 0:a[t])||t}
