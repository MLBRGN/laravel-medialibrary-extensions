import{s as l}from"./xhrStatus.js";document.addEventListener("onImageSave",e=>{console.log("onImageSave:",e.detail,e),f(e.detail)});document.addEventListener("onCanvasStatusMessage",e=>{console.log("onCanvasStatusMessage:",e.detail)});document.addEventListener("onCloseImageEditor",e=>{const o=e.detail.imageEditorInstance.closest("[data-image-editor-modal]");m(o)});const m=e=>{if(typeof bootstrap>"u"||!bootstrap.Modal){console.warn("Bootstrap Modal is not available.");return}bootstrap.Modal.getInstance(e).hide()},f=e=>{const o=e.imageEditorInstance.closest("[data-image-editor-modal]");console.log("modal",o);const a=o.getAttribute("data-theme"),s=o.querySelector(".image-editor-modal-config");if(!s)return;let t={};try{t=JSON.parse(s.value)}catch{console.error("Invalid JSON config")}const c=document.querySelector("#"+t.initiator_id);console.log("initiator",c);const{model_type:b,model_id:y,medium_id:h,collection:v,csrf_token:u,save_updated_medium_route:p,temporary_upload:S}=t,_=e.file,n=new FormData;n.append("initiator_id",t.initiator_id),n.append("model_type",t.model_type),n.append("model_id",t.model_id??""),n.append("medium_id",t.medium_id),n.append("collection",t.collection),n.append("image_collection",t.image_collection),n.append("document_collection",t.document_collection),n.append("youtube_collection",t.youtube_collection),n.append("temporary_upload",t.temporary_upload),n.append("file",_),fetch(p,{method:"POST",headers:{"X-CSRF-TOKEN":u,Accept:"application/json"},body:n}).then(async d=>{const i=await d.json();if(!d.ok){g(d,i);return}return i}).then(d=>{console.log("Upload successful:",d);const i=c.querySelector(".media-manager-row");l(i,{type:"success",message:r("medium_replaced")})}).catch(d=>{console.error("Upload failed:",d);const i=c.querySelector(".media-manager-row");l(i,{type:"error",message:r("medium_replacement_failed")})}).finally(()=>{a==="bootstrap-5"&&m(o),c.dispatchEvent(new CustomEvent("refreshRequest",{bubbles:!0,composed:!0,detail:[]}))})};function g(e,o){let a=r("upload_failed");switch(e.status){case 419:a=r("csrf_token_mismatch");break;case 401:a=r("unauthenticated");break;case 403:a=r("forbidden");break;case 404:a=r("not_found");break;case 422:if(o.errors){for(const s in o.errors)o.errors[s].forEach(t=>{});return}a=o.message||r("validation_failed");break;case 429:a=r("too_many_requests");break;case 500:case 503:a=r("server_error");break;default:a=o.message||a;break}console.log(a)}function r(e){var o;return((o=window.mediaLibraryTranslations)==null?void 0:o[e])||e}
