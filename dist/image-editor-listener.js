document.addEventListener("onImageSave",e=>{m(e.detail)});document.addEventListener("onCanvasStatusMessage",e=>{console.log("onCanvasStatusMessage",e.detail)});document.addEventListener("onCloseImageEditor",e=>{console.log("onCloseImageEditor",e.detail)});const m=e=>{const a=document.getElementById(e.id),t=a.querySelector(".image-editor-modal-config");if(!t)return;let o={};try{o=JSON.parse(t.value)}catch{console.error("Invalid JSON config")}const{model_type:c,model_id:_,medium_id:f,collection:g,csrf_token:l,save_updated_medium_route:s,temporary_upload:b}=o,u=e.file,n=new FormData;n.append("initiator_id",o.initiator_id),n.append("model_type",o.model_type),n.append("model_id",o.model_id??""),n.append("medium_id",o.medium_id),n.append("collection",o.collection),n.append("image_collection",o.image_collection),n.append("document_collection",o.document_collection),n.append("youtube_collection",o.youtube_collection),n.append("temporary_upload",o.temporary_upload),n.append("file",u),fetch(s,{method:"POST",headers:{"X-CSRF-TOKEN":l,Accept:"application/json"},body:n}).then(async d=>{const r=await d.json();if(!d.ok){p(d,r);return}return r}).then(d=>{console.log("Upload successful:",d)}).catch(d=>{console.error("Upload failed:",d)}).finally(()=>{a.dispatchEvent(new CustomEvent("onImageUpdated",{bubbles:!0,composed:!0,detail:e})),document.querySelector("#"+o.initiator_id).dispatchEvent(new CustomEvent("refreshRequest",{bubbles:!0,composed:!0,detail:[]}))})};function p(e,a){let t=i("upload_failed");switch(e.status){case 419:t=i("csrf_token_mismatch");break;case 401:t=i("unauthenticated");break;case 403:t=i("forbidden");break;case 404:t=i("not_found");break;case 422:if(a.errors){for(const o in a.errors)a.errors[o].forEach(c=>{});return}t=a.message||i("validation_failed");break;case 429:t=i("too_many_requests");break;case 500:case 503:t=i("server_error");break;default:t=a.message||t;break}console.log(t)}function i(e){var a;return((a=window.mediaLibraryTranslations)==null?void 0:a[e])||e}
