import{s as E,h as b,a as y,b as v}from"./xhrStatus.js";document.addEventListener("onImageSave",t=>{S(t.detail)});document.addEventListener("onCanvasStatusMessage",t=>{console.log("onCanvasStatusMessage:",t.detail)});document.addEventListener("onCloseImageEditor",t=>{const n=t.detail.imageEditorInstance,d=n.closest("[data-image-editor-modal]"),e=n.getAttribute("data-initiator-id");document.querySelector("#"+e).dispatchEvent(new CustomEvent("imageEditorModalCloseRequest",{bubbles:!0,composed:!0,detail:{modal:d}}))});const S=t=>{var u;const n=t.imageEditorInstance.closest("[data-image-editor-modal]"),d=n.querySelector("[data-image-editor-modal-config]");if(!d)return;let e={};try{e=JSON.parse(d.value),console.log(e)}catch{console.error("Invalid JSON config")}if(!e.useXhr){const a=t.file,i=n.querySelector("[data-image-editor-update-form]");let p=i.querySelector("[ data-image-editor-update-form-file]");if(!p)return;const f=new DataTransfer;f.items.add(a),p.files=f.files,i.submit();return}const r=document.querySelector("#"+e.initiatorId),s=r.querySelector("[data-status-area-container]");E(s);const I=t.file,o=new FormData,h=e.mediumId??null,l=e.modelType,m=e.modelId??"",c=e.initiatorId;o.append("initiator_id",c),o.append("media_manager_id",e.mediaManagerId??""),o.append("model_type",l),o.append("model_id",m),o.append("single_medium_id",((u=e.singleMedium)==null?void 0:u.id)??null),o.append("medium_id",h),o.append("options",JSON.stringify(e.options)),o.append("collection",e.collection),o.append("temporary_upload_mode",e.temporaryUploadMode),o.append("file",I),Object.entries(e.collections).forEach(([a,i])=>{o.append(`collections[${a}]`,i)}),fetch(e.saveUpdatedMediumRoute,{method:"POST",headers:{"X-CSRF-TOKEN":e.csrfToken,Accept:"application/json"},body:o}).then(async a=>{const i=await a.json();if(!a.ok)throw b(a,i,s),new Error("Update of medium failed");return i}).then(a=>{y(s,{type:"success",message:w("medium_replaced")}),r.dispatchEvent(new CustomEvent("imageEditorModalCloseRequest",{bubbles:!0,composed:!0,detail:{modal:n}})),r.dispatchEvent(new CustomEvent("refreshRequest",{bubbles:!0,composed:!0,detail:{singleMediumId:a.singleMediumId??null}}));const i=a.newMediumId;console.log("newMediumId",i),document.dispatchEvent(new CustomEvent("imageUpdated",{bubbles:!1,detail:{mediumId:i,modelType:l,modelId:m,initiatorId:c}}))}).finally(()=>{v(s)})};function w(t){var n;return((n=window.mediaLibraryTranslations)==null?void 0:n[t])||t}
