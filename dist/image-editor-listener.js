import{h as p,s as f}from"./xhrStatus.js";document.addEventListener("onImageSave",t=>{g(t.detail)});document.addEventListener("onCanvasStatusMessage",t=>{console.log("onCanvasStatusMessage:",t.detail)});document.addEventListener("onCloseImageEditor",t=>{const a=t.detail.imageEditorInstance,d=a.closest("[data-image-editor-modal]"),e=a.getAttribute("data-initiator-id");document.querySelector("#"+e).dispatchEvent(new CustomEvent("imageEditorModalCloseRequest",{bubbles:!0,composed:!0,detail:{modal:d}}))});const g=t=>{const a=t.imageEditorInstance.closest("[data-image-editor-modal]"),d=a.querySelector(".image-editor-modal-config");if(!d)return;let e={};try{e=JSON.parse(d.value)}catch{console.error("Invalid JSON config")}if(!e.useXhr){const n=t.file,i=a.querySelector("[data-image-editor-update-form]");let c=i.querySelector('input[type="file"][name="file"]');if(!c)return;const l=new DataTransfer;l.items.add(n),c.files=l.files,i.submit();return}const r=document.querySelector("#"+e.initiatorId),s=r.querySelector(".media-manager-row"),u=t.file,o=new FormData;o.append("initiator_id",e.initiatorId),o.append("media_manager_id",e.mediaManagerId??""),o.append("model_type",e.modelType),o.append("model_id",e.modelId??""),o.append("medium_id",e.mediumId),o.append("options",JSON.stringify(e.options)),o.append("collection",e.collection),o.append("temporary_upload_mode",e.temporaryUploadMode),o.append("file",u),Object.entries(e.collections).forEach(([n,i])=>{o.append(`collections[${n}]`,i)}),fetch(e.saveUpdatedMediumRoute,{method:"POST",headers:{"X-CSRF-TOKEN":e.csrfToken,Accept:"application/json"},body:o}).then(async n=>{const i=await n.json();if(!n.ok)throw p(n,i,s),new Error("Upload failed");return i}).then(n=>{f(s,{type:"success",message:E("medium_replaced")}),r.dispatchEvent(new CustomEvent("imageEditorModalCloseRequest",{bubbles:!0,composed:!0,detail:{modal:a}})),r.dispatchEvent(new CustomEvent("refreshRequest",{bubbles:!0,composed:!0,detail:[]}))})};function E(t){var a;return((a=window.mediaLibraryTranslations)==null?void 0:a[t])||t}
