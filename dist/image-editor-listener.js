import{s as v,h as S,a as M,b as w}from"./xhrStatus.js";document.addEventListener("onImageSave",t=>{C(t.detail)});document.addEventListener("onCanvasStatusMessage",t=>{console.log("onCanvasStatusMessage:",t.detail)});document.addEventListener("onCloseImageEditor",t=>{const i=t.detail.imageEditorInstance,s=i.closest("[data-image-editor-modal]"),e=i.getAttribute("data-initiator-id");document.querySelector("#"+e).dispatchEvent(new CustomEvent("imageEditorModalCloseRequest",{bubbles:!0,composed:!0,detail:{modal:s}}))});const C=t=>{var f;const i=t.imageEditorInstance.closest("[data-image-editor-modal]"),s=i.querySelector("[data-image-editor-modal-config]");if(!s)return;let e={};try{e=JSON.parse(s.value),console.log(e)}catch{console.error("Invalid JSON config")}if(!e.useXhr){const o=t.file,n=i.querySelector("[data-image-editor-update-form]");let I=n.querySelector("[ data-image-editor-update-form-file]");if(!I)return;const h=new DataTransfer;h.items.add(o),I.files=h.files,n.submit();return}const r=document.querySelector("#"+e.initiatorId),d=r.querySelector("[data-status-area-container]");let l=d,m=d;const c=d.closest("[data-media-manager-lab]");c&&(l=c.querySelector("[data-status-area-container]"),m=l,console.log("statusAreaContainer changed",d)),v(m);const b=t.file,a=new FormData,y=e.mediumId??null,u=e.modelType,p=e.modelId??"",g=e.initiatorId;a.append("initiator_id",g),a.append("media_manager_id",e.mediaManagerId??""),a.append("model_type",u),a.append("model_id",p),a.append("single_medium_id",((f=e.singleMedium)==null?void 0:f.id)??null),a.append("medium_id",y),a.append("options",JSON.stringify(e.options)),a.append("collection",e.collection),a.append("temporary_upload_mode",e.temporaryUploadMode),a.append("file",b),Object.entries(e.collections).forEach(([o,n])=>{a.append(`collections[${o}]`,n)}),fetch(e.saveUpdatedMediumRoute,{method:"POST",headers:{"X-CSRF-TOKEN":e.csrfToken,Accept:"application/json"},body:a,cache:"no-store"}).then(async o=>{const n=await o.json();if(!o.ok)throw S(o,n,d),new Error("Update of medium failed");return n}).then(o=>{M(l,{type:"success",message:q("medium_replaced")}),console.log("fire events imageEditorModalCloseRequest and refreshRequest and onImageUpdated"),r.dispatchEvent(new CustomEvent("imageEditorModalCloseRequest",{bubbles:!0,composed:!0,detail:{modal:i}})),r.dispatchEvent(new CustomEvent("refreshRequest",{bubbles:!0,composed:!0,detail:{singleMediumId:o.singleMediumId??null}}));const n=o.newMediumId;console.log("newMediumId",n),document.dispatchEvent(new CustomEvent("imageUpdated",{bubbles:!1,detail:{mediumId:n,modelType:u,modelId:p,initiatorId:g}}))}).finally(()=>{w(m)})};function q(t){var i;return((i=window.mediaLibraryTranslations)==null?void 0:i[t])||t}
