import{h as g,s as _}from"./xhrStatus.js";document.addEventListener("onImageSave",o=>{y(o.detail)});document.addEventListener("onCanvasStatusMessage",o=>{console.log("onCanvasStatusMessage:",o.detail)});document.addEventListener("onCloseImageEditor",o=>{const n=o.detail.imageEditorInstance,d=n.closest("[data-image-editor-modal]"),e=n.getAttribute("data-initiator-id");document.querySelector("#"+e).dispatchEvent(new CustomEvent("imageEditorModalCloseRequest",{bubbles:!0,composed:!0,detail:{modal:d}}))});const y=o=>{const n=o.imageEditorInstance.closest("[data-image-editor-modal]"),d=n.querySelector(".image-editor-modal-config");if(!d)return;let e={};try{e=JSON.parse(d.value)}catch{console.error("Invalid JSON config")}const r=e.use_xhr;if(console.log("useXhr",r),!r){const i=o.file,a=n.querySelector("[data-image-editor-update-form]");console.log("form",a);let s=a.querySelector('input[type="file"][name="file"]');if(console.log("fileInput",s),!s)return;console.log("test","test");const m=new DataTransfer;m.items.add(i),s.files=m.files,console.log("submit form",a),a.submit();return}const l=document.querySelector("#"+e.initiator_id);console.log("config",e),console.log("initiator",l);const c=l.querySelector(".media-manager-row"),{model_type:h,model_id:b,medium_id:v,collection:S,csrf_token:u,save_updated_medium_route:p,temporary_upload:w}=e,f=o.file,t=new FormData;t.append("initiator_id",e.initiator_id),t.append("model_type",e.model_type),t.append("model_id",e.model_id??""),t.append("medium_id",e.medium_id),t.append("collection",e.collection),t.append("image_collection",e.image_collection),t.append("document_collection",e.document_collection),t.append("youtube_collection",e.youtube_collection),t.append("temporary_upload",e.temporary_upload),t.append("file",f),fetch(p,{method:"POST",headers:{"X-CSRF-TOKEN":u,Accept:"application/json"},body:t}).then(async i=>{const a=await i.json();if(!i.ok)throw g(i,a,c),new Error("Upload failed");return a}).then(i=>{_(c,{type:"success",message:E("medium_replaced")}),l.dispatchEvent(new CustomEvent("imageEditorModalCloseRequest",{bubbles:!0,composed:!0,detail:{modal:n}})),l.dispatchEvent(new CustomEvent("refreshRequest",{bubbles:!0,composed:!0,detail:[]}))})};function E(o){var n;return((n=window.mediaLibraryTranslations)==null?void 0:n[o])||o}
