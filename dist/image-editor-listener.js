document.addEventListener("onImageSave",e=>{console.log("onImageSave:",e.detail,e),u(e.detail)});document.addEventListener("onCanvasStatusMessage",e=>{console.log("onCanvasStatusMessage:",e.detail)});document.addEventListener("onCloseImageEditor",e=>{console.log("onCloseImageEditor:",e.detail);const t=e.detail.imageEditorInstance.closest("[data-image-editor-modal]");bootstrap.Modal.getInstance(t).hide()});const u=e=>{console.log("updateMedia",e);const t=e.imageEditorInstance.closest("[data-image-editor-modal]"),o=t.querySelector("[data-image-editor-modal-config]");if(!o)return;let a={};try{a=JSON.parse(o.value)}catch{console.error("Invalid JSON config")}const{model_type:r,model_id:_,medium_id:f,collection:g,csrf_token:l,save_updated_medium_route:s,temporary_upload:b}=a,m=e.file,n=new FormData;n.append("initiator_id",a.initiator_id),n.append("model_type",a.model_type),n.append("model_id",a.model_id??""),n.append("medium_id",a.medium_id),n.append("collection",a.collection),n.append("image_collection",a.image_collection),n.append("document_collection",a.document_collection),n.append("youtube_collection",a.youtube_collection),n.append("temporary_upload",a.temporary_upload),n.append("file",m),fetch(s,{method:"POST",headers:{"X-CSRF-TOKEN":l,Accept:"application/json"},body:n}).then(async d=>{const c=await d.json();if(!d.ok){p(d,c);return}return c}).then(d=>{console.log("Upload successful:",d)}).catch(d=>{console.error("Upload failed:",d)}).finally(()=>{bootstrap.Modal.getInstance(t).hide(),document.querySelector("#"+a.initiator_id).dispatchEvent(new CustomEvent("refreshRequest",{bubbles:!0,composed:!0,detail:[]}))})};function p(e,t){let o=i("upload_failed");switch(e.status){case 419:o=i("csrf_token_mismatch");break;case 401:o=i("unauthenticated");break;case 403:o=i("forbidden");break;case 404:o=i("not_found");break;case 422:if(t.errors){for(const a in t.errors)t.errors[a].forEach(r=>{});return}o=t.message||i("validation_failed");break;case 429:o=i("too_many_requests");break;case 500:case 503:o=i("server_error");break;default:o=t.message||o;break}console.log(o)}function i(e){var t;return((t=window.mediaLibraryTranslations)==null?void 0:t[e])||e}
