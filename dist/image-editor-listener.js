import{s as f,h as g,a as h,b as E}from"./xhrStatus.js";document.addEventListener("onImageSave",t=>{S(t.detail)});document.addEventListener("onCanvasStatusMessage",t=>{console.log("onCanvasStatusMessage:",t.detail)});document.addEventListener("onCloseImageEditor",t=>{const n=t.detail.imageEditorInstance,s=n.closest("[data-image-editor-modal]"),e=n.getAttribute("data-initiator-id");document.querySelector("#"+e).dispatchEvent(new CustomEvent("imageEditorModalCloseRequest",{bubbles:!0,composed:!0,detail:{modal:s}}))});const S=t=>{var l;const n=t.imageEditorInstance.closest("[data-image-editor-modal]"),s=n.querySelector("[data-image-editor-modal-config]");if(!s)return;let e={};try{e=JSON.parse(s.value),console.log(e)}catch{console.error("Invalid JSON config")}if(!e.useXhr){const o=t.file,i=n.querySelector("[data-image-editor-update-form]");let c=i.querySelector("[ data-image-editor-update-form-file]");if(!c)return;const m=new DataTransfer;m.items.add(o),c.files=m.files,i.submit();return}const r=document.querySelector("#"+e.initiatorId),d=r.querySelector("[data-status-area-container]");console.log("statusAreaContainer",d),f(d);const p=t.file,a=new FormData;a.append("initiator_id",e.initiatorId),a.append("media_manager_id",e.mediaManagerId??""),a.append("model_type",e.modelType),a.append("model_id",e.modelId??""),a.append("single_medium_id",((l=e.singleMedium)==null?void 0:l.id)??null),a.append("medium_id",e.mediumId??null),a.append("options",JSON.stringify(e.options)),a.append("collection",e.collection),a.append("temporary_upload_mode",e.temporaryUploadMode),a.append("file",p),Object.entries(e.collections).forEach(([o,i])=>{a.append(`collections[${o}]`,i)}),fetch(e.saveUpdatedMediumRoute,{method:"POST",headers:{"X-CSRF-TOKEN":e.csrfToken,Accept:"application/json"},body:a}).then(async o=>{const i=await o.json();if(!o.ok)throw g(o,i,d),new Error("Update of medium failed");return i}).then(o=>{h(d,{type:"success",message:y("medium_replaced")}),r.dispatchEvent(new CustomEvent("imageEditorModalCloseRequest",{bubbles:!0,composed:!0,detail:{modal:n}})),r.dispatchEvent(new CustomEvent("refreshRequest",{bubbles:!0,composed:!0,detail:{singleMediumId:o.singleMediumId??null}}))}).finally(()=>{E(d)})};function y(t){var n;return((n=window.mediaLibraryTranslations)==null?void 0:n[t])||t}
