var g=t=>{throw TypeError(t)};var p=(t,e,o)=>e.has(t)||g("Cannot "+o);var l=(t,e,o)=>(p(t,e,"read from private field"),o?o.call(t):e.get(t)),f=(t,e,o)=>e.has(t)?g("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,o),b=(t,e,o,a)=>(p(t,e,"write to private field"),a?a.call(t,o):e.set(t,o),o);var i;class _{constructor(){f(this,i);b(this,i,document.createElement("div"))}register(e,o){l(this,i).addEventListener(e,o)}remove(e,o){l(this,i).removeEventListener(e,o)}fire(e,o={}){l(this,i).dispatchEvent(new CustomEvent(e,{detail:o}))}}i=new WeakMap;const c=new _;document.addEventListener("imageEditorReady",t=>{console.log("Image editor is ready:",t.detail.instance);const e=t.detail.instance,o=e.getAttribute("data-initiator-id"),a=e.getAttribute("data-medium-name"),r=e.getAttribute("data-medium-path");e.setImage(a,r,o),e.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:["16:9","4:3"],selectionAspectRatio:"16:9"})});c.register("onImageSave",t=>{const e=document.getElementById(t.detail.id);console.log("modal",e),console.log("dispatching",t.detail),e.dispatchEvent(new CustomEvent("onImageUpdated",{bubbles:!0,composed:!0,detail:t.detail})),console.log("onImageSave using event bus",t.detail),E(t.detail)});c.register("onCanvasStatusMessage",t=>{console.log("onCanvasStatusMessage using event bus",t.detail)});c.register("onCloseImageEditor",t=>{console.log("onCloseImageEditor using event bus",t.detail)});const E=t=>{const e=document.getElementById(t.id),o=e.querySelector(".image-editor-modal-config");if(!o)return;let a={};try{a=JSON.parse(o.value)}catch{console.error("Invalid JSON config")}const{model_type:r,model_id:I,medium_id:k,collection:S,csrf_token:v,save_updated_medium_route:m}=a;console.log("modelType",r),console.log("saveUpdatedMediumRoute",m);const h=t.file,d=new FormData;d.append("model_type",a.model_type),d.append("model_id",a.model_id),d.append("medium_id",a.medium_id),d.append("collection",a.collection),d.append("file",h),fetch(m,{method:"POST",headers:{"X-CSRF-TOKEN":v,Accept:"application/json"},body:d}).then(async s=>{const u=await s.json();if(!s.ok){y(s,u);return}console.log("data",u),console.log("modal",e),console.log("close modal",e),e.querySelector(".image-editor-modal-close-button").click()}).then(s=>{console.log("Upload successful:",s)}).catch(s=>{console.error("Upload failed:",s)})};function y(t,e){let o=n("upload_failed");switch(t.status){case 419:o=n("csrf_token_mismatch");break;case 401:o=n("unauthenticated");break;case 403:o=n("forbidden");break;case 404:o=n("not_found");break;case 422:if(e.errors){for(const a in e.errors)e.errors[a].forEach(r=>{});return}o=e.message||n("validation_failed");break;case 429:o=n("too_many_requests");break;case 500:case 503:o=n("server_error");break;default:o=e.message||o;break}console.log(o)}function n(t){var e;return((e=window.mediaLibraryTranslations)==null?void 0:e[t])||t}export{c as b};
