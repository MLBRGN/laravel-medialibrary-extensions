var p=e=>{throw TypeError(e)};var g=(e,t,o)=>t.has(e)||p("Cannot "+o);var l=(e,t,o)=>(g(e,t,"read from private field"),o?o.call(e):t.get(e)),f=(e,t,o)=>t.has(e)?p("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,o),b=(e,t,o,a)=>(g(e,t,"write to private field"),a?a.call(e,o):t.set(e,o),o);var d;class E{constructor(){f(this,d);b(this,d,document.createElement("div"))}register(t,o){l(this,d).addEventListener(t,o)}remove(t,o){l(this,d).removeEventListener(t,o)}fire(t,o={}){l(this,d).dispatchEvent(new CustomEvent(t,{detail:o}))}}d=new WeakMap;const u=new E;document.addEventListener("imageEditorReady",e=>{console.log("Image editor is ready:",e.detail.instance);const t=e.detail.instance,o=t.getAttribute("data-initiator-id"),a=t.getAttribute("data-medium-name"),r=t.getAttribute("data-medium-path");t.setImage(a,r,o),t.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:["16:9","4:3"],selectionAspectRatio:"16:9"})});u.register("onImageSave",e=>{const t=document.getElementById(e.detail.id);console.log("modal",t),console.log("dispatching",e.detail),t.dispatchEvent(new CustomEvent("onImageUpdated",{bubbles:!0,composed:!0,detail:e.detail})),console.log("onImageSave using event bus",e.detail),I(e.detail)});u.register("onCanvasStatusMessage",e=>{console.log("onCanvasStatusMessage using event bus",e.detail)});u.register("onCloseImageEditor",e=>{console.log("onCloseImageEditor using event bus",e.detail)});const I=e=>{console.log("updateMedia",e);const o=document.getElementById(e.id).querySelector(".image-editor-modal-config");if(!o)return;let a={};try{a=JSON.parse(o.value)}catch{console.error("Invalid JSON config")}console.log("config",a);const{model_type:r,model_id:k,medium_id:R,collection:w,csrf_token:v,save_updated_medium_route:c,temporary_upload:_}=a;console.log("temporaryUpload",_),console.log("modelType",r),console.log("saveUpdatedMediumRoute",c);const h=e.file,i=new FormData;i.append("initiator_id",a.initiator_id),i.append("model_type",a.model_type),i.append("model_id",a.model_id??""),i.append("medium_id",a.medium_id),i.append("collection",a.collection),i.append("temporary_upload",a.temporary_upload),i.append("file",h),console.log("saveUpdatedMediaRoute",c),fetch(c,{method:"POST",headers:{"X-CSRF-TOKEN":v,Accept:"application/json"},body:i}).then(async n=>{const y=await n.json();if(!n.ok){S(n,y);return}const m=document.querySelector("#"+a.initiator_id);console.log("initiator",m),m.dispatchEvent(new CustomEvent("refreshRequest",{bubbles:!0,composed:!0,detail:[]}))}).then(n=>{console.log("Upload successful:",n)}).catch(n=>{console.error("Upload failed:",n)})};function S(e,t){let o=s("upload_failed");switch(e.status){case 419:o=s("csrf_token_mismatch");break;case 401:o=s("unauthenticated");break;case 403:o=s("forbidden");break;case 404:o=s("not_found");break;case 422:if(t.errors){for(const a in t.errors)t.errors[a].forEach(r=>{});return}o=t.message||s("validation_failed");break;case 429:o=s("too_many_requests");break;case 500:case 503:o=s("server_error");break;default:o=t.message||o;break}console.log(o)}function s(e){var t;return((t=window.mediaLibraryTranslations)==null?void 0:t[e])||e}export{u as b};
