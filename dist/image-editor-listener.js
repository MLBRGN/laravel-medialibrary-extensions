var p=e=>{throw TypeError(e)};var g=(e,o,t)=>o.has(e)||p("Cannot "+t);var l=(e,o,t)=>(g(e,o,"read from private field"),t?t.call(e):o.get(e)),f=(e,o,t)=>o.has(e)?p("Cannot add the same private member more than once"):o instanceof WeakSet?o.add(e):o.set(e,t),_=(e,o,t,a)=>(g(e,o,"write to private field"),a?a.call(e,t):o.set(e,t),t);var r;class y{constructor(){f(this,r);_(this,r,document.createElement("div"))}register(o,t){l(this,r).addEventListener(o,t)}remove(o,t){l(this,r).removeEventListener(o,t)}fire(o,t={}){l(this,r).dispatchEvent(new CustomEvent(o,{detail:t}))}}r=new WeakMap;const u=new y;document.addEventListener("imageEditorReady",e=>{console.log("Image editor is ready:",e.detail.instance);const o=e.detail.instance,t=o.getAttribute("data-initiator-id"),a=o.getAttribute("data-medium-display-name"),d=o.getAttribute("data-medium-path");console.log("Image editor setImage:",a,d),o.setImage(a,d,t),o.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:["16:9","4:3"],selectionAspectRatio:"16:9"})});u.register("onImageSave",e=>{E(e.detail)});u.register("onCanvasStatusMessage",e=>{console.log("onCanvasStatusMessage using event bus",e.detail)});u.register("onCloseImageEditor",e=>{console.log("onCloseImageEditor using event bus",e.detail)});const E=e=>{const o=document.getElementById(e.id);console.log("modal",o),console.log("dispatching",e),console.log("onImageSave using event bus",e),console.log("updateMedia",e);const t=o.querySelector(".image-editor-modal-config");if(!t)return;let a={};try{a=JSON.parse(t.value)}catch{console.error("Invalid JSON config")}console.log("config",a);const{model_type:d,model_id:S,medium_id:k,collection:R,csrf_token:b,save_updated_medium_route:c,temporary_upload:v}=a;console.log("temporaryUpload",v),console.log("modelType",d),console.log("saveUpdatedMediumRoute",c);const m=e.file;console.log("file",m);const n=new FormData;n.append("initiator_id",a.initiator_id),n.append("model_type",a.model_type),n.append("model_id",a.model_id??""),n.append("medium_id",a.medium_id),n.append("collection",a.collection),n.append("image_collection",a.image_collection),n.append("document_collection",a.document_collection),n.append("youtube_collection",a.youtube_collection),n.append("temporary_upload",a.temporary_upload),n.append("file",m),console.log("saveUpdatedMediaRoute",c),fetch(c,{method:"POST",headers:{"X-CSRF-TOKEN":b,Accept:"application/json"},body:n}).then(async i=>{const h=await i.json();if(!i.ok){I(i,h);return}}).then(i=>{console.log("Upload successful:",i)}).catch(i=>{console.error("Upload failed:",i)}).finally(()=>{o.dispatchEvent(new CustomEvent("onImageUpdated",{bubbles:!0,composed:!0,detail:e}));const i=document.querySelector("#"+a.initiator_id);console.log("initiator",i),i.dispatchEvent(new CustomEvent("refreshRequest",{bubbles:!0,composed:!0,detail:[]}))})};function I(e,o){let t=s("upload_failed");switch(e.status){case 419:t=s("csrf_token_mismatch");break;case 401:t=s("unauthenticated");break;case 403:t=s("forbidden");break;case 404:t=s("not_found");break;case 422:if(o.errors){for(const a in o.errors)o.errors[a].forEach(d=>{});return}t=o.message||s("validation_failed");break;case 429:t=s("too_many_requests");break;case 500:case 503:t=s("server_error");break;default:t=o.message||t;break}console.log(t)}function s(e){var o;return((o=window.mediaLibraryTranslations)==null?void 0:o[e])||e}
