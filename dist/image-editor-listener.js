var g=e=>{throw TypeError(e)};var p=(e,t,o)=>t.has(e)||g("Cannot "+o);var c=(e,t,o)=>(p(e,t,"read from private field"),o?o.call(e):t.get(e)),f=(e,t,o)=>t.has(e)?g("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,o),v=(e,t,o,a)=>(p(e,t,"write to private field"),a?a.call(e,o):t.set(e,o),o);var i;class h{constructor(){f(this,i);v(this,i,document.createElement("div"))}register(t,o){c(this,i).addEventListener(t,o)}remove(t,o){c(this,i).removeEventListener(t,o)}fire(t,o={}){c(this,i).dispatchEvent(new CustomEvent(t,{detail:o}))}}i=new WeakMap;const l=new h;document.addEventListener("imageEditorReady",e=>{console.log("Image editor is ready:",e.detail.instance);const t=e.detail.instance,o=t.getAttribute("data-initiator-id"),a=t.getAttribute("data-medium-name"),d=t.getAttribute("data-medium-path");t.setImage(a,d,o),t.setConfiguration({debug:!0})});l.register("onImageSave",e=>{E(e.detail),console.log("onImageSave using event bus",e.detail)});l.register("onCanvasStatusMessage",e=>{console.log("onCanvasStatusMessage using event bus",e.detail)});l.register("onCloseImageEditor",e=>{console.log("onCloseImageEditor using event bus",e.detail)});const E=e=>{const o=document.getElementById(e.id).parentNode.querySelector(".image-editor-modal-config");if(!o)return;let a={};try{a=JSON.parse(o.value)}catch{console.error("Invalid JSON config")}const{model_type:d,model_id:I,medium_id:k,collection:S,csrf_token:b,save_updated_medium_route:m}=a;console.log("modelType",d),console.log("saveUpdatedMediumRoute",m);const _=e.file,r=new FormData;r.append("model_type",a.model_type),r.append("model_id",a.model_id),r.append("medium_id",a.medium_id),r.append("collection",a.collection),r.append("file",_),fetch(m,{method:"POST",headers:{"X-CSRF-TOKEN":b,Accept:"application/json"},body:r}).then(async n=>{const u=await n.json();if(!n.ok){y(n,u);return}console.log("data",u)}).then(n=>{console.log("Upload successful:",n)}).catch(n=>{console.error("Upload failed:",n)})};function y(e,t){let o=s("upload_failed");switch(e.status){case 419:o=s("csrf_token_mismatch");break;case 401:o=s("unauthenticated");break;case 403:o=s("forbidden");break;case 404:o=s("not_found");break;case 422:if(t.errors){for(const a in t.errors)t.errors[a].forEach(d=>{});return}o=t.message||s("validation_failed");break;case 429:o=s("too_many_requests");break;case 500:case 503:o=s("server_error");break;default:o=t.message||o;break}console.log(o)}function s(e){var t;return((t=window.mediaLibraryTranslations)==null?void 0:t[e])||e}export{l as b};
