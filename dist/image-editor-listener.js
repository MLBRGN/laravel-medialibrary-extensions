import{h as u,s as p}from"./xhrStatus.js";document.addEventListener("onImageSave",o=>{console.log("onImageSave:",o.detail,o),g(o.detail)});document.addEventListener("onCanvasStatusMessage",o=>{console.log("onCanvasStatusMessage:",o.detail)});document.addEventListener("onCloseImageEditor",o=>{const a=o.detail.imageEditorInstance,i=a.closest("[data-image-editor-modal]"),e=a.getAttribute("data-initiator-id"),n=document.querySelector("#"+e);console.log("initiator",n),n.dispatchEvent(new CustomEvent("imageEditorModalCloseRequest",{bubbles:!0,composed:!0,detail:{modal:i}}))});const g=o=>{const a=o.imageEditorInstance.closest("[data-image-editor-modal]"),i=a.querySelector(".image-editor-modal-config");if(!i)return;let e={};try{e=JSON.parse(i.value)}catch{console.error("Invalid JSON config")}const n=document.querySelector("#"+e.initiator_id),l=n.querySelector(".media-manager-row"),{model_type:y,model_id:E,medium_id:f,collection:v,csrf_token:c,save_updated_medium_route:r,temporary_upload:b}=e,m=o.file,t=new FormData;t.append("initiator_id",e.initiator_id),t.append("model_type",e.model_type),t.append("model_id",e.model_id??""),t.append("medium_id",e.medium_id),t.append("collection",e.collection),t.append("image_collection",e.image_collection),t.append("document_collection",e.document_collection),t.append("youtube_collection",e.youtube_collection),t.append("temporary_upload",e.temporary_upload),t.append("file",m),fetch(r,{method:"POST",headers:{"X-CSRF-TOKEN":c,Accept:"application/json"},body:t}).then(async d=>{const s=await d.json();if(!d.ok)throw u(d,s,l),new Error("Upload failed");return s}).then(d=>{p(l,{type:"success",message:_("medium_replaced")}),console.log("send closeModalRequest"),n.dispatchEvent(new CustomEvent("imageEditorModalCloseRequest",{bubbles:!0,composed:!0,detail:{modal:a}})),n.dispatchEvent(new CustomEvent("refreshRequest",{bubbles:!0,composed:!0,detail:[]}))})};function _(o){var a;return((a=window.mediaLibraryTranslations)==null?void 0:a[o])||o}
