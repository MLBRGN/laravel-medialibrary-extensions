import{h as m}from"./xhrStatus.js";import{g as l}from"./media-manager-config.js";async function p(r,a,d,t={}){const e=r.querySelector("[data-mle-media-manager-lab-previews]");if(!e)return;const s=new URLSearchParams({model_type:a.modelType,model_id:a.modelId,initiator_id:a.id,medium_id:d,options:JSON.stringify(a.options)});s.append("_",Date.now()),t.part&&s.append("part",t.part);try{const i=await fetch(`${a.mediaManagerLabPreviewUpdateRoute}?${s}`,{headers:{Accept:"application/json"},cache:"no-store"}),n=await i.json();if(!i.ok){m(i,n);return}if(!n.html)return;if(t.part==="original"){const o=e.querySelector("[data-mle-media-lab-preview-original]");o&&(o.outerHTML=n.html)}else if(t.part==="base"){const o=e.querySelector("[data-mle-media-lab-preview-base]");o&&(o.outerHTML=n.html)}else e.innerHTML=n.html;document.dispatchEvent(new CustomEvent("mediaManagerLabPreviewsUpdated",{bubbles:!1,detail:{mediaManager:r,previewsContainer:e}}))}catch(i){console.error("Error refreshing media manager:",i)}}document.addEventListener("imageUpdated",r=>{const d=document.getElementById(r.detail.initiatorId).closest("[data-mle-media-manager-lab]"),t=r.detail.mediumId,e=l(d);if(!e){console.warn("Could not get config");return}p(d,e,t,{part:"all"})});export{p as u};
