import{h as s}from"./xhrStatus.js";import{g as m}from"./media-manager-config.js";async function p(o,t,d,r={}){const e=o.querySelector("[data-mle-media-manager-lab-previews]");if(!e)return;const l=new URLSearchParams({model_type:t.modelType,model_id:t.modelId,initiator_id:t.id,medium_id:d,options:JSON.stringify(t.options)});l.append("_",Date.now()),r.part&&l.append("part",r.part);try{const n=await fetch(`${t.mediaManagerLabPreviewUpdateRoute}?${l}`,{headers:{Accept:"application/json"},cache:"no-store"}),i=await n.json();if(!n.ok){s(n,i);return}if(!i.html)return;if(r.part==="original"){const a=e.querySelector("[data-mle-media-lab-preview-original]");if(console.log('replace "original" with updated html',a),!a){consolw.warn("replaced not found");return}a.outerHTML=i.html}else if(r.part==="base"){const a=e.querySelector("[data-mle-media-lab-preview-base]");if(console.log('replace "base" with updated html',a),!a){consolw.warn("replaced not found");return}a.outerHTML=i.html}else console.log("replace all with updated html"),e.innerHTML=i.html;document.dispatchEvent(new CustomEvent("mediaManagerLabPreviewsUpdated",{bubbles:!1,detail:{mediaManager:o,previewsContainer:e}}))}catch(n){console.error("Error refreshing media manager:",n)}}document.addEventListener("imageUpdated",o=>{const d=document.getElementById(o.detail.initiatorId).closest("[data-mle-media-manager-lab]"),r=o.detail.mediumId,e=m(d);if(!e){console.warn("Could not get config");return}p(d,e,r,{part:"all"})});export{p as u};
