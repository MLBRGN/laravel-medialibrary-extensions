import{h as m}from"./xhrStatus.js";import{g as c}from"./media-manager-config.js";async function l(t,o,s,a={}){const e=t.querySelector("[data-mle-media-manager-lab-previews]");if(!e)return;const d=new URLSearchParams({initiator_id:o.id,medium_id:s,options:JSON.stringify(o.options)});d.append("_",Date.now()),a.part&&d.append("part",a.part);try{const r=await fetch(`${o.mediaManagerLabPreviewUpdateRoute}?${d}`,{headers:{Accept:"application/json"},cache:"no-store"}),i=await r.json();if(!r.ok){m(r,i);return}if(!i.html)return;if(a.part==="original"){const n=e.querySelector("[data-mle-media-lab-preview-original]");n&&(n.outerHTML=i.html)}else if(a.part==="base"){const n=e.querySelector("[data-mle-media-lab-preview-base]");n&&(n.outerHTML=i.html)}else e.innerHTML=i.html;document.dispatchEvent(new CustomEvent("mediaManagerLabPreviewsUpdated",{bubbles:!1,detail:{mediaManager:t,previewsContainer:e}}))}catch(r){console.error("Error refreshing media manager:",r)}}document.addEventListener("imageUpdated",t=>{const s=document.getElementById(t.detail.initiatorId).closest("[data-mle-media-manager-lab]"),a=t.detail.mediumId,e=c(s);if(!e){console.warn("Could not get config");return}l(s,e,a,{part:"all"})});export{l as u};
