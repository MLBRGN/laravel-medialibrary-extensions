import"./image-editor-listener.js";import{a as U}from"./index.es.js";import"./xhrStatus.js";function V(e,t){const g=new CustomEvent(e,{bubbles:!0,detail:{element:t}});t.dispatchEvent(g)}function W(e){const t='a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])',g=()=>Array.from(e.querySelectorAll(t)).filter(o=>!o.hasAttribute("disabled")&&o.offsetParent!==null),v=o=>{const i=g();console.log(i);const d=i[0],a=i[i.length-1];if(o.key==="Tab"){if(i.length===0)return;o.shiftKey?document.activeElement===d&&(o.preventDefault(),a.focus()):document.activeElement===a&&(o.preventDefault(),d.focus())}};e.addEventListener("keydown",v),e._trapFocusHandler=v;const n=g();n.length&&n[0].focus()}function Y(e){e._trapFocusHandler&&(e.removeEventListener("keydown",e._trapFocusHandler),delete e._trapFocusHandler)}let D=!1;const q=new Map;function I(e,t){q.has(e)||q.set(e,new Set),q.get(e).add(t)}function H(e,t){if(q.has(e))for(const g of q.get(e))g(t)}function C(e){e.classList.remove("active"),e.setAttribute("aria-hidden","true"),document.body.style.overflow="initial",Y(e),V("modalClosed",e)}function O(e){console.log("openModal: ",e);const t=document.querySelector(e);if(!t){console.log("could not find modal "+e);return}t.classList.add("active"),t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",W(t),V("modalOpened",t)}function N(e,t=()=>{},g=()=>{}){e.addEventListener("modalOpened",g),e.addEventListener("modalClosed",t)}function x(e){const t=e.target,g=t.closest("[data-modal-trigger]");if(g){e.preventDefault();const o=g.getAttribute("data-modal-trigger");O(o);return}const v=t.closest("[data-modal-close]");if(v){const o=v.closest("[data-modal]");o&&C(o);return}const n=t.closest("[data-modal]");n&&t===n&&C(n)}function X(e){e.key==="Escape"&&document.querySelectorAll("[data-modal].active").forEach(C)}function R(){D||(document.addEventListener("click",e=>H("click",e)),document.addEventListener("keydown",e=>H("keydown",e)),D=!0),I("click",x),I("keydown",X)}function _(){q.clear(),R()}const T=new Map;function B(e){return T.get(e)}function z(e){T.has(e)&&(T.get(e).pause(),T.delete(e));const t=e.querySelectorAll(".media-carousel-item");if(!t.length)return;const g=e.querySelectorAll(".media-carousel-indicators button"),v=e.querySelector('[data-slide="prev"]'),n=e.querySelector('[data-slide="next"]'),o=e.getAttribute("data-carousel-ride")==="true",i=Number(e.getAttribute("data-carousel-ride-interval")??"5000"),d=e.getAttribute("data-carousel-ride-only-after-interaction")==="true";let a=0,u=!1,m=null,y=0,l=0,h=0,L=0;const r=50,f=(c,b="right")=>{t.forEach(M=>{M.classList.remove("active","slide-in-from-left","slide-in-from-right","slide-out-to-left","slide-out-to-right")});const w=t[a],P=t[c];e.getAttribute("data-carousel-effect")==="slide"&&(e.classList.contains("temp-no-animation")||e.classList.contains("no-animation")||(b==="right"?(P.classList.add("slide-in-from-right"),w.classList.add("slide-out-to-left")):(P.classList.add("slide-in-from-left"),w.classList.add("slide-out-to-right")),P.offsetWidth)),w.classList.remove("active"),P.classList.add("active"),g.forEach((M,F)=>M.classList.toggle("active",F===c)),a=c,V("carouselSlided",e)},s=(c,b=!1)=>{if(c===a)return;const w=(c+t.length)%t.length,M=(w-a+t.length)%t.length>t.length/2?"left":"right";b&&(e.classList.add("temp-no-animation"),e.offsetWidth),f(w,M),b&&e.classList.remove("temp-no-animation")},p=()=>{const b=l-y;Math.abs(b)>40&&Math.abs(b)>Math.abs(L-h)&&(b<0?s((a+1)%t.length):s((a-1+t.length)%t.length),S()),y=l=h=L=0},E=()=>{A(),m=setInterval(()=>s((a+1)%t.length),i)},A=()=>{m!==null&&(clearInterval(m),m=null)},S=()=>{u||(u=!0,o&&d&&E()),o&&!d&&E()};g.forEach((c,b)=>c.addEventListener("click",()=>{s(b),S()})),v==null||v.addEventListener("click",()=>{s((a-1+t.length)%t.length),S()}),n==null||n.addEventListener("click",()=>{s((a+1)%t.length),S()}),e.addEventListener("mouseenter",A),e.addEventListener("mouseleave",()=>{o&&(!d||u)&&E()}),e.addEventListener("focusin",A),e.addEventListener("focusout",()=>{o&&(!d||u)&&E()}),e.addEventListener("keydown",c=>{c.key==="ArrowLeft"?(c.preventDefault(),s((a-1+t.length)%t.length),S()):c.key==="ArrowRight"&&(c.preventDefault(),s((a+1)%t.length),S())}),e.addEventListener("touchstart",c=>{y=c.changedTouches[0].screenX,h=c.changedTouches[0].screenY},{passive:!0}),e.addEventListener("touchend",c=>{l=c.changedTouches[0].screenX,L=c.changedTouches[0].screenY,Math.abs(L-h)<r&&p()},{passive:!0}),t.length>1&&o&&!d&&E();const k={goToSlide:(c,b=!1)=>s(c,b),getCurrentIndex:()=>a,goToNextSlide:()=>s((a+1)%t.length),goToPreviousSlide:()=>s((a-1+t.length)%t.length),pause:A,resume:E};T.set(e,k)}document.addEventListener("mediaManagerPreviewsUpdated",e=>{e.detail.mediaManager,document.querySelectorAll("[data-carousel]").forEach(z)});document.querySelectorAll("[data-carousel]").forEach(z);document.addEventListener("DOMContentLoaded",()=>{let e={};function t(i){const d=i.querySelector("[data-carousel]"),a=i.hasAttribute("data-video-autoplay");i.id,console.log("autoPlay",a),N(i,L,()=>{if(!a)return;const r=i.querySelector(".media-carousel-item.active"),f=r==null?void 0:r.querySelector(".media-video-container[data-youtube-video-id]");if(console.log("activeSlide",r),console.log("videoWrapper",f),f){console.log("startVideoPlayBack");const s=i.id,p=f.getAttribute("data-youtube-video-id"),E=s+"-"+p;l(E)}}),d==null||d.addEventListener("carouselSlided",()=>{if(console.log("carouselSlided, pause videos"),h(),console.log("autoPlay"),!a)return;const r=d.querySelector(".media-carousel-item.active"),f=r==null?void 0:r.querySelector(".media-video-container[data-youtube-video-id]");if(f){console.log("startVideoPlayBack");const s=i.id,p=f.getAttribute("data-youtube-video-id"),E=s+"-"+p;l(E)}});function u(r,f="playVideo",s=0,p=10,E=200){const A={playVideo:"playVideo",pauseVideo:"pauseVideo",stopVideo:"stopVideo"},S=A[f];if(!A[f]){console.warn(`Unknown action: ${f}`);return}const k=e[r];if(!k||!k.isReady){console.log("No player, or player not ready yet",r,"player",k,"playerIsReady",k==null?void 0:k.isReady),s<p&&setTimeout(()=>u(r,f,s+1,p,E*1.2),E);return}S&&k[S]()}function m(r,f=0,s=10,p=200){u(r,"pauseVideo",f,s,p)}function y(r,f=0,s=10,p=200){u(r,"stopVideo",f,s,p)}function l(r,f=0,s=10,p=200){u(r,"playVideo",f,s,p)}function h(){Object.keys(e).forEach(r=>m(r,0,10,200))}function L(){Object.keys(e).forEach(r=>y(r,0,10,200))}}function g(){R()}function v(i){const d=i.target.closest("[data-media-modal].active");if(!d)return;const a=B(d.querySelector("[data-carousel]"));if(!a)return;const u=d.querySelector("[data-carousel]").contains(i.target);(i.key==="ArrowLeft"||i.key==="ArrowRight")&&u||(i.key==="ArrowLeft"?a.goToPreviousSlide():i.key==="ArrowRight"&&a.goToNextSlide())}function n(i){const d=i.target.closest("[data-modal-trigger]");if(!d)return;const a=d.getAttribute("data-modal-trigger"),u=parseInt(d.getAttribute("data-slide-to")||"0",10);console.log("slideTo",u),O(a);const m=document.querySelector(a),y=m==null?void 0:m.querySelector("[data-carousel]");console.log("modal",m),console.log("carousel",y);const l=B(y);console.log("controller",l),l&&l.goToSlide(u,!0)}function o(i){var L;const d=i.target.closest("[data-media-modal]");if(!d)return;const a=d.id,u=i.target.closest("[data-youtube-video-id]"),m=u==null?void 0:u.getAttribute("data-youtube-video-id");if(!m)return;const y=a+"-"+m;if(e[y])return;const l=u.querySelector("lite-youtube"),h=(L=l==null?void 0:l.shadowRoot)==null?void 0:L.querySelector("iframe");h&&(e[y]=new YT.Player(h,{events:{onReady:r=>{console.log("player ready",y),e[y].isReady=!0}}}))}I("click",n),I("keydown",v),document.addEventListener("liteYoutubeIframeLoaded",o),g(),document.querySelectorAll("[data-media-modal]").forEach(t),document.addEventListener("mediaManagerPreviewsUpdated",i=>{e={};const d=i.detail.mediaManager;console.log("reinitialize modals for media manager",d),_(),I("click",n),I("keydown",v),d.querySelectorAll("[data-media-modal]").forEach(t)})});document.addEventListener("DOMContentLoaded",()=>{const e=new WeakMap;function t(n){if(n.dataset.imageEditorInitialized)return;const o=n.querySelector("[data-image-editor-placeholder]");N(n,()=>{console.log("onClose");const a=e.get(n);a&&(a.remove(),e.delete(n))},()=>{if(console.log("onOpen"),e.has(n))return;let a={};try{const h=n.querySelector(".image-editor-modal-config");h&&(a=JSON.parse(h.value))}catch(h){console.error("Invalid or missing image-editor-modal-config:",h)}const u=n.dataset.mediumPath,m=n.dataset.mediumDisplayName,y=a.initiator_id,l=document.createElement("image-editor");l.id="my-image-editor",l.dataset.mediumDisplayName=m,l.dataset.mediumPath=u,l.dataset.initiatorId=y,l.addEventListener("imageEditorReady",h=>{g(h.detail)},{once:!0}),o.appendChild(l),e.set(n,l)}),n.dataset.imageEditorInitialized="true"}function g(n){const o=n.imageEditorInstance;if(!o)return;const i=o.dataset.initiatorId,d=o.dataset.mediumDisplayName,a=o.dataset.mediumPath;o.setImage(d,a,i),o.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:["16:9","4:3"],selectionAspectRatio:"16:9"})}function v(n){const o=n.target.closest("[data-image-editor-modal]");o&&C(o)}I("onImageUpdated",v),R(),document.querySelectorAll("[data-image-editor-modal]").forEach(t),document.addEventListener("mediaManagerPreviewsUpdated",n=>{const o=n.detail.mediaManager;o.querySelectorAll("[data-image-editor-modal]").forEach(t),console.log("reinitialized image editor modals for media manager",o)}),document.addEventListener("imageEditorModalCloseRequest",n=>{const o=n.detail.modal;console.log("imageEditorModalCloseRequest",o),C(o)})});U.translationsPath="/js/vendor/image-editor/lang";
