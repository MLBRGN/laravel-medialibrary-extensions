import"./image-editor-listener.js";import"./index.es.js";function I(e,t){const i=new CustomEvent(e,{bubbles:!0,detail:{element:t}});t.dispatchEvent(i)}function z(e){const t='a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])',i=()=>Array.from(e.querySelectorAll(t)).filter(a=>!a.hasAttribute("disabled")&&a.offsetParent!==null),n=a=>{const d=i();console.log(d);const l=d[0],r=d[d.length-1];if(a.key==="Tab"){if(d.length===0)return;a.shiftKey?document.activeElement===l&&(a.preventDefault(),r.focus()):document.activeElement===r&&(a.preventDefault(),l.focus())}};e.addEventListener("keydown",n),e._trapFocusHandler=n;const o=i();o.length&&o[0].focus()}function Y(e){e._trapFocusHandler&&(e.removeEventListener("keydown",e._trapFocusHandler),delete e._trapFocusHandler)}const T=new Map;function C(e){return T.get(e)}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-carousel]").forEach(e=>{const t=e.querySelectorAll(".media-carousel-item"),i=e.querySelectorAll(".media-carousel-indicators button"),n=e.querySelector('[data-slide="prev"]'),o=e.querySelector('[data-slide="next"]'),a=e.getAttribute("data-carousel-ride")==="true",d=Number(e.getAttribute("data-carousel-ride-interval")??"5000"),l=e.getAttribute("data-carousel-ride-only-after-interaction")==="true";let r=0,c=!1,E=null,k=0,q=0,A=0,S=0;const P=50,F=(s,u="right")=>{t.forEach(v=>{v.classList.remove("active","slide-in-from-left","slide-in-from-right","slide-out-to-left","slide-out-to-right")});const h=t[r],y=t[s];e.getAttribute("data-carousel-effect")==="slide"&&(e.classList.contains("temp-no-animation")||e.classList.contains("no-animation")||(u==="right"?(y.classList.add("slide-in-from-right"),h.classList.add("slide-out-to-left")):(y.classList.add("slide-in-from-left"),h.classList.add("slide-out-to-right")),y.offsetWidth)),h.classList.remove("active"),y.classList.add("active"),i.forEach((v,x)=>v.classList.toggle("active",x===s)),r=s,I("carouselSlided",e)},f=(s,u=!1)=>{if(s===r)return;const h=(s+t.length)%t.length,v=(h-r+t.length)%t.length>t.length/2?"left":"right";u&&e.classList.add("temp-no-animation"),F(h,v),u&&setTimeout(()=>{e.classList.remove("temp-no-animation")},1e3)},V=()=>{const u=q-k;Math.abs(u)>40&&Math.abs(u)>Math.abs(S-A)&&(u<0?f((r+1)%t.length):f((r-1+t.length)%t.length),m())},g=()=>{b(),E=setInterval(()=>{f((r+1)%t.length)},d)},b=()=>{E!==null&&(clearInterval(E),E=null)},m=()=>{c||(c=!0,a&&l&&g()),a&&!l&&g()};i.forEach((s,u)=>{s.addEventListener("click",()=>{f(u),m()})}),n==null||n.addEventListener("click",()=>{f((r-1+t.length)%t.length),m()}),o==null||o.addEventListener("click",()=>{f((r+1)%t.length),m()}),e.addEventListener("mouseenter",b),e.addEventListener("mouseleave",()=>{a&&(!l||c)&&g()}),e.addEventListener("focusin",b),e.addEventListener("focusout",()=>{a&&(!l||c)&&g()}),e.addEventListener("keydown",s=>{s.key==="ArrowLeft"?(s.preventDefault(),f((r-1+t.length)%t.length),m()):s.key==="ArrowRight"&&(s.preventDefault(),f((r+1)%t.length),m())}),e.addEventListener("touchstart",s=>{k=s.changedTouches[0].screenX,A=s.changedTouches[0].screenY},{passive:!0}),e.addEventListener("touchend",s=>{q=s.changedTouches[0].screenX,S=s.changedTouches[0].screenY,Math.abs(S-A)<P&&V()},{passive:!0}),t.length>1&&a&&!l&&g();const w={goToSlide:(s,u=!1)=>f(s,u),getCurrentIndex:()=>r,goToNextSlide:()=>f((r+1)%t.length),goToPreviousSlide:()=>f((r-1+t.length)%t.length),pause:b,resume:g};T.set(e,w),e._carouselController=w})});function p(e){e.classList.remove("active"),e.setAttribute("aria-hidden","true"),document.body.style.overflow="",Y(e),I("modalClosed",e)}function D(e){const t=document.querySelector(e);t&&(t.classList.add("active"),t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",z(t),I("modalOpened",t))}function R(e,t=()=>{},i=()=>{}){e.addEventListener("modalOpened",i),e.addEventListener("modalClosed",t)}function O(){document.addEventListener("click",e=>{const t=e.target;console.log("target",t);const i=t.closest("[data-modal-trigger]");if(i){e.preventDefault();const a=i.getAttribute("data-modal-trigger");D(a);return}const n=t.closest("[data-modal-close]");if(n){const a=n.closest("[data-modal]");a&&p(a);return}else console.log("no close button");const o=t.closest("[data-modal]");o&&t===o&&p(o)}),document.addEventListener("keydown",e=>{e.key==="Escape"&&document.querySelectorAll("[data-modal].active").forEach(p)})}const L={};function _(){Object.values(L).forEach(e=>e.stopVideo())}function B(){Object.values(L).forEach(e=>e.pauseVideo())}function M(e){const t=L[e];t&&t.playVideo()}function N(e){const t=e.querySelector("[data-carousel]"),i=e.hasAttribute("data-video-autoplay");R(e,_,()=>{if(!i)return;const n=e.querySelector(".media-carousel-item.active"),o=n==null?void 0:n.querySelector(".media-video-container[data-youtube-video-id]");o&&M(o.getAttribute("data-youtube-video-id"))}),e.addEventListener("keydown",n=>{if(!e.classList.contains("active"))return;const o=C(e.querySelector("[data-carousel]"));if(!o)return;const a=e.querySelector("[data-carousel]").contains(n.target);if(n.key==="Escape"){p(e),n.preventDefault();return}(n.key==="ArrowLeft"||n.key==="ArrowRight")&&a||(n.key==="ArrowLeft"?o.goToPreviousSlide():n.key==="ArrowRight"&&o.goToNextSlide())}),t==null||t.addEventListener("carouselSlided",()=>{if(B(),!i)return;const n=t.querySelector(".media-carousel-item.active"),o=n==null?void 0:n.querySelector(".media-video-container[data-youtube-video-id]");o&&M(o.getAttribute("data-youtube-video-id"))}),e.addEventListener("liteYoutubeIframeLoaded",n=>{var l,r;const o=n.target.closest("[data-youtube-video-id]"),a=o==null?void 0:o.getAttribute("data-youtube-video-id"),d=(r=(l=o==null?void 0:o.querySelector("lite-youtube"))==null?void 0:l.shadowRoot)==null?void 0:r.querySelector("iframe");a&&d&&(L[a]=new YT.Player(d))})}function H(){O(),document.addEventListener("click",e=>{const t=e.target.closest("[data-modal-trigger]");if(t){const i=t.getAttribute("data-modal-trigger"),n=parseInt(t.getAttribute("data-slide-to")||"0",10),o=document.querySelector(i);D(i);const a=o==null?void 0:o.querySelector("[data-carousel]"),d=C(a);d&&d.goToSlide(n,!0);return}})}document.addEventListener("DOMContentLoaded",()=>{H(),document.querySelectorAll("[data-media-modal]").forEach(N)});function X(e){if(e.dataset.imageEditorInitialized)return;const t=e.querySelector("#image-editor-placeholder");let i=null;R(e,()=>{i&&(i.remove(),i=null)},()=>{if(i)return;let a={};try{const c=e.querySelector(".image-editor-modal-config");c&&(a=JSON.parse(c.value))}catch(c){console.error("Invalid or missing image-editor-modal-config:",c)}const d=e.getAttribute("data-medium-path"),l=e.getAttribute("data-medium-display-name"),r=a.initiator_id;i=document.createElement("image-editor"),i.setAttribute("id","my-image-editor"),i.setAttribute("data-medium-display-name",l),i.setAttribute("data-medium-path",d),i.setAttribute("data-initiator-id",r),i.addEventListener("imageEditorReady",c=>{console.log("imageEditorReady",c),W(c.detail)},{once:!0}),t.appendChild(i),e.addEventListener("onImageUpdated",c=>{console.log("onImageUpdated",c),p(e)})}),e.dataset.imageEditorInitialized="true"}document.addEventListener("DOMContentLoaded",()=>{O(),document.querySelectorAll("[data-image-editor-modal]").forEach(X)});function W(e){const t=e.imageEditorInstance;console.log("initializeImageEditorModal",e,"imageEditorInstance",t);const i=t.getAttribute("data-initiator-id"),n=t.getAttribute("data-medium-display-name"),o=t.getAttribute("data-medium-path");console.log("imageEditor.setImage(",n,",",o,",",i,")"),t.setImage(n,o,i),t.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:["16:9","4:3"],selectionAspectRatio:"16:9"})}
