import"./image-fallback.js";import"./image-editor-listener.js";import{a as F}from"./index.es.js";import"./xhrStatus.js";function R(e,t,u){const f=new CustomEvent(e,{bubbles:!0,detail:u});t.dispatchEvent(f)}function B(e){const t='a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])',u=()=>Array.from(e.querySelectorAll(t)).filter(a=>!a.hasAttribute("disabled")&&a.offsetParent!==null),f=a=>{const L=u();console.log(L);const r=L[0],o=L[L.length-1];if(a.key==="Tab"){if(L.length===0)return;a.shiftKey?document.activeElement===r&&(a.preventDefault(),o.focus()):document.activeElement===o&&(a.preventDefault(),r.focus())}};e.addEventListener("keydown",f),e._trapFocusHandler=f;const i=u();i.length&&i[0].focus()}function x(e){e._trapFocusHandler&&(e.removeEventListener("keydown",e._trapFocusHandler),delete e._trapFocusHandler)}let V=!1;const C=new Map;function I(e,t){C.has(e)||C.set(e,new Set),C.get(e).add(t)}function O(e,t){if(C.has(e))for(const u of C.get(e))u(t)}function T(e,t){e.classList.remove("active"),e.setAttribute("aria-hidden","true"),document.body.style.overflow="initial",x(e),R("mleModalClosed",e,{modal:e,originalEvent:t})}function U(e,t,u){console.log("openModal: ",e);const f=document.querySelector(e);if(!f){console.log("could not find modal "+e);return}f.classList.add("active"),f.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",B(f),R("mleModalOpened",f,{modal:f,trigger:t,originalEvent:u})}function N(e,t=()=>{},u=()=>{}){e.addEventListener("mleModalOpened",u),e.addEventListener("mleModalClosed",t)}function j(e){console.log("click target",e.target),e.stopPropagation();const t=e.target,u=t.closest("[data-modal-trigger]");if(u){e.preventDefault();const a=u.getAttribute("data-modal-trigger");U(a,u,e);return}const f=t.closest("[data-modal-close]");if(f){const a=f.closest("[data-modal]");a&&T(a,e);return}const i=t.closest("[data-modal]");i&&t===i&&T(i,e)}function X(e){e.key==="Escape"&&document.querySelectorAll("[data-modal].active").forEach(T)}function D(){V||(document.addEventListener("click",e=>O("click",e)),document.addEventListener("keydown",e=>O("keydown",e)),V=!0),I("click",j),I("keydown",X)}function _(){C.clear(),D()}const P=new Map;function H(e){return P.get(e)}function Y(e){P.has(e)&&(P.get(e).pause(),P.delete(e));const t=e.querySelectorAll(".media-carousel-item");if(!t.length)return;const u=e.querySelectorAll(".media-carousel-indicators button"),f=e.querySelector('[data-slide="prev"]'),i=e.querySelector('[data-slide="next"]'),a=e.getAttribute("data-carousel-ride")==="true",L=Number(e.getAttribute("data-carousel-ride-interval")??"5000"),r=e.getAttribute("data-carousel-ride-only-after-interaction")==="true";let o=0,E=!1,b=null,h=0,m=0,y=0,n=0;const s=50,c=(l,p="right")=>{t.forEach(q=>{q.classList.remove("active","slide-in-from-left","slide-in-from-right","slide-out-to-left","slide-out-to-right")});const S=t[o],w=t[l];e.getAttribute("data-carousel-effect")==="slide"&&(e.classList.contains("temp-no-animation")||e.classList.contains("no-animation")||(p==="right"?(w.classList.add("slide-in-from-right"),S.classList.add("slide-out-to-left")):(w.classList.add("slide-in-from-left"),S.classList.add("slide-out-to-right")),w.offsetWidth)),S.classList.remove("active"),w.classList.add("active"),u.forEach((q,z)=>q.classList.toggle("active",z===l)),o=l,R("mleCarouselSlided",e,{carousel:e,currentSlide:w,currentSlideIndex:o})},d=(l,p=!1)=>{if(l===o)return;const S=(l+t.length)%t.length,q=(S-o+t.length)%t.length>t.length/2?"left":"right";p&&(e.classList.add("temp-no-animation"),e.offsetWidth),c(S,q),p&&e.classList.remove("temp-no-animation")},k=()=>{const p=m-h;Math.abs(p)>40&&Math.abs(p)>Math.abs(n-y)&&(p<0?d((o+1)%t.length):d((o-1+t.length)%t.length),g()),h=m=y=n=0},M=()=>{v(),b=setInterval(()=>d((o+1)%t.length),L)},v=()=>{b!==null&&(clearInterval(b),b=null)},g=()=>{E||(E=!0,a&&r&&M()),a&&!r&&M()};u.forEach((l,p)=>l.addEventListener("click",()=>{d(p),g()})),f==null||f.addEventListener("click",()=>{d((o-1+t.length)%t.length),g()}),i==null||i.addEventListener("click",()=>{d((o+1)%t.length),g()}),e.addEventListener("mouseenter",v),e.addEventListener("mouseleave",()=>{a&&(!r||E)&&M()}),e.addEventListener("focusin",v),e.addEventListener("focusout",()=>{a&&(!r||E)&&M()}),e.addEventListener("keydown",l=>{l.key==="ArrowLeft"?(l.preventDefault(),d((o-1+t.length)%t.length),g()):l.key==="ArrowRight"&&(l.preventDefault(),d((o+1)%t.length),g())}),e.addEventListener("touchstart",l=>{h=l.changedTouches[0].screenX,y=l.changedTouches[0].screenY},{passive:!0}),e.addEventListener("touchend",l=>{m=l.changedTouches[0].screenX,n=l.changedTouches[0].screenY,Math.abs(n-y)<s&&k()},{passive:!0}),t.length>1&&a&&!r&&M();const A={goToSlide:(l,p=!1)=>d(l,p),getCurrentSlideIndex:()=>o,goToNextSlide:()=>d((o+1)%t.length),goToPreviousSlide:()=>d((o-1+t.length)%t.length),pause:v,resume:M};P.set(e,A)}document.addEventListener("mediaManagerPreviewsUpdated",e=>{e.detail.mediaManager,document.querySelectorAll("[data-carousel]").forEach(Y)});document.querySelectorAll("[data-carousel]").forEach(Y);document.addEventListener("DOMContentLoaded",()=>{let e={},t={};function u(r){const o=r.querySelector("[data-carousel]");N(r),r.addEventListener("mleModalOpened",n=>{console.log("originalEvent",n.detail.originalEvent);const s=n.detail.trigger;if(console.log("trigger",s),!s)return;const c=n.detail.modal;if(console.log("modalOpened",c),!c)return;const d=c.id;if(!c.hasAttribute("data-autoplay"))return;const M=c.querySelector("[data-carousel]");if(console.log("carousel",M),!M)return;const v=M.querySelector(".media-carousel-item:first-child");if(console.log("firstSlide",v),!v)return;if(parseInt(s.getAttribute("data-slide-to")||"0",10)===0){console.log("sliding to first slide");const A=v.querySelector("[data-mle-audio]"),l=v.querySelector("[data-mle-video]"),p=v.querySelector("[data-mle-youtube-video]");if(console.log("ytContainer",p,"audio",A,"video",l),A==null||A.play().catch(S=>console.warn("Audio autoplay failed:",S)),l==null||l.play().catch(S=>console.warn("Video autoplay failed:",S)),p){const S=p.getAttribute("data-youtube-video-id");console.log("youTubeId",S);const w=`${d}-${S}`;S&&h(w,"playVideo")}}}),r.addEventListener("mleModalClosed",n=>{const s=n.detail.modal;console.log("modalClosed",s),y()});function E(n){const s=n.querySelector("audio"),c=n.querySelector("video");let d=null;return s&&(d=s.id,t[d]=s),c&&(d=c.id,t[d]=c),console.log("nativeMediaPlayerId",d),d}o==null||o.addEventListener("mleCarouselSlided",n=>{console.log("e",n);const s=n.detail.carousel,c=n.detail.currentSlide;console.log("carousel",s),console.log("currentSlide",c);const d=s.closest("[data-modal]"),k=d.hasAttribute("data-autoplay");if(console.log("autoPlay",k),!k||(m(),console.log("autoPlay"),!k))return;const M=E(c);b(M,"play");const v=c.querySelector("[data-mle-audio]"),g=c.querySelector("[data-mle-video]"),A=c.querySelector("[data-mle-youtube-video]");if(console.log("ytContainer",A,"audio",v,"video",g),v==null||v.play().catch(l=>console.warn("Audio autoplay failed:",l)),g==null||g.play().catch(l=>console.warn("Video autoplay failed:",l)),A){console.log("startYouTubePlayBack");const l=d.id,p=A.getAttribute("data-youtube-video-id"),S=l+"-"+p;h(S,"playVideo")}});function b(n,s){console.log("controlNativeMedia",n,s);const c=t[n];if(c)try{s==="play"?c.play():s==="pause"&&c.pause()}catch(d){console.warn(`Failed to ${s} media:`,d)}}function h(n,s="playVideo",c=0,d=10,k=200){const M={playVideo:"playVideo",pauseVideo:"pauseVideo",stopVideo:"stopVideo"},v=M[s];if(!M[s]){console.warn(`Unknown action: ${s}`);return}console.log("playerId",n);const g=e[n];if(!g||!g.isReady){console.log("No player, or player not ready yet",n,"player",g,"playerIsReady",g==null?void 0:g.isReady),c<d&&setTimeout(()=>h(n,s,c+1,d,k*1.2),k);return}v&&g[v]()}function m(){console.log("pauseAllMediaPlayBack"),Object.keys(e).forEach(n=>h(n,"pauseVideo")),Object.keys(t).forEach(n=>b(n,"pause"))}function y(){Object.keys(e).forEach(n=>h(n,"stopVideo")),Object.keys(t).forEach(n=>b(n,"pause"))}}function f(){D()}function i(r){const o=r.target.closest("[data-media-modal].active");if(!o)return;const E=H(o.querySelector("[data-carousel]"));if(!E)return;const b=o.querySelector("[data-carousel]").contains(r.target);(r.key==="ArrowLeft"||r.key==="ArrowRight")&&b||(r.key==="ArrowLeft"?E.goToPreviousSlide():r.key==="ArrowRight"&&E.goToNextSlide())}function a(r){const o=r.target.closest("[data-modal-trigger]");if(console.log("trigger",o),!o)return;const E=o.getAttribute("data-modal-trigger"),b=parseInt(o.getAttribute("data-slide-to")||"0",10),h=document.querySelector(E),m=h==null?void 0:h.querySelector("[data-carousel]"),y=H(m);console.log("slideTo",b),y&&y.goToSlide(b,!0)}function L(r){var n,s;const o=r.target.closest("[data-youtube-video-id]");if(!o)return;const E=o.closest("[data-modal]");if(!E)return;const b=E.id,h=o.getAttribute("data-youtube-video-id");if(!h)return;const m=b+"-"+h;if(e[m])return;const y=(s=(n=o.querySelector("lite-youtube"))==null?void 0:n.shadowRoot)==null?void 0:s.querySelector("iframe");y&&(e[m]=new YT.Player(y,{events:{onReady:()=>e[m].isReady=!0}}))}I("click",a),I("keydown",i),document.addEventListener("liteYoutubeIframeLoaded",L),f(),document.querySelectorAll("[data-media-modal]").forEach(u),document.addEventListener("mediaManagerPreviewsUpdated",r=>{e={},t={};const o=r.detail.mediaManager;console.log("reinitialize modals for media manager",o),_(),I("click",a),I("keydown",i),o.querySelectorAll("[data-media-modal]").forEach(u)})});document.addEventListener("DOMContentLoaded",()=>{const e=new WeakMap;function t(i){if(i.dataset.imageEditorInitialized)return;const a=i.querySelector("[data-image-editor-placeholder]");N(i,()=>{console.log("onClose");const o=e.get(i);o&&(o.remove(),e.delete(i))},()=>{if(console.log("onOpen"),e.has(i))return;let o={};try{const y=i.querySelector(".image-editor-modal-config");y&&(o=JSON.parse(y.value))}catch(y){console.error("Invalid or missing image-editor-modal-config:",y)}const E=i.dataset.mediumPath,b=i.dataset.mediumDisplayName,h=o.initiator_id,m=document.createElement("image-editor");m.id="my-image-editor",m.dataset.mediumDisplayName=b,m.dataset.mediumPath=E,m.dataset.initiatorId=h,m.addEventListener("imageEditorReady",y=>{u(y.detail)},{once:!0}),a.appendChild(m),e.set(i,m)}),i.dataset.imageEditorInitialized="true"}function u(i){const a=i.imageEditorInstance;if(!a)return;const L=a.dataset.initiatorId,r=a.dataset.mediumDisplayName,o=a.dataset.mediumPath;a.setImage(r,o,L),a.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:["16:9","4:3"],selectionAspectRatio:"16:9"})}function f(i){const a=i.target.closest("[data-image-editor-modal]");a&&T(a)}I("onImageUpdated",f),D(),document.querySelectorAll("[data-image-editor-modal]").forEach(t),document.addEventListener("mediaManagerPreviewsUpdated",i=>{const a=i.detail.mediaManager;a.querySelectorAll("[data-image-editor-modal]").forEach(t),console.log("reinitialized image editor modals for media manager",a)}),document.addEventListener("imageEditorModalCloseRequest",i=>{const a=i.detail.modal;console.log("imageEditorModalCloseRequest",a),T(a)})});F.translationsPath="/js/vendor/image-editor/lang";
