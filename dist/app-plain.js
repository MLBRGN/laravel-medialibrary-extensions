import"./image-editor-listener.js";import{a as U}from"./index.es.js";import"./xhrStatus.js";function C(e,t){const g=new CustomEvent(e,{bubbles:!0,detail:{element:t}});t.dispatchEvent(g)}function W(e){const t='a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])',g=()=>Array.from(e.querySelectorAll(t)).filter(a=>!a.hasAttribute("disabled")&&a.offsetParent!==null),v=a=>{const n=g();console.log(n);const d=n[0],o=n[n.length-1];if(a.key==="Tab"){if(n.length===0)return;a.shiftKey?document.activeElement===d&&(a.preventDefault(),o.focus()):document.activeElement===o&&(a.preventDefault(),d.focus())}};e.addEventListener("keydown",v),e._trapFocusHandler=v;const i=g();i.length&&i[0].focus()}function Y(e){e._trapFocusHandler&&(e.removeEventListener("keydown",e._trapFocusHandler),delete e._trapFocusHandler)}let R=!1;const q=new Map;function I(e,t){q.has(e)||q.set(e,new Set),q.get(e).add(t)}function H(e,t){if(q.has(e))for(const g of q.get(e))g(t)}function V(e){e.classList.remove("active"),e.setAttribute("aria-hidden","true"),document.body.style.overflow="",Y(e),C("modalClosed",e)}function N(e){console.log("openModal: ",e);const t=document.querySelector(e);if(!t){console.log("could not find modal "+e);return}t.classList.add("active"),t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",W(t),C("modalOpened",t)}function O(e,t=()=>{},g=()=>{}){e.addEventListener("modalOpened",g),e.addEventListener("modalClosed",t)}function x(e){const t=e.target,g=t.closest("[data-modal-trigger]");if(g){e.preventDefault();const a=g.getAttribute("data-modal-trigger");N(a);return}const v=t.closest("[data-modal-close]");if(v){const a=v.closest("[data-modal]");a&&V(a);return}const i=t.closest("[data-modal]");i&&t===i&&V(i)}function X(e){e.key==="Escape"&&document.querySelectorAll("[data-modal].active").forEach(V)}function D(){R||(document.addEventListener("click",e=>H("click",e)),document.addEventListener("keydown",e=>H("keydown",e)),R=!0),I("click",x),I("keydown",X)}function _(){q.clear(),D()}const T=new Map;function B(e){return T.get(e)}function z(e){T.has(e)&&(T.get(e).pause(),T.delete(e));const t=e.querySelectorAll(".media-carousel-item");if(!t.length)return;const g=e.querySelectorAll(".media-carousel-indicators button"),v=e.querySelector('[data-slide="prev"]'),i=e.querySelector('[data-slide="next"]'),a=e.getAttribute("data-carousel-ride")==="true",n=Number(e.getAttribute("data-carousel-ride-interval")??"5000"),d=e.getAttribute("data-carousel-ride-only-after-interaction")==="true";let o=0,u=!1,m=null,y=0,l=0,h=0,L=0;const r=50,f=(c,b="right")=>{t.forEach(M=>{M.classList.remove("active","slide-in-from-left","slide-in-from-right","slide-out-to-left","slide-out-to-right")});const w=t[o],P=t[c];e.getAttribute("data-carousel-effect")==="slide"&&(e.classList.contains("temp-no-animation")||e.classList.contains("no-animation")||(b==="right"?(P.classList.add("slide-in-from-right"),w.classList.add("slide-out-to-left")):(P.classList.add("slide-in-from-left"),w.classList.add("slide-out-to-right")),P.offsetWidth)),w.classList.remove("active"),P.classList.add("active"),g.forEach((M,F)=>M.classList.toggle("active",F===c)),o=c,C("carouselSlided",e)},s=(c,b=!1)=>{if(c===o)return;const w=(c+t.length)%t.length,M=(w-o+t.length)%t.length>t.length/2?"left":"right";b&&(e.classList.add("temp-no-animation"),e.offsetWidth),f(w,M),b&&e.classList.remove("temp-no-animation")},p=()=>{const b=l-y;Math.abs(b)>40&&Math.abs(b)>Math.abs(L-h)&&(b<0?s((o+1)%t.length):s((o-1+t.length)%t.length),S()),y=l=h=L=0},E=()=>{A(),m=setInterval(()=>s((o+1)%t.length),n)},A=()=>{m!==null&&(clearInterval(m),m=null)},S=()=>{u||(u=!0,a&&d&&E()),a&&!d&&E()};g.forEach((c,b)=>c.addEventListener("click",()=>{s(b),S()})),v==null||v.addEventListener("click",()=>{s((o-1+t.length)%t.length),S()}),i==null||i.addEventListener("click",()=>{s((o+1)%t.length),S()}),e.addEventListener("mouseenter",A),e.addEventListener("mouseleave",()=>{a&&(!d||u)&&E()}),e.addEventListener("focusin",A),e.addEventListener("focusout",()=>{a&&(!d||u)&&E()}),e.addEventListener("keydown",c=>{c.key==="ArrowLeft"?(c.preventDefault(),s((o-1+t.length)%t.length),S()):c.key==="ArrowRight"&&(c.preventDefault(),s((o+1)%t.length),S())}),e.addEventListener("touchstart",c=>{y=c.changedTouches[0].screenX,h=c.changedTouches[0].screenY},{passive:!0}),e.addEventListener("touchend",c=>{l=c.changedTouches[0].screenX,L=c.changedTouches[0].screenY,Math.abs(L-h)<r&&p()},{passive:!0}),t.length>1&&a&&!d&&E();const k={goToSlide:(c,b=!1)=>s(c,b),getCurrentIndex:()=>o,goToNextSlide:()=>s((o+1)%t.length),goToPreviousSlide:()=>s((o-1+t.length)%t.length),pause:A,resume:E};T.set(e,k)}document.addEventListener("mediaManagerPreviewsUpdated",e=>{e.detail.mediaManager,document.querySelectorAll("[data-carousel]").forEach(z)});document.querySelectorAll("[data-carousel]").forEach(z);document.addEventListener("DOMContentLoaded",()=>{let e={};function t(n){const d=n.querySelector("[data-carousel]"),o=n.hasAttribute("data-video-autoplay");n.id,console.log("autoPlay",o),O(n,L,()=>{if(!o)return;const r=n.querySelector(".media-carousel-item.active"),f=r==null?void 0:r.querySelector(".media-video-container[data-youtube-video-id]");if(console.log("activeSlide",r),console.log("videoWrapper",f),f){console.log("startVideoPlayBack");const s=n.id,p=f.getAttribute("data-youtube-video-id"),E=s+"-"+p;l(E)}}),d==null||d.addEventListener("carouselSlided",()=>{if(console.log("carouselSlided, pause videos"),h(),console.log("autoPlay"),!o)return;const r=d.querySelector(".media-carousel-item.active"),f=r==null?void 0:r.querySelector(".media-video-container[data-youtube-video-id]");if(f){console.log("startVideoPlayBack");const s=n.id,p=f.getAttribute("data-youtube-video-id"),E=s+"-"+p;l(E)}});function u(r,f="playVideo",s=0,p=10,E=200){const A={playVideo:"playVideo",pauseVideo:"pauseVideo",stopVideo:"stopVideo"},S=A[f];if(!A[f]){console.warn(`Unknown action: ${f}`);return}const k=e[r];if(!k||!k.isReady){console.log("No player, or player not ready yet",r,"player",k,"playerIsReady",k==null?void 0:k.isReady),s<p&&setTimeout(()=>u(r,f,s+1,p,E*1.2),E);return}S&&k[S]()}function m(r,f=0,s=10,p=200){u(r,"pauseVideo",f,s,p)}function y(r,f=0,s=10,p=200){u(r,"stopVideo",f,s,p)}function l(r,f=0,s=10,p=200){u(r,"playVideo",f,s,p)}function h(){Object.keys(e).forEach(r=>m(r,0,10,200))}function L(){Object.keys(e).forEach(r=>y(r,0,10,200))}}function g(){D()}function v(n){const d=n.target.closest("[data-media-modal].active");if(!d)return;const o=B(d.querySelector("[data-carousel]"));if(!o)return;const u=d.querySelector("[data-carousel]").contains(n.target);(n.key==="ArrowLeft"||n.key==="ArrowRight")&&u||(n.key==="ArrowLeft"?o.goToPreviousSlide():n.key==="ArrowRight"&&o.goToNextSlide())}function i(n){const d=n.target.closest("[data-modal-trigger]");if(!d)return;const o=d.getAttribute("data-modal-trigger"),u=parseInt(d.getAttribute("data-slide-to")||"0",10);console.log("slideTo",u),N(o);const m=document.querySelector(o),y=m==null?void 0:m.querySelector("[data-carousel]");console.log("modal",m),console.log("carousel",y);const l=B(y);console.log("controller",l),l&&l.goToSlide(u,!0)}function a(n){var L;const d=n.target.closest("[data-media-modal]");if(!d)return;const o=d.id,u=n.target.closest("[data-youtube-video-id]"),m=u==null?void 0:u.getAttribute("data-youtube-video-id");if(!m)return;const y=o+"-"+m;if(e[y])return;const l=u.querySelector("lite-youtube"),h=(L=l==null?void 0:l.shadowRoot)==null?void 0:L.querySelector("iframe");h&&(e[y]=new YT.Player(h,{events:{onReady:r=>{console.log("player ready",y),e[y].isReady=!0}}}))}I("click",i),I("keydown",v),document.addEventListener("liteYoutubeIframeLoaded",a),g(),document.querySelectorAll("[data-media-modal]").forEach(t),document.addEventListener("mediaManagerPreviewsUpdated",n=>{e={};const d=n.detail.mediaManager;console.log("reinitialize modals for media manager",d),_(),I("click",i),I("keydown",v),d.querySelectorAll("[data-media-modal]").forEach(t)})});document.addEventListener("DOMContentLoaded",()=>{const e=new WeakMap;function t(i){if(i.dataset.imageEditorInitialized)return;const a=i.querySelector("[data-image-editor-placeholder]");O(i,()=>{const o=e.get(i);o&&(o.remove(),e.delete(i))},()=>{if(e.has(i))return;let o={};try{const h=i.querySelector(".image-editor-modal-config");h&&(o=JSON.parse(h.value))}catch(h){console.error("Invalid or missing image-editor-modal-config:",h)}const u=i.dataset.mediumPath,m=i.dataset.mediumDisplayName,y=o.initiator_id,l=document.createElement("image-editor");l.id="my-image-editor",l.dataset.mediumDisplayName=m,l.dataset.mediumPath=u,l.dataset.initiatorId=y,l.addEventListener("imageEditorReady",h=>{g(h.detail)},{once:!0}),a.appendChild(l),e.set(i,l)}),i.dataset.imageEditorInitialized="true"}function g(i){const a=i.imageEditorInstance;if(!a)return;const n=a.dataset.initiatorId,d=a.dataset.mediumDisplayName,o=a.dataset.mediumPath;a.setImage(d,o,n),a.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:["16:9","4:3"],selectionAspectRatio:"16:9"})}function v(i){const a=i.target.closest("[data-image-editor-modal]");a&&V(a)}I("onImageUpdated",v),D(),document.querySelectorAll("[data-image-editor-modal]").forEach(t),document.addEventListener("mediaManagerPreviewsUpdated",i=>{const a=i.detail.mediaManager;a.querySelectorAll("[data-image-editor-modal]").forEach(t),console.log("reinitialized image editor modals for media manager",a)})});U.translationsPath="/js/vendor/image-editor/lang";
