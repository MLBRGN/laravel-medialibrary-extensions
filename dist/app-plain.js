import"./image-editor-listener.js";import{a as z}from"./index.es.js";import"./xhrStatus.js";function I(e,t){const n=new CustomEvent(e,{bubbles:!0,detail:{element:t}});t.dispatchEvent(n)}function Y(e){const t='a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])',n=()=>Array.from(e.querySelectorAll(t)).filter(a=>!a.hasAttribute("disabled")&&a.offsetParent!==null),i=a=>{const d=n();console.log(d);const c=d[0],r=d[d.length-1];if(a.key==="Tab"){if(d.length===0)return;a.shiftKey?document.activeElement===c&&(a.preventDefault(),r.focus()):document.activeElement===r&&(a.preventDefault(),c.focus())}};e.addEventListener("keydown",i),e._trapFocusHandler=i;const o=n();o.length&&o[0].focus()}function _(e){e._trapFocusHandler&&(e.removeEventListener("keydown",e._trapFocusHandler),delete e._trapFocusHandler)}const T=new Map;function C(e){return T.get(e)}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-carousel]").forEach(e=>{const t=e.querySelectorAll(".media-carousel-item"),n=e.querySelectorAll(".media-carousel-indicators button"),i=e.querySelector('[data-slide="prev"]'),o=e.querySelector('[data-slide="next"]'),a=e.getAttribute("data-carousel-ride")==="true",d=Number(e.getAttribute("data-carousel-ride-interval")??"5000"),c=e.getAttribute("data-carousel-ride-only-after-interaction")==="true";let r=0,l=!1,b=null,k=0,q=0,A=0,S=0;const P=50,F=(s,u="right")=>{t.forEach(v=>{v.classList.remove("active","slide-in-from-left","slide-in-from-right","slide-out-to-left","slide-out-to-right")});const h=t[r],p=t[s];e.getAttribute("data-carousel-effect")==="slide"&&(e.classList.contains("temp-no-animation")||e.classList.contains("no-animation")||(u==="right"?(p.classList.add("slide-in-from-right"),h.classList.add("slide-out-to-left")):(p.classList.add("slide-in-from-left"),h.classList.add("slide-out-to-right")),p.offsetWidth)),h.classList.remove("active"),p.classList.add("active"),n.forEach((v,x)=>v.classList.toggle("active",x===s)),r=s,I("carouselSlided",e)},f=(s,u=!1)=>{if(s===r)return;const h=(s+t.length)%t.length,v=(h-r+t.length)%t.length>t.length/2?"left":"right";u&&e.classList.add("temp-no-animation"),F(h,v),u&&setTimeout(()=>{e.classList.remove("temp-no-animation")},1e3)},V=()=>{const u=q-k;Math.abs(u)>40&&Math.abs(u)>Math.abs(S-A)&&(u<0?f((r+1)%t.length):f((r-1+t.length)%t.length),m())},g=()=>{E(),b=setInterval(()=>{f((r+1)%t.length)},d)},E=()=>{b!==null&&(clearInterval(b),b=null)},m=()=>{l||(l=!0,a&&c&&g()),a&&!c&&g()};n.forEach((s,u)=>{s.addEventListener("click",()=>{f(u),m()})}),i==null||i.addEventListener("click",()=>{f((r-1+t.length)%t.length),m()}),o==null||o.addEventListener("click",()=>{f((r+1)%t.length),m()}),e.addEventListener("mouseenter",E),e.addEventListener("mouseleave",()=>{a&&(!c||l)&&g()}),e.addEventListener("focusin",E),e.addEventListener("focusout",()=>{a&&(!c||l)&&g()}),e.addEventListener("keydown",s=>{s.key==="ArrowLeft"?(s.preventDefault(),f((r-1+t.length)%t.length),m()):s.key==="ArrowRight"&&(s.preventDefault(),f((r+1)%t.length),m())}),e.addEventListener("touchstart",s=>{k=s.changedTouches[0].screenX,A=s.changedTouches[0].screenY},{passive:!0}),e.addEventListener("touchend",s=>{q=s.changedTouches[0].screenX,S=s.changedTouches[0].screenY,Math.abs(S-A)<P&&V()},{passive:!0}),t.length>1&&a&&!c&&g();const w={goToSlide:(s,u=!1)=>f(s,u),getCurrentIndex:()=>r,goToNextSlide:()=>f((r+1)%t.length),goToPreviousSlide:()=>f((r-1+t.length)%t.length),pause:E,resume:g};T.set(e,w),e._carouselController=w})});function y(e){e.classList.remove("active"),e.setAttribute("aria-hidden","true"),document.body.style.overflow="",_(e),I("modalClosed",e)}function D(e){console.log("openModal: ",e);const t=document.querySelector(e);if(!t){debugger;console.log("could not find modal"+e);return}t.classList.add("active"),t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",Y(t),I("modalOpened",t)}function R(e,t=()=>{},n=()=>{}){e.addEventListener("modalOpened",n),e.addEventListener("modalClosed",t)}function O(){document.addEventListener("click",e=>{e.stopPropagation();const t=e.target;console.log("target",t);const n=t.closest("[data-modal-trigger]");if(n){e.preventDefault();const a=n.getAttribute("data-modal-trigger");D(a);return}const i=t.closest("[data-modal-close]");if(i){const a=i.closest("[data-modal]");a&&y(a);return}else console.log("no close button");const o=t.closest("[data-modal]");o&&t===o&&y(o)}),document.addEventListener("keydown",e=>{e.key==="Escape"&&document.querySelectorAll("[data-modal].active").forEach(y)})}const L={};function B(){Object.values(L).forEach(e=>e.stopVideo())}function N(){Object.values(L).forEach(e=>e.pauseVideo())}function M(e){const t=L[e];t&&t.playVideo()}function H(e){const t=e.querySelector("[data-carousel]"),n=e.hasAttribute("data-video-autoplay");R(e,B,()=>{if(!n)return;const i=e.querySelector(".media-carousel-item.active"),o=i==null?void 0:i.querySelector(".media-video-container[data-youtube-video-id]");o&&M(o.getAttribute("data-youtube-video-id"))}),e.addEventListener("keydown",i=>{if(!e.classList.contains("active"))return;const o=C(e.querySelector("[data-carousel]"));if(!o)return;const a=e.querySelector("[data-carousel]").contains(i.target);if(i.key==="Escape"){y(e),i.preventDefault();return}(i.key==="ArrowLeft"||i.key==="ArrowRight")&&a||(i.key==="ArrowLeft"?o.goToPreviousSlide():i.key==="ArrowRight"&&o.goToNextSlide())}),t==null||t.addEventListener("carouselSlided",()=>{if(N(),!n)return;const i=t.querySelector(".media-carousel-item.active"),o=i==null?void 0:i.querySelector(".media-video-container[data-youtube-video-id]");o&&M(o.getAttribute("data-youtube-video-id"))}),e.addEventListener("liteYoutubeIframeLoaded",i=>{var c,r;const o=i.target.closest("[data-youtube-video-id]"),a=o==null?void 0:o.getAttribute("data-youtube-video-id"),d=(r=(c=o==null?void 0:o.querySelector("lite-youtube"))==null?void 0:c.shadowRoot)==null?void 0:r.querySelector("iframe");a&&d&&(L[a]=new YT.Player(d))})}function X(){O(),document.addEventListener("click",e=>{const t=e.target.closest("[data-modal-trigger]");if(t){const n=t.getAttribute("data-modal-trigger"),i=parseInt(t.getAttribute("data-slide-to")||"0",10);console.log("modalId",n,"slideTo",i);const o=document.querySelector(n);D(n);const a=o==null?void 0:o.querySelector("[data-carousel]"),d=C(a);d?d.goToSlide(i,!0):console.log("no controller");return}})}document.addEventListener("DOMContentLoaded",()=>{X(),document.querySelectorAll("[data-media-modal]").forEach(H)});function j(e){if(e.dataset.imageEditorInitialized)return;const t=e.querySelector("#image-editor-placeholder");let n=null;R(e,()=>{n&&(n.remove(),n=null)},()=>{if(n)return;let a={};try{const l=e.querySelector(".image-editor-modal-config");l&&(a=JSON.parse(l.value))}catch(l){console.error("Invalid or missing image-editor-modal-config:",l)}const d=e.getAttribute("data-medium-path"),c=e.getAttribute("data-medium-display-name"),r=a.initiator_id;n=document.createElement("image-editor"),n.setAttribute("id","my-image-editor"),n.setAttribute("data-medium-display-name",c),n.setAttribute("data-medium-path",d),n.setAttribute("data-initiator-id",r),n.addEventListener("imageEditorReady",l=>{console.log("imageEditorReady",l),W(l.detail)},{once:!0}),t.appendChild(n),e.addEventListener("onImageUpdated",l=>{console.log("onImageUpdated",l),y(e)})}),e.dataset.imageEditorInitialized="true"}document.addEventListener("DOMContentLoaded",()=>{O(),document.querySelectorAll("[data-image-editor-modal]").forEach(j)});function W(e){const t=e.imageEditorInstance;console.log("initializeImageEditorModal",e,"imageEditorInstance",t);const n=t.getAttribute("data-initiator-id"),i=t.getAttribute("data-medium-display-name"),o=t.getAttribute("data-medium-path");console.log("imageEditor.setImage(",i,",",o,",",n,")"),t.setImage(i,o,n),t.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:["16:9","4:3"],selectionAspectRatio:"16:9"})}z.translationsPath="/js/vendor/image-editor/lang";
