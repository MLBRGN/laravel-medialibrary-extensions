import"./image-editor-listener.js";import{a as x}from"./index.es.js";import"./xhrStatus.js";function T(e,t){const u=new CustomEvent(e,{bubbles:!0,detail:{element:t}});t.dispatchEvent(u)}function B(e){const t='a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])',u=()=>Array.from(e.querySelectorAll(t)).filter(a=>!a.hasAttribute("disabled")&&a.offsetParent!==null),f=a=>{const m=u();console.log(m);const g=m[0],r=m[m.length-1];if(a.key==="Tab"){if(m.length===0)return;a.shiftKey?document.activeElement===g&&(a.preventDefault(),r.focus()):document.activeElement===r&&(a.preventDefault(),g.focus())}};e.addEventListener("keydown",f),e._trapFocusHandler=f;const o=u();o.length&&o[0].focus()}function U(e){e._trapFocusHandler&&(e.removeEventListener("keydown",e._trapFocusHandler),delete e._trapFocusHandler)}let D=!1;const w=new Map;function E(e,t){w.has(e)||w.set(e,new Set),w.get(e).add(t)}function P(e,t){if(w.has(e))for(const u of w.get(e))u(t)}function q(e){e.classList.remove("active"),e.setAttribute("aria-hidden","true"),document.body.style.overflow="",U(e),T("modalClosed",e)}function R(e){console.log("openModal: ",e);const t=document.querySelector(e);if(!t){console.log("could not find modal "+e);return}t.classList.add("active"),t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",B(t),T("modalOpened",t)}function O(e,t=()=>{},u=()=>{}){e.addEventListener("modalOpened",u),e.addEventListener("modalClosed",t)}function W(e){const t=e.target,u=t.closest("[data-modal-trigger]");if(u){e.preventDefault();const a=u.getAttribute("data-modal-trigger");R(a);return}const f=t.closest("[data-modal-close]");if(f){const a=f.closest("[data-modal]");a&&q(a);return}const o=t.closest("[data-modal]");o&&t===o&&q(o)}function X(e){e.key==="Escape"&&document.querySelectorAll("[data-modal].active").forEach(q)}function C(){D||(document.addEventListener("click",e=>P("click",e)),document.addEventListener("keydown",e=>P("keydown",e)),D=!0),E("click",W),E("keydown",X)}function _(){w.clear(),C()}const M=new Map;function H(e){return M.get(e)}function N(e){M.has(e)&&(M.get(e).pause(),M.delete(e));const t=e.querySelectorAll(".media-carousel-item");if(!t.length)return;const u=e.querySelectorAll(".media-carousel-indicators button"),f=e.querySelector('[data-slide="prev"]'),o=e.querySelector('[data-slide="next"]'),a=e.getAttribute("data-carousel-ride")==="true",m=Number(e.getAttribute("data-carousel-ride-interval")??"5000"),g=e.getAttribute("data-carousel-ride-only-after-interaction")==="true";let r=0,n=!1,d=null,l=0,i=0,s=0,y=0;const p=50,z=(c,h="right")=>{t.forEach(S=>{S.classList.remove("active","slide-in-from-left","slide-in-from-right","slide-out-to-left","slide-out-to-right")});const A=t[r],k=t[c];e.getAttribute("data-carousel-effect")==="slide"&&(e.classList.contains("temp-no-animation")||e.classList.contains("no-animation")||(h==="right"?(k.classList.add("slide-in-from-right"),A.classList.add("slide-out-to-left")):(k.classList.add("slide-in-from-left"),A.classList.add("slide-out-to-right")),k.offsetWidth)),A.classList.remove("active"),k.classList.add("active"),u.forEach((S,Y)=>S.classList.toggle("active",Y===c)),r=c,T("carouselSlided",e)},v=(c,h=!1)=>{if(c===r)return;const A=(c+t.length)%t.length,S=(A-r+t.length)%t.length>t.length/2?"left":"right";h&&(e.classList.add("temp-no-animation"),e.offsetWidth),z(A,S),h&&e.classList.remove("temp-no-animation")},F=()=>{const h=i-l;Math.abs(h)>40&&Math.abs(h)>Math.abs(y-s)&&(h<0?v((r+1)%t.length):v((r-1+t.length)%t.length),L()),l=i=s=y=0},b=()=>{I(),d=setInterval(()=>v((r+1)%t.length),m)},I=()=>{d!==null&&(clearInterval(d),d=null)},L=()=>{n||(n=!0,a&&g&&b()),a&&!g&&b()};u.forEach((c,h)=>c.addEventListener("click",()=>{v(h),L()})),f==null||f.addEventListener("click",()=>{v((r-1+t.length)%t.length),L()}),o==null||o.addEventListener("click",()=>{v((r+1)%t.length),L()}),e.addEventListener("mouseenter",I),e.addEventListener("mouseleave",()=>{a&&(!g||n)&&b()}),e.addEventListener("focusin",I),e.addEventListener("focusout",()=>{a&&(!g||n)&&b()}),e.addEventListener("keydown",c=>{c.key==="ArrowLeft"?(c.preventDefault(),v((r-1+t.length)%t.length),L()):c.key==="ArrowRight"&&(c.preventDefault(),v((r+1)%t.length),L())}),e.addEventListener("touchstart",c=>{l=c.changedTouches[0].screenX,s=c.changedTouches[0].screenY},{passive:!0}),e.addEventListener("touchend",c=>{i=c.changedTouches[0].screenX,y=c.changedTouches[0].screenY,Math.abs(y-s)<p&&F()},{passive:!0}),t.length>1&&a&&!g&&b();const V={goToSlide:(c,h=!1)=>v(c,h),getCurrentIndex:()=>r,goToNextSlide:()=>v((r+1)%t.length),goToPreviousSlide:()=>v((r-1+t.length)%t.length),pause:I,resume:b};M.set(e,V)}document.addEventListener("mediaManagerPreviewsUpdated",e=>{e.detail.mediaManager,document.querySelectorAll("[data-carousel]").forEach(N)});document.querySelectorAll("[data-carousel]").forEach(N);document.addEventListener("DOMContentLoaded",()=>{let e={};function t(){Object.values(e).forEach(n=>n.stopVideo())}function u(){Object.values(e).forEach(n=>n.pauseVideo())}function f(n){const d=e[n];d&&d.playVideo()}function o(n){const d=n.querySelector("[data-carousel]"),l=n.hasAttribute("data-video-autoplay");O(n,t,()=>{if(!l)return;const i=n.querySelector(".media-carousel-item.active"),s=i==null?void 0:i.querySelector(".media-video-container[data-youtube-video-id]");s&&f(s.getAttribute("data-youtube-video-id"))}),d==null||d.addEventListener("carouselSlided",()=>{if(u(),!l)return;const i=d.querySelector(".media-carousel-item.active"),s=i==null?void 0:i.querySelector(".media-video-container[data-youtube-video-id]");s&&f(s.getAttribute("data-youtube-video-id"))})}function a(){C()}function m(n){const d=n.target.closest("[data-media-modal].active");if(!d)return;const l=H(d.querySelector("[data-carousel]"));if(!l)return;const i=d.querySelector("[data-carousel]").contains(n.target);(n.key==="ArrowLeft"||n.key==="ArrowRight")&&i||(n.key==="ArrowLeft"?l.goToPreviousSlide():n.key==="ArrowRight"&&l.goToNextSlide())}function g(n){const d=n.target.closest("[data-modal-trigger]");if(!d)return;const l=d.getAttribute("data-modal-trigger"),i=parseInt(d.getAttribute("data-slide-to")||"0",10);console.log("slideTo",i),R(l);const s=document.querySelector(l),y=s==null?void 0:s.querySelector("[data-carousel]");console.log("modal",s),console.log("carousel",y);const p=H(y);console.log("controller",p),p&&p.goToSlide(i,!0)}function r(n){var y,p;if(!n.target.closest("[data-media-modal]"))return;const l=n.target.closest("[data-youtube-video-id]"),i=l==null?void 0:l.getAttribute("data-youtube-video-id"),s=(p=(y=l==null?void 0:l.querySelector("lite-youtube"))==null?void 0:y.shadowRoot)==null?void 0:p.querySelector("iframe");i&&s&&!e[i]&&(e[i]=new YT.Player(s))}E("click",g),E("keydown",m),document.addEventListener("liteYoutubeIframeLoaded",r),a(),document.querySelectorAll("[data-media-modal]").forEach(o),document.addEventListener("mediaManagerPreviewsUpdated",n=>{e={};const d=n.detail.mediaManager;console.log("reinitialize modals for media manager",d),_(),E("click",g),E("keydown",m),d.querySelectorAll("[data-media-modal]").forEach(o)})});document.addEventListener("DOMContentLoaded",()=>{const e=new WeakMap;function t(o){if(o.dataset.imageEditorInitialized)return;const a=o.querySelector("[data-image-editor-placeholder]");O(o,()=>{const r=e.get(o);r&&(r.remove(),e.delete(o))},()=>{if(e.has(o))return;let r={};try{const s=o.querySelector(".image-editor-modal-config");s&&(r=JSON.parse(s.value))}catch(s){console.error("Invalid or missing image-editor-modal-config:",s)}const n=o.dataset.mediumPath,d=o.dataset.mediumDisplayName,l=r.initiator_id,i=document.createElement("image-editor");i.id="my-image-editor",i.dataset.mediumDisplayName=d,i.dataset.mediumPath=n,i.dataset.initiatorId=l,i.addEventListener("imageEditorReady",s=>{u(s.detail)},{once:!0}),a.appendChild(i),e.set(o,i)}),o.dataset.imageEditorInitialized="true"}function u(o){const a=o.imageEditorInstance;if(!a)return;const m=a.dataset.initiatorId,g=a.dataset.mediumDisplayName,r=a.dataset.mediumPath;a.setImage(g,r,m),a.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:["16:9","4:3"],selectionAspectRatio:"16:9"})}function f(o){const a=o.target.closest("[data-image-editor-modal]");a&&q(a)}E("onImageUpdated",f),C(),document.querySelectorAll("[data-image-editor-modal]").forEach(t),document.addEventListener("mediaManagerPreviewsUpdated",o=>{const a=o.detail.mediaManager;a.querySelectorAll("[data-image-editor-modal]").forEach(t),console.log("reinitialized image editor modals for media manager",a)})});x.translationsPath="/js/vendor/image-editor/lang";
