import"./image-fallback.js";import"./image-editor-listener.js";import{a as z}from"./index.es.js";import"./xhrStatus.js";function V(e,t,u){const f=new CustomEvent(e,{bubbles:!0,detail:u});t.dispatchEvent(f)}function U(e){const t='a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])',u=()=>Array.from(e.querySelectorAll(t)).filter(i=>!i.hasAttribute("disabled")&&i.offsetParent!==null),f=i=>{const L=u(),r=L[0],a=L[L.length-1];if(i.key==="Tab"){if(L.length===0)return;i.shiftKey?document.activeElement===r&&(i.preventDefault(),a.focus()):document.activeElement===a&&(i.preventDefault(),r.focus())}};e.addEventListener("keydown",f),e._trapFocusHandler=f;const o=u();o.length&&o[0].focus()}function j(e){e._trapFocusHandler&&(e.removeEventListener("keydown",e._trapFocusHandler),delete e._trapFocusHandler)}let O=!1;const T=new Map;function A(e,t){T.has(e)||T.set(e,new Set),T.get(e).add(t)}function N(e,t){if(T.has(e))for(const u of T.get(e))u(t)}function D(e,t){e.classList.remove("active"),e.setAttribute("aria-hidden","true"),document.body.style.overflow="initial",j(e),V("mleModalClosed",e,{modal:e,originalEvent:t})}function B(e,t,u){const f=document.querySelector(e);f&&(f.classList.add("active"),f.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",U(f),V("mleModalOpened",f,{modal:f,trigger:t,originalEvent:u}))}function F(e,t=()=>{},u=()=>{}){e.addEventListener("mleModalOpened",u),e.addEventListener("mleModalClosed",t)}function X(e){e.stopPropagation();const t=e.target,u=t.closest("[data-modal-trigger]");if(u){e.preventDefault();const i=u.getAttribute("data-modal-trigger");B(i,u,e);return}const f=t.closest("[data-modal-close]");if(f){const i=f.closest("[data-modal]");i&&D(i,e);return}const o=t.closest("[data-modal]");o&&t===o&&D(o,e)}function _(e){e.key==="Escape"&&document.querySelectorAll("[data-modal].active").forEach(D)}function H(){O||(document.addEventListener("click",e=>N("click",e)),document.addEventListener("keydown",e=>N("keydown",e)),O=!0),A("click",X),A("keydown",_)}function K(){T.clear(),H()}const P=new Map;function R(e){return P.get(e)}function Y(e){P.has(e)&&(P.get(e).pause(),P.delete(e));const t=e.querySelectorAll(".media-carousel-item");if(!t.length)return;const u=e.querySelectorAll(".media-carousel-indicators button"),f=e.querySelector('[data-slide="prev"]'),o=e.querySelector('[data-slide="next"]'),i=e.getAttribute("data-carousel-ride")==="true",L=Number(e.getAttribute("data-carousel-ride-interval")??"5000"),r=e.getAttribute("data-carousel-ride-only-after-interaction")==="true";let a=0,y=!1,v=null,h=0,g=0,m=0,n=0;const l=50,c=(s,p="right",I=!1)=>{t.forEach(q=>{q.classList.remove("active","slide-in-from-left","slide-in-from-right","slide-out-to-left","slide-out-to-right")});const k=t[a],w=t[s];e.getAttribute("data-carousel-effect")==="slide"&&(e.classList.contains("temp-no-animation")||e.classList.contains("no-animation")||(p==="right"?(w.classList.add("slide-in-from-right"),k.classList.add("slide-out-to-left")):(w.classList.add("slide-in-from-left"),k.classList.add("slide-out-to-right")),w.offsetWidth)),k.classList.remove("active"),w.classList.add("active"),u.forEach((q,x)=>q.classList.toggle("active",x===s)),a=s,V("mleCarouselSlided",e,{carousel:e,currentSlide:w,currentSlideIndex:a})},d=(s,p=!1,I=!1)=>{if(s===a)return;const k=(s+t.length)%t.length,q=(k-a+t.length)%t.length>t.length/2?"left":"right";p&&(e.classList.add("temp-no-animation"),e.offsetWidth),c(k,q,I),p&&e.classList.remove("temp-no-animation")},M=()=>{const p=g-h;Math.abs(p)>40&&Math.abs(p)>Math.abs(n-m)&&(p<0?d((a+1)%t.length):d((a-1+t.length)%t.length),S()),h=g=m=n=0},E=()=>{b(),v=setInterval(()=>d((a+1)%t.length),L)},b=()=>{v!==null&&(clearInterval(v),v=null)},S=()=>{y||(y=!0,i&&r&&E()),i&&!r&&E()};u.forEach((s,p)=>s.addEventListener("click",()=>{d(p),S()})),f==null||f.addEventListener("click",()=>{d((a-1+t.length)%t.length),S()}),o==null||o.addEventListener("click",()=>{d((a+1)%t.length),S()}),e.addEventListener("mouseenter",b),e.addEventListener("mouseleave",()=>{i&&(!r||y)&&E()}),e.addEventListener("focusin",b),e.addEventListener("focusout",()=>{i&&(!r||y)&&E()}),e.addEventListener("keydown",s=>{s.key==="ArrowLeft"?(s.preventDefault(),d((a-1+t.length)%t.length),S()):s.key==="ArrowRight"&&(s.preventDefault(),d((a+1)%t.length),S())}),e.addEventListener("touchstart",s=>{h=s.changedTouches[0].screenX,m=s.changedTouches[0].screenY},{passive:!0}),e.addEventListener("touchend",s=>{g=s.changedTouches[0].screenX,n=s.changedTouches[0].screenY,Math.abs(n-m)<l&&M()},{passive:!0}),t.length>1&&i&&!r&&E();const C={goToSlide:(s,p=!1,I=!1)=>d(s,p,I),getCurrentSlideIndex:()=>a,goToNextSlide:()=>d((a+1)%t.length),goToPreviousSlide:()=>d((a-1+t.length)%t.length),pause:b,resume:E};P.set(e,C)}document.addEventListener("mediaManagerPreviewsUpdated",e=>{e.detail.mediaManager,document.querySelectorAll("[data-carousel]").forEach(Y)});document.querySelectorAll("[data-carousel]").forEach(Y);document.addEventListener("DOMContentLoaded",()=>{let e={},t={};function u(r){const a=r.querySelector("[data-carousel]");F(r),r.addEventListener("mleModalOpened",n=>{const l=n.detail.trigger;if(!l)return;const c=n.detail.modal;if(!c)return;const d=c.id;if(!c.hasAttribute("data-autoplay"))return;const E=c.querySelector("[data-carousel]");if(!E)return;const b=E.querySelector(".media-carousel-item:first-child");if(!b)return;if(parseInt(l.getAttribute("data-slide-to")||"0",10)===0){const C=y(b);v(C,"play");const s=b.querySelector("[data-mle-youtube-video]");if(s){const p=s.getAttribute("data-youtube-video-id"),I=`${d}-${p}`;p&&h(I,"playVideo")}}}),r.addEventListener("mleModalClosed",n=>{m();const l=n.detail.modal,c=R(l.querySelector("[data-carousel]"));c&&(c.goToSlide(0,!0,!0),m())});function y(n){const l=n.querySelector("audio"),c=n.querySelector("video");let d=null;return l&&(d=l.id,t[d]=l),c&&(d=c.id,t[d]=c),d}a==null||a.addEventListener("mleCarouselSlided",n=>{const l=n.detail.carousel,c=n.detail.currentSlide,d=l.closest("[data-modal]"),M=d.hasAttribute("data-autoplay");if(!M||(g(),!M))return;const E=y(c);v(E,"play");const b=c.querySelector("[data-mle-youtube-video]");if(b){const S=d.id,C=b.getAttribute("data-youtube-video-id"),s=S+"-"+C;h(s,"playVideo")}});function v(n,l){const c=t[n];if(c)try{l==="play"?c.play():l==="pause"&&c.pause()}catch(d){console.warn(`Failed to ${l} media:`,d)}}function h(n,l="playVideo",c=0,d=10,M=200){const E={playVideo:"playVideo",pauseVideo:"pauseVideo",stopVideo:"stopVideo"},b=E[l];if(!E[l]){console.warn(`Unknown action: ${l}`);return}const S=e[n];if(!S||!S.isReady){c<d&&setTimeout(()=>h(n,l,c+1,d,M*1.2),M);return}b&&S[b]()}function g(){Object.keys(e).forEach(n=>h(n,"pauseVideo")),Object.keys(t).forEach(n=>v(n,"pause"))}function m(){Object.keys(e).forEach(n=>h(n,"stopVideo")),Object.keys(t).forEach(n=>v(n,"pause"))}}function f(){H()}function o(r){const a=r.target.closest("[data-media-modal].active");if(!a)return;const y=R(a.querySelector("[data-carousel]"));if(!y)return;const v=a.querySelector("[data-carousel]").contains(r.target);(r.key==="ArrowLeft"||r.key==="ArrowRight")&&v||(r.key==="ArrowLeft"?y.goToPreviousSlide():r.key==="ArrowRight"&&y.goToNextSlide())}function i(r){const a=r.target.closest("[data-modal-trigger]");if(!a)return;const y=a.getAttribute("data-modal-trigger"),v=parseInt(a.getAttribute("data-slide-to")||"0",10),h=document.querySelector(y),g=h==null?void 0:h.querySelector("[data-carousel]"),m=R(g);m&&m.goToSlide(v,!0)}function L(r){var n,l;const a=r.target.closest("[data-youtube-video-id]");if(!a)return;const y=a.closest("[data-modal]");if(!y)return;const v=y.id,h=a.getAttribute("data-youtube-video-id");if(!h)return;const g=v+"-"+h;if(e[g])return;const m=(l=(n=a.querySelector("lite-youtube"))==null?void 0:n.shadowRoot)==null?void 0:l.querySelector("iframe");m&&(e[g]=new YT.Player(m,{events:{onReady:()=>e[g].isReady=!0}}))}A("click",i),A("keydown",o),document.addEventListener("liteYoutubeIframeLoaded",L),f(),document.querySelectorAll("[data-media-modal]").forEach(u),document.addEventListener("mediaManagerPreviewsUpdated",r=>{e={},t={};const a=r.detail.mediaManager;K(),A("click",i),A("keydown",o),a.querySelectorAll("[data-media-modal]").forEach(u)})});document.addEventListener("DOMContentLoaded",()=>{const e=new WeakMap;function t(o){if(o.dataset.imageEditorInitialized)return;const i=o.querySelector("[data-image-editor-placeholder]");F(o,()=>{const a=e.get(o);a&&(a.remove(),e.delete(o))},()=>{if(e.has(o))return;let a={};try{const m=o.querySelector(".image-editor-modal-config");m&&(a=JSON.parse(m.value))}catch(m){console.error("Invalid or missing image-editor-modal-config:",m)}const y=o.dataset.mediumPath,v=o.dataset.mediumDisplayName,h=a.initiator_id,g=document.createElement("image-editor");g.id="my-image-editor",g.dataset.mediumDisplayName=v,g.dataset.mediumPath=y,g.dataset.initiatorId=h,g.addEventListener("imageEditorReady",m=>{u(m.detail)},{once:!0}),i.appendChild(g),e.set(o,g)}),o.dataset.imageEditorInitialized="true"}function u(o){const i=o.imageEditorInstance;if(!i)return;const L=i.dataset.initiatorId,r=i.dataset.mediumDisplayName,a=i.dataset.mediumPath;i.setImage(r,a,L),i.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:["16:9","4:3"],selectionAspectRatio:"16:9"})}function f(o){const i=o.target.closest("[data-image-editor-modal]");i&&D(i)}A("onImageUpdated",f),H(),document.querySelectorAll("[data-image-editor-modal]").forEach(t),document.addEventListener("mediaManagerPreviewsUpdated",o=>{o.detail.mediaManager.querySelectorAll("[data-image-editor-modal]").forEach(t)}),document.addEventListener("imageEditorModalCloseRequest",o=>{const i=o.detail.modal;D(i)})});z.translationsPath="/js/vendor/image-editor/lang";
