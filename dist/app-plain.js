import"./image-fallback.js";import"./image-editor-listener.js";import{a as x}from"./index.es.js";import"./xhrStatus.js";function R(e,t,u){const f=new CustomEvent(e,{bubbles:!0,detail:u});t.dispatchEvent(f)}function z(e){const t='a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])',u=()=>Array.from(e.querySelectorAll(t)).filter(o=>!o.hasAttribute("disabled")&&o.offsetParent!==null),f=o=>{const M=u(),d=M[0],a=M[M.length-1];if(o.key==="Tab"){if(M.length===0)return;o.shiftKey?document.activeElement===d&&(o.preventDefault(),a.focus()):document.activeElement===a&&(o.preventDefault(),d.focus())}};e.addEventListener("keydown",f),e._trapFocusHandler=f;const n=u();n.length&&n[0].focus()}function U(e){e._trapFocusHandler&&(e.removeEventListener("keydown",e._trapFocusHandler),delete e._trapFocusHandler)}let H=!1;const T=new Map;function k(e,t){T.has(e)||T.set(e,new Set),T.get(e).add(t)}function O(e,t){if(T.has(e))for(const u of T.get(e))u(t)}function P(e,t){e.classList.remove("active"),e.setAttribute("aria-hidden","true"),document.body.style.overflow="initial",U(e),R("mleModalClosed",e,{modal:e,originalEvent:t})}function j(e,t,u){const f=document.querySelector(e);f&&(f.classList.add("active"),f.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",z(f),R("mleModalOpened",f,{modal:f,trigger:t,originalEvent:u}))}function N(e,t=()=>{},u=()=>{}){e.addEventListener("mleModalOpened",u),e.addEventListener("mleModalClosed",t)}function B(e){e.stopPropagation();const t=e.target,u=t.closest("[data-modal-trigger]");if(u){e.preventDefault();const o=u.getAttribute("data-modal-trigger");j(o,u,e);return}const f=t.closest("[data-modal-close]");if(f){const o=f.closest("[data-modal]");o&&P(o,e);return}const n=t.closest("[data-modal]");n&&t===n&&P(n,e)}function X(e){e.key==="Escape"&&document.querySelectorAll("[data-modal].active").forEach(P)}function V(){H||(document.addEventListener("click",e=>O("click",e)),document.addEventListener("keydown",e=>O("keydown",e)),H=!0),k("click",B),k("keydown",X)}function _(){T.clear(),V()}const C=new Map;function D(e){return C.get(e)}function F(e){C.has(e)&&(C.get(e).pause(),C.delete(e));const t=e.querySelectorAll(".media-carousel-item");if(!t.length)return;const u=e.querySelectorAll(".media-carousel-indicators button"),f=e.querySelector('[data-slide="prev"]'),n=e.querySelector('[data-slide="next"]'),o=e.getAttribute("data-carousel-ride")==="true",M=Number(e.getAttribute("data-carousel-ride-interval")??"5000"),d=e.getAttribute("data-carousel-ride-only-after-interaction")==="true";let a=0,h=!1,v=null,y=0,m=0,g=0,r=0;const c=50,l=(i,p="right")=>{t.forEach(q=>{q.classList.remove("active","slide-in-from-left","slide-in-from-right","slide-out-to-left","slide-out-to-right")});const S=t[a],I=t[i];e.getAttribute("data-carousel-effect")==="slide"&&(e.classList.contains("temp-no-animation")||e.classList.contains("no-animation")||(p==="right"?(I.classList.add("slide-in-from-right"),S.classList.add("slide-out-to-left")):(I.classList.add("slide-in-from-left"),S.classList.add("slide-out-to-right")),I.offsetWidth)),S.classList.remove("active"),I.classList.add("active"),u.forEach((q,Y)=>q.classList.toggle("active",Y===i)),a=i,R("mleCarouselSlided",e,{carousel:e,currentSlide:I,currentSlideIndex:a})},s=(i,p=!1)=>{if(i===a)return;const S=(i+t.length)%t.length,q=(S-a+t.length)%t.length>t.length/2?"left":"right";p&&(e.classList.add("temp-no-animation"),e.offsetWidth),l(S,q),p&&e.classList.remove("temp-no-animation")},A=()=>{const p=m-y;Math.abs(p)>40&&Math.abs(p)>Math.abs(r-g)&&(p<0?s((a+1)%t.length):s((a-1+t.length)%t.length),b()),y=m=g=r=0},L=()=>{E(),v=setInterval(()=>s((a+1)%t.length),M)},E=()=>{v!==null&&(clearInterval(v),v=null)},b=()=>{h||(h=!0,o&&d&&L()),o&&!d&&L()};u.forEach((i,p)=>i.addEventListener("click",()=>{s(p),b()})),f==null||f.addEventListener("click",()=>{s((a-1+t.length)%t.length),b()}),n==null||n.addEventListener("click",()=>{s((a+1)%t.length),b()}),e.addEventListener("mouseenter",E),e.addEventListener("mouseleave",()=>{o&&(!d||h)&&L()}),e.addEventListener("focusin",E),e.addEventListener("focusout",()=>{o&&(!d||h)&&L()}),e.addEventListener("keydown",i=>{i.key==="ArrowLeft"?(i.preventDefault(),s((a-1+t.length)%t.length),b()):i.key==="ArrowRight"&&(i.preventDefault(),s((a+1)%t.length),b())}),e.addEventListener("touchstart",i=>{y=i.changedTouches[0].screenX,g=i.changedTouches[0].screenY},{passive:!0}),e.addEventListener("touchend",i=>{m=i.changedTouches[0].screenX,r=i.changedTouches[0].screenY,Math.abs(r-g)<c&&A()},{passive:!0}),t.length>1&&o&&!d&&L();const w={goToSlide:(i,p=!1)=>s(i,p),getCurrentSlideIndex:()=>a,goToNextSlide:()=>s((a+1)%t.length),goToPreviousSlide:()=>s((a-1+t.length)%t.length),pause:E,resume:L};C.set(e,w)}document.addEventListener("mediaManagerPreviewsUpdated",e=>{e.detail.mediaManager,document.querySelectorAll("[data-carousel]").forEach(F)});document.querySelectorAll("[data-carousel]").forEach(F);document.addEventListener("DOMContentLoaded",()=>{let e={},t={};function u(d){const a=d.querySelector("[data-carousel]");N(d),d.addEventListener("mleModalOpened",r=>{const c=r.detail.trigger;if(!c)return;const l=r.detail.modal;if(!l)return;const s=l.id;if(!l.hasAttribute("data-autoplay"))return;const L=l.querySelector("[data-carousel]");if(!L)return;const E=L.querySelector(".media-carousel-item:first-child");if(!E)return;if(parseInt(c.getAttribute("data-slide-to")||"0",10)===0){const w=E.querySelector("[data-mle-audio]"),i=E.querySelector("[data-mle-video]"),p=E.querySelector("[data-mle-youtube-video]");if(w==null||w.play().catch(S=>console.warn("Audio autoplay failed:",S)),i==null||i.play().catch(S=>console.warn("Video autoplay failed:",S)),p){const S=p.getAttribute("data-youtube-video-id"),I=`${s}-${S}`;S&&y(I,"playVideo")}}}),d.addEventListener("mleModalClosed",r=>{g();const c=r.detail.modal,l=D(c.querySelector("[data-carousel]"));l&&l.goToSlide(0,!0)});function h(r){const c=r.querySelector("audio"),l=r.querySelector("video");let s=null;return c&&(s=c.id,t[s]=c),l&&(s=l.id,t[s]=l),s}a==null||a.addEventListener("mleCarouselSlided",r=>{const c=r.detail.carousel,l=r.detail.currentSlide,s=c.closest("[data-modal]"),A=s.hasAttribute("data-autoplay");if(!A||(m(),!A))return;const L=h(l);v(L,"play");const E=l.querySelector("[data-mle-audio]"),b=l.querySelector("[data-mle-video]"),w=l.querySelector("[data-mle-youtube-video]");if(E==null||E.play().catch(i=>console.warn("Audio autoplay failed:",i)),b==null||b.play().catch(i=>console.warn("Video autoplay failed:",i)),w){const i=s.id,p=w.getAttribute("data-youtube-video-id"),S=i+"-"+p;y(S,"playVideo")}});function v(r,c){const l=t[r];if(l)try{c==="play"?l.play():c==="pause"&&l.pause()}catch(s){console.warn(`Failed to ${c} media:`,s)}}function y(r,c="playVideo",l=0,s=10,A=200){const L={playVideo:"playVideo",pauseVideo:"pauseVideo",stopVideo:"stopVideo"},E=L[c];if(!L[c]){console.warn(`Unknown action: ${c}`);return}const b=e[r];if(!b||!b.isReady){l<s&&setTimeout(()=>y(r,c,l+1,s,A*1.2),A);return}E&&b[E]()}function m(){Object.keys(e).forEach(r=>y(r,"pauseVideo")),Object.keys(t).forEach(r=>v(r,"pause"))}function g(){Object.keys(e).forEach(r=>y(r,"stopVideo")),Object.keys(t).forEach(r=>v(r,"pause"))}}function f(){V()}function n(d){const a=d.target.closest("[data-media-modal].active");if(!a)return;const h=D(a.querySelector("[data-carousel]"));if(!h)return;const v=a.querySelector("[data-carousel]").contains(d.target);(d.key==="ArrowLeft"||d.key==="ArrowRight")&&v||(d.key==="ArrowLeft"?h.goToPreviousSlide():d.key==="ArrowRight"&&h.goToNextSlide())}function o(d){const a=d.target.closest("[data-modal-trigger]");if(!a)return;const h=a.getAttribute("data-modal-trigger"),v=parseInt(a.getAttribute("data-slide-to")||"0",10),y=document.querySelector(h),m=y==null?void 0:y.querySelector("[data-carousel]"),g=D(m);g&&g.goToSlide(v,!0)}function M(d){var r,c;const a=d.target.closest("[data-youtube-video-id]");if(!a)return;const h=a.closest("[data-modal]");if(!h)return;const v=h.id,y=a.getAttribute("data-youtube-video-id");if(!y)return;const m=v+"-"+y;if(e[m])return;const g=(c=(r=a.querySelector("lite-youtube"))==null?void 0:r.shadowRoot)==null?void 0:c.querySelector("iframe");g&&(e[m]=new YT.Player(g,{events:{onReady:()=>e[m].isReady=!0}}))}k("click",o),k("keydown",n),document.addEventListener("liteYoutubeIframeLoaded",M),f(),document.querySelectorAll("[data-media-modal]").forEach(u),document.addEventListener("mediaManagerPreviewsUpdated",d=>{e={},t={};const a=d.detail.mediaManager;_(),k("click",o),k("keydown",n),a.querySelectorAll("[data-media-modal]").forEach(u)})});document.addEventListener("DOMContentLoaded",()=>{const e=new WeakMap;function t(n){if(n.dataset.imageEditorInitialized)return;const o=n.querySelector("[data-image-editor-placeholder]");N(n,()=>{const a=e.get(n);a&&(a.remove(),e.delete(n))},()=>{if(e.has(n))return;let a={};try{const g=n.querySelector(".image-editor-modal-config");g&&(a=JSON.parse(g.value))}catch(g){console.error("Invalid or missing image-editor-modal-config:",g)}const h=n.dataset.mediumPath,v=n.dataset.mediumDisplayName,y=a.initiator_id,m=document.createElement("image-editor");m.id="my-image-editor",m.dataset.mediumDisplayName=v,m.dataset.mediumPath=h,m.dataset.initiatorId=y,m.addEventListener("imageEditorReady",g=>{u(g.detail)},{once:!0}),o.appendChild(m),e.set(n,m)}),n.dataset.imageEditorInitialized="true"}function u(n){const o=n.imageEditorInstance;if(!o)return;const M=o.dataset.initiatorId,d=o.dataset.mediumDisplayName,a=o.dataset.mediumPath;o.setImage(d,a,M),o.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:["16:9","4:3"],selectionAspectRatio:"16:9"})}function f(n){const o=n.target.closest("[data-image-editor-modal]");o&&P(o)}k("onImageUpdated",f),V(),document.querySelectorAll("[data-image-editor-modal]").forEach(t),document.addEventListener("mediaManagerPreviewsUpdated",n=>{n.detail.mediaManager.querySelectorAll("[data-image-editor-modal]").forEach(t)}),document.addEventListener("imageEditorModalCloseRequest",n=>{const o=n.detail.modal;P(o)})});x.translationsPath="/js/vendor/image-editor/lang";
