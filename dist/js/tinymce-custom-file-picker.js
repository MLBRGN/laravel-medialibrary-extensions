window.mleFilePicker=(r,A,n)=>{let d=null;if(n.filetype==="image"){let s=function(t){if(!t.data||!t.data.mce)return;const e=t.data.content;if(!e){console.warn("No file");return}if(n.filetype==="image"){const o=new Image;o.src=e.url,o.onload=()=>{const h=o.naturalWidth,b=o.naturalHeight,x={alt:e.alt||"",classes:"",width:h+"px",height:b+"px",vspace:e.vspace||"0px",hspace:e.hspace||"0px",border:e.border||"0px",borderstyle:e.borderstyle||"none"};r(e.url,x)},o.onerror=()=>{console.warn("Could not load image for dimensions"),r(e.url,{alt:e.alt||""})}}else n.filetype==="media"?r(e.url,{source2:e.source2||"",poster:e.poster||""}):n.filetype==="file"&&r(e.url,{text:e.name||"",title:e.title||""});window.removeEventListener("message",s),d.close()};var E=s;const i=tinymce.activeEditor,a=i.getElement(),c=a.getAttribute("data-mle-model-id")==="",p=a.getAttribute("data-mle-media-manager-id")||"media-manager",u=a.getAttribute("data-mle-model-type")??"",w=a.getAttribute("data-mle-model-id");let l=a.getAttribute("data-mle-multiple");const y=l===null||l==="true"||l==="";let m={};try{const t=a.getAttribute("data-mle-collections");t&&(m=JSON.parse(t))}catch(t){console.warn("Invalid data-mle-collections JSON",t),i.windowManager.alert({title:"Configuration Error",text:"The image picker could not start because the data-mle-collections attribute is invalid. Please check your editor setup."});return}const f={model_type:u,model_id:w,multiple:y,media_manager_id:p,collections:JSON.stringify(m),temporary_upload_mode:c,options:JSON.stringify({temporaryUploadMode:c,frontendTheme:"plain"})},g=new URL("/mlbrgn-mle/media-manager-tinymce",window.location.origin);g.search=new URLSearchParams(f).toString();try{d=i.windowManager.openUrl({title:"Select images",url:g.toString(),buttons:[{type:"cancel",text:"Close"}]})}catch(t){console.error("Error opening TinyMCE media manager",t),i.windowManager.alert("An unexpected error occurred while opening the image manager. Please try again. Error:"+t.message);return}window.addEventListener("message",s)}};window.addEventListener("message",r=>{console.log("RAW postMessage seen by parent:",r)});
