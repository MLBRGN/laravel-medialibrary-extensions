import{s as i,t as p,x as E,h as A,a as R}from"./xhrStatus.js";import{u as h}from"./media-manager-previews-refresher.js";import{g as S}from"./form.js";import{g as y}from"./media-manager-config.js";const b=document.querySelectorAll("[data-mle-media-manager]");b.forEach(t=>{const e=t.querySelector("[data-mle-status-area-container]");t.addEventListener("click",async function(s){const o=y(t);if(!o||!o.useXhr)return;const r=s.target.closest("[data-mle-action]");if(!r)return;s.preventDefault();const l=r.getAttribute("data-mle-action");if(l==="debugger-toggle"){const n=o.id,a=document.querySelector("#"+n).querySelector("[data-mle-debug]");a.classList.toggle("hidden"),a.classList.toggle("mle-hidden");return}const u=r.closest("[data-mle-xhr-form]"),g=(u==null?void 0:u.getAttribute("data-xhr-method"))??"post",m=q(l,r,o);if(!m){i(e,{type:"error",message:p("invalid_action")});return}E(e);try{const n=S(u),d=g.toUpperCase();["DELETE","PUT","PATCH"].includes(d)&&n.append("_method",d);const a=await fetch(m,{method:"POST",headers:{"X-CSRF-TOKEN":o.csrfToken,Accept:"application/json"},body:n,cache:"no-store"}),f=await a.json();if(!a.ok){A(a,f,e);return}i(e,f),h(t,o,{}),v(u)}catch(n){console.error("Error during upload:",n),i(e,{type:"error",message:p("upload_failed")})}finally{R(e)}}),t.addEventListener("refreshRequest",function(s){const o=s.detail,c=y(t);h(t,c,o)})});function q(t,e,s){var c,r;return{"upload-media":s.mediaUploadRoute,"upload-youtube-medium":s.youtubeUploadRoute,"destroy-medium":(c=e==null?void 0:e.dataset)==null?void 0:c.mleRoute,"set-as-first":(r=e==null?void 0:e.dataset)==null?void 0:r.mleRoute}[t]||null}function v(t){t.querySelectorAll("input").forEach(e=>{e.type!=="hidden"&&(e.value="")})}
