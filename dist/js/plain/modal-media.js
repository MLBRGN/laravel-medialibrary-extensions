import{r as v,a as h,i as P,s as T}from"./modal-core.js";import{g as S}from"./media-carousel.js";import"./helpers.js";let m={},g={};function q(a){const r=a.querySelector("[data-mle-carousel]");T(a),a.addEventListener("mleModalOpened",e=>{const o=e.detail.trigger;if(!o)return;const t=e.detail.modal;if(!t)return;const l=t.id;if(!t.hasAttribute("data-mle-autoplay"))return;const y=t.querySelector("[data-mle-carousel]");if(!y)return;const s=y.querySelector("[data-mle-carousel-item]:first-child");if(!s)return;if(parseInt(o.getAttribute("data-mle-slide-to")||"0",10)===0){const M=i(s);d(M,"play");const b=s.querySelector("[data-mle-youtube-video]");if(b){const k=b.getAttribute("data-mle-youtube-video-id"),E=`${l}-${k}`;k&&n(E,"playVideo")}}}),a.addEventListener("mleModalClosed",e=>{u();const o=e.detail.modal,t=S(o.querySelector("[data-mle-carousel]"));t&&(t.goToSlide(0,!0,!0),u())});function i(e){const o=e.querySelector("audio"),t=e.querySelector("video");let l=null;return o&&(l=o.id,g[l]=o),t&&(l=t.id,g[l]=t),l}r?.addEventListener("mleCarouselSlided",e=>{const o=e.detail.carousel,t=e.detail.currentSlide,l=o.closest("[data-mle-modal]"),f=l.hasAttribute("data-mle-autoplay");if(!f||(c(),!f))return;const y=i(t);d(y,"play");const s=t.querySelector("[data-mle-youtube-video]");if(s){const p=l.id,M=s.getAttribute("data-mle-youtube-video-id"),b=p+"-"+M;n(b,"playVideo")}});function d(e,o){const t=g[e];if(t)try{o==="play"?t.play():o==="pause"&&t.pause()}catch(l){console.warn(`Failed to ${o} media:`,l)}}function n(e,o="playVideo",t=0,l=10,f=200){const y={playVideo:"playVideo",pauseVideo:"pauseVideo",stopVideo:"stopVideo"},s=y[o];if(!y[o]){console.warn(`Unknown action: ${o}`);return}const p=m[e];if(!p||!p.isReady){t<l&&setTimeout(()=>n(e,o,t+1,l,f*1.2),f);return}s&&p[s]()}function c(){Object.keys(m).forEach(e=>n(e,"pauseVideo")),Object.keys(g).forEach(e=>d(e,"pause"))}function u(){Object.keys(m).forEach(e=>n(e,"stopVideo")),Object.keys(g).forEach(e=>d(e,"pause"))}}function w(){P()}function I(a){const r=a.target.closest("[data-mle-media-modal].active");if(!r)return;const i=S(r.querySelector("[data-mle-carousel]"));if(!i)return;const d=r.querySelector("[data-mle-carousel]").contains(a.target);(a.key==="ArrowLeft"||a.key==="ArrowRight")&&d||(a.key==="ArrowLeft"?i.goToPreviousSlide():a.key==="ArrowRight"&&i.goToNextSlide())}function A(a){const r=a.target.closest("[data-mle-modal-trigger]");if(!r)return;const i=r.getAttribute("data-mle-modal-trigger"),d=parseInt(r.getAttribute("data-mle-slide-to")||"0",10),c=document.querySelector(i)?.querySelector("[data-mle-carousel]"),u=S(c);u&&u.goToSlide(d,!0)}function V(a){const r=a.target.closest("[data-mle-youtube-video-id]");if(!r)return;const i=r.closest("[data-mle-modal]");if(!i)return;const d=i.id,n=r.getAttribute("data-mle-youtube-video-id");if(!n)return;const c=d+"-"+n;if(m[c])return;const u=r.querySelector("lite-youtube")?.shadowRoot?.querySelector("iframe");u&&(m[c]=new YT.Player(u,{events:{onReady:()=>m[c].isReady=!0}}))}v("click",A);v("keydown",I);document.addEventListener("liteYoutubeIframeLoaded",V);w();document.querySelectorAll("[data-mle-media-modal]").forEach(q);document.addEventListener("mediaManagerPreviewsUpdated",a=>{m={},g={};const r=a.detail.mediaManager;h(),v("click",A),v("keydown",I),r.querySelectorAll("[data-mle-media-modal]").forEach(q)});
