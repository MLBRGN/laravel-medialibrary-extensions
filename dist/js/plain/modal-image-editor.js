import{r as p,i as b,c as f,s as I}from"./modal-core.js";import"./helpers.js";const m=new WeakMap;function M(e){console.log("initializeImageEditor config",e);const t=e.imageEditorInstance;if(!t){console.warn("No imageEditorInstance provided.");return}const{name:n,path:i,initiatorId:a,requiredAspectRatio:r,minDimensions:d,maxDimensions:s}=e;t.setImage(n,i,a);const g={debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:[r],selectionAspectRatio:r,minWidth:d.width,minHeight:d.height,maxWidth:s.width,maxHeight:s.height,imagePropertiesEnabled:!1,fileFormatEnabled:!1,rotationEnabled:!0,mirroringEnabled:!0,selectingEnabled:!0,croppingEnabled:!0,gridEnabled:!1,downloadingEnabled:!1,freeSelectEnabled:!1,freeRotationEnabled:!1,resizingEnabled:!1,filtersEnabled:!1,selectionInfoEnabled:!1,selectionAspectRatioEnabled:!1,helpEnabled:!1};t.setConfiguration(g)}function c(e){if(e.dataset.mleImageEditorInitialized)return;const t=e.querySelector("[data-mle-image-editor-placeholder]");I(e,()=>{const a=m.get(e);a&&(a.remove(),m.delete(e)),t.innerHTML=""},()=>{if(m.has(e))return;let a={};try{const o=e.querySelector("[data-mle-image-editor-modal-config]");o&&(a=JSON.parse(o.value))}catch(o){console.error("Invalid or missing data-mle-image-editor-modal-config:",o)}const r=e.getAttribute("data-mle-medium-path"),d=e.getAttribute("data-mle-medium-display-name"),s=e.getAttribute("data-mle-medium-forced-aspect-ratio")??"16:9",g=u(e.getAttribute("data-mle-medium-minimal-dimensions"),{width:800,height:600}),E=u(e.getAttribute("data-mle-medium-maximal-dimensions"),{width:7040,height:3960}),h=a.initiatorId;if(!customElements.get("image-editor")){console.warn("<image-editor> custom element is not registered.");return}t.innerHTML="";const l=document.createElement("image-editor");l.id="my-image-editor",l.addEventListener("imageEditorReady",o=>{M({imageEditorInstance:o.detail.imageEditorInstance,name:d,path:r,initiatorId:h,requiredAspectRatio:s,minDimensions:g,maxDimensions:E})},{once:!0}),t.appendChild(l),m.set(e,l)}),e.dataset.mleImageEditorInitialized="true"}function u(e,t){if(!e)return t;const[n,i]=e.split(/[x:]/).map(Number);return{width:n||t.width,height:i||t.height}}function v(e){const t=e.target.closest("[data-mle-image-editor-modal]");t&&f(t)}p("onImageUpdated",v);b();document.querySelectorAll("[data-mle-image-editor-modal]").forEach(c);document.addEventListener("mediaManagerPreviewsUpdated",e=>{e.detail.mediaManager.querySelectorAll("[data-mle-image-editor-modal]").forEach(c)});document.addEventListener("imageEditorModalCloseRequest",e=>{const t=e.detail.modal;f(t)});const A=()=>{new MutationObserver(t=>{for(const n of t)for(const i of n.addedNodes)i instanceof HTMLElement&&(i.matches("[data-mle-image-editor-modal]")&&c(i),i.querySelectorAll?.("[data-mle-image-editor-modal]").forEach(c))}).observe(document.body,{childList:!0,subtree:!0})};A();
