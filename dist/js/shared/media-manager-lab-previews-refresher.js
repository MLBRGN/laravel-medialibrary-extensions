import{h as s}from"./xhrStatus.js";import{g as m}from"./media-manager-config.js";async function c(o,r,n,a={}){console.log("update previews media lab");const e=o.querySelector("[data-mle-media-manager-lab-previews]");if(!e)return;const l=new URLSearchParams({model_type:r.modelType,model_id:r.modelId,initiator_id:r.id,medium_id:n,options:JSON.stringify(r.options)});l.append("_",Date.now()),a.part&&l.append("part",a.part);try{const i=await fetch(`${r.mediaManagerLabPreviewUpdateRoute}?${l}`,{headers:{Accept:"application/json"},cache:"no-store"}),d=await i.json();if(!i.ok){s(i,d);return}if(!d.html)return;if(a.part==="original"){const t=e.querySelector("[data-mle-media-lab-preview-original]");if(console.log('replace "original" with updated html',t),!t){consolw.warn("replaced not found");return}t.outerHTML=d.html}else if(a.part==="base"){const t=e.querySelector("[data-mle-media-lab-preview-base]");if(console.log('replace "base" with updated html',t),!t){consolw.warn("replaced not found");return}t.outerHTML=d.html}else console.log("replace all with updated html"),e.innerHTML=d.html;document.dispatchEvent(new CustomEvent("mediaManagerLabPreviewsUpdated",{bubbles:!1,detail:{mediaManager:o,previewsContainer:e}}))}catch(i){console.error("Error refreshing media manager:",i)}}document.addEventListener("imageUpdated",o=>{const n=document.getElementById(o.detail.initiatorId).closest("[data-mle-media-manager-lab]"),a=o.detail?.mediumId;if(!n){console.warn("Media manager lab not found");return}if(!a){console.warn("No mediumId found");return}const e=m(n);if(!e){console.warn("Could not get config");return}c(n,e,a,{part:"all"})});export{c as u};
