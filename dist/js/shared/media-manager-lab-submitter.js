import{s as l,t as h,x as A,h as x,a as S}from"./xhrStatus.js";import{u as T}from"./media-manager-lab-previews-refresher.js";import{g as b}from"./form.js";import{g as C}from"./media-manager-config.js";const D=document.querySelectorAll("[data-mle-media-manager-lab]");D.forEach(o=>{const t=o.querySelector("[data-mle-status-area-container]");o.addEventListener("click",async function(c){const r=C(o);if(!r||!r.useXhr)return;const e=c.target.closest("[data-mle-action]"),n=e==null?void 0:e.getAttribute("data-mle-action");if(!n)return;console.log("action",n),c.preventDefault();const p=e.dataset.mleMediumId;if(!e)return;const a=e.closest("[data-mle-xhr-form]"),g=(a==null?void 0:a.getAttribute("data-xhr-method"))??"post",d=R(n,e);if(n!=="debugger-toggle"){if(!d){l(t,{type:"error",message:h("invalid_action")});return}A(t);try{console.log(a);const s=b(a);console.log("just before formData"),s.forEach((E,y)=>{console.log(y,E)});const m=g.toUpperCase();["DELETE","PUT","PATCH"].includes(m)&&s.append("_method",m);const u=await fetch(d,{method:"POST",headers:{"X-CSRF-TOKEN":r.csrfToken,Accept:"application/json"},body:s,cache:"no-store"}),f=await u.json();if(!u.ok){x(u,f,t);return}T(o,r,p,{part:"base"}),l(t,f)}catch(s){console.error("Error during upload:",s),l(t,{type:"error",message:h("upload_failed")})}finally{S(t)}}})});function R(o,t,c){var i;return{"medium-restore":(i=t==null?void 0:t.dataset)==null?void 0:i.mleRoute}[o]||null}
