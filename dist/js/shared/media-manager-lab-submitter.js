import{s as u,t as f,x as y,h as A,a as x}from"./xhrStatus.js";import{u as S}from"./media-manager-lab-previews-refresher.js";import{g as T}from"./form.js";import{g as b}from"./media-manager-config.js";const C=document.querySelectorAll("[data-mle-media-manager-lab]");C.forEach(e=>{const t=e.querySelector("[data-mle-status-area-container]");e.addEventListener("click",async function(n){const o=b(e);if(!o||!o.useXhr)return;const r=n.target.closest("[data-mle-action]"),s=r?.getAttribute("data-mle-action");if(!s)return;console.log("action",s),n.preventDefault();const g=r.dataset.mleMediumId;if(!r)return;const c=r.closest("[data-mle-xhr-form]"),h=c?.getAttribute("data-xhr-method")??"post",l=D(s,r);if(s!=="debugger-toggle"){if(!l){u(t,{type:"error",message:f("invalid_action")});return}y(t);try{console.log(c);const a=T(c);console.log("just before formData"),a.forEach((p,E)=>{console.log(E,p)});const d=h.toUpperCase();["DELETE","PUT","PATCH"].includes(d)&&a.append("_method",d);const i=await fetch(l,{method:"POST",headers:{"X-CSRF-TOKEN":o.csrfToken,Accept:"application/json"},body:a,cache:"no-store"}),m=await i.json();if(!i.ok){A(i,m,t);return}S(e,o,g,{part:"base"}),u(t,m)}catch(a){console.error("Error during upload:",a),u(t,{type:"error",message:f("upload_failed")})}finally{x(t)}}})});function D(e,t,n){return{"medium-restore":t?.dataset?.mleRoute}[e]||null}
