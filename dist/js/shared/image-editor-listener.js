import{x as b,h as v,s as y,a as C}from"./xhrStatus.js";document.addEventListener("onImageSave",t=>{w(t.detail)});document.addEventListener("onCanvasStatusMessage",t=>{console.log("onCanvasStatusMessage:",t.detail)});document.addEventListener("onCloseImageEditor",t=>{const i=t.detail.imageEditorInstance,r=i.closest("[data-mle-image-editor-modal]"),e=i.getAttribute("data-mle-initiator-id");document.querySelector("#"+e).dispatchEvent(new CustomEvent("imageEditorModalCloseRequest",{bubbles:!0,composed:!0,detail:{modal:r}}))});const w=t=>{const i=t.imageEditorInstance.closest("[data-mle-image-editor-modal]"),r=i.querySelector("[data-mle-image-editor-modal-config]");if(!r)return;let e={};try{e=JSON.parse(r.value),console.log(e)}catch{console.error("Invalid JSON config")}if(!e.useXhr){const a=t.file,n=i.querySelector("[data-mle-image-editor-update-form]");let g=n.querySelector("[ data-mle-image-editor-update-form-file]");if(!g)return;const I=new DataTransfer;I.items.add(a),g.files=I.files,n.submit();return}const s=document.querySelector("#"+e.initiatorId);console.log("initiator",s);const d=m(i);let l=m(s);const c=s.closest("[data-mle-media-manager-lab]");if(c&&(l=m(c)),console.log("localStatusAreaContainer",d),console.log("parentStatusAreaContainer",l),!d){console.log("statusAreaContainer not found",d);return}b(d);const E=t.file,o=new FormData,S=e.mediumId??null,u=e.modelType,p=e.modelId??"",f=e.initiatorId;o.append("initiator_id",f),o.append("media_manager_id",e.mediaManagerId??""),o.append("model_type",u),o.append("model_id",p),o.append("single_medium_id",e.singleMedium?.id??null),o.append("medium_id",S),o.append("options",JSON.stringify(e.options)),o.append("collection",e.collection),o.append("temporary_upload_mode",e.temporaryUploadMode),o.append("file",E),Object.entries(e.collections).forEach(([a,n])=>{o.append(`collections[${a}]`,n)}),fetch(e.saveUpdatedMediumRoute,{method:"POST",headers:{"X-CSRF-TOKEN":e.csrfToken,Accept:"application/json"},body:o,cache:"no-store"}).then(async a=>{const n=await a.json();if(!a.ok)throw v(a,n,d),new Error("Update of medium failed");return n}).then(a=>{s.dispatchEvent(new CustomEvent("imageEditorModalCloseRequest",{bubbles:!0,composed:!0,detail:{modal:i}})),y(l,{type:"success",message:M("medium_replaced")}),s.dispatchEvent(new CustomEvent("refreshRequest",{bubbles:!0,composed:!0,detail:{singleMediumId:a.singleMediumId??null}}));const n=a.newMediumId;console.log("newMediumId",n),document.dispatchEvent(new CustomEvent("imageUpdated",{bubbles:!1,detail:{mediumId:n,modelType:u,modelId:p,initiatorId:f}}))}).finally(()=>{C(d)})};function m(t){return t?t.querySelector("[data-mle-status-area-container]"):null}function M(t){return window.mediaLibraryTranslations?.[t]||t}
