import{s as d,t as p,x as E,h as A,a as R}from"./xhrStatus.js";import{u as h}from"./media-manager-previews-refresher.js";import{g as S}from"./form.js";import{g}from"./media-manager-config.js";const b=document.querySelectorAll("[data-mle-media-manager]");b.forEach(e=>{const t=e.querySelector("[data-mle-status-area-container]");e.addEventListener("click",async function(r){const o=g(e);if(!o||!o.useXhr)return;const n=r.target.closest("[data-mle-action]");if(!n)return;r.preventDefault();const l=n.getAttribute("data-mle-action");if(l==="debugger-toggle"){const s=o.id,a=document.querySelector("#"+s).querySelector("[data-mle-debug]");a.classList.toggle("hidden"),a.classList.toggle("mle-hidden");return}const c=n.closest("[data-mle-xhr-form]"),y=c?.getAttribute("data-xhr-method")??"post",m=q(l,n,o);if(!m){d(t,{type:"error",message:p("invalid_action")});return}E(t);try{const s=S(c),u=y.toUpperCase();["DELETE","PUT","PATCH"].includes(u)&&s.append("_method",u);const a=await fetch(m,{method:"POST",headers:{"X-CSRF-TOKEN":o.csrfToken,Accept:"application/json"},body:s,cache:"no-store"}),f=await a.json();if(!a.ok){A(a,f,t);return}d(t,f),h(e,o,{}),v(c)}catch(s){console.error("Error during upload:",s),d(t,{type:"error",message:p("upload_failed")})}finally{R(t)}}),e.addEventListener("refreshRequest",function(r){const o=r.detail,i=g(e);h(e,i,o)})});function q(e,t,r){return{"upload-media":r.mediaUploadRoute,"upload-youtube-medium":r.youtubeUploadRoute,"destroy-medium":t?.dataset?.mleRoute,"set-as-first":t?.dataset?.mleRoute}[e]||null}function v(e){e.querySelectorAll("input").forEach(t=>{t.type!=="hidden"&&(t.value="")})}
