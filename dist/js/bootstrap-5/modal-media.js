import{g}from"./bootstrap-resolver.js";let d={},l={};const E=function(r){if(r.dataset.mleImageEditorInitialized)return;const m=g(),u=r.querySelector("[data-mle-carousel]"),p=r.id;function I(e){const t=e.getAttribute("data-mle-youtube-video-id"),a=p+"-"+t,o=e.querySelector("lite-youtube").shadowRoot.querySelector("iframe");d[a]=new YT.Player(o,{events:{onReady:()=>{d[a].isReady=!0}}})}function v(e){const t=e.querySelector("audio"),a=e.querySelector("video");let o=null;return t&&(o=t.id,l[o]=t),a&&(o=a.id,l[o]=a),o}function f(e,t){const a=l[e];if(a)try{t==="play"?a.play():t==="pause"&&a.pause()}catch(o){console.warn(`Failed to ${t} media:`,o)}}r.addEventListener("liteYoutubeIframeLoaded",e=>{const t=e.target.closest("[data-mle-youtube-video-id]");t&&I(t)}),r.addEventListener("shown.bs.modal",e=>{if(!r.hasAttribute("data-mle-autoplay"))return;const t=e.relatedTarget;if(!t)return;const a=t.querySelector("[data-bs-slide-to]");if(!a||a.getAttribute("data-bs-slide-to")!=="0")return;const i=u.querySelector("[data-mle-carousel-item]:first-child");if(console.log("firstSlide",i),!i)return;const n=v(i);f(n,"play");const y=i.querySelector("[data-mle-youtube-video]");if(y){const s=y.getAttribute("data-mle-youtube-video-id");if(!s)return;const A=`${p}-${s}`;c(A,"playVideo")}}),r.addEventListener("hidden.bs.modal",()=>{const e=r.querySelector("[data-mle-carousel]");if(!e)return;const a=g().Carousel.getInstance(e);a&&(M(),u.removeEventListener("slide.bs.carousel",b),a.to(0),u.addEventListener("slide.bs.carousel",b))});const b=e=>{if(!r.hasAttribute("data-mle-autoplay"))return;h();const t=e.relatedTarget;if(!t)return;const a=v(t);f(a,"play");const o=t.querySelector("[data-mle-youtube-video]");if(o&&o.hasAttribute("data-mle-youtube-video-id")){let i=o.getAttribute("data-mle-youtube-video-id");const n=p+"-"+i;c(n,"playVideo")}};u.addEventListener("slide.bs.carousel",b),r.addEventListener("keydown",e=>{if(!r.classList.contains("show"))return;const t=r.querySelector("[data-mle-carousel]");if(!t)return;const a=m.Carousel.getInstance(t);if(!a)return;const o=u.contains(e.target);(e.key==="ArrowLeft"||e.key==="ArrowRight")&&o||(e.key==="ArrowLeft"?(e.preventDefault(),e.stopPropagation(),a.prev()):e.key==="ArrowRight"&&(e.preventDefault(),e.stopPropagation(),a.next()))}),r.dataset.mleImageEditorInitialized="true";function c(e,t="playVideo",a=0,o=10,i=200){const n={playVideo:"playVideo",pauseVideo:"pauseVideo",stopVideo:"stopVideo"},y=n[t];if(!n[t]){console.warn(`Unknown action: ${t}`);return}const s=d[e];if(!s||!s.isReady){a<o&&setTimeout(()=>c(e,t,a+1,o,i*1.2),i);return}y&&s[y]()}function h(){Object.keys(d).forEach(e=>c(e,"pauseVideo")),Object.keys(l).forEach(e=>f(e,"pause"))}function M(){console.log("stopAllMediaPlayBack"),Object.keys(d).forEach(e=>c(e,"stopVideo")),Object.keys(l).forEach(e=>f(e,"pause"))}};document.addEventListener("mediaManagerPreviewsUpdated",r=>{d={},l={},r.detail.mediaManager.querySelectorAll("[data-mle-media-modal]").forEach(E)});document.querySelectorAll("[data-mle-media-modal]").forEach(E);
