import{h as s}from"./xhrStatus.js";import{g as m}from"./media-manager-config.js";async function c(n,r,i,a={}){console.log("update previews media lab");const e=n.querySelector("[data-mle-media-manager-lab-previews]");if(!e)return;const o=new URLSearchParams({model_type:r.modelType,model_id:r.modelId,initiator_id:r.id,medium_id:i,options:JSON.stringify(r.options)});o.append("_",Date.now()),a.part&&o.append("part",a.part);try{const d=await fetch(`${r.mediaManagerLabPreviewUpdateRoute}?${o}`,{headers:{Accept:"application/json"},cache:"no-store"}),l=await d.json();if(!d.ok){s(d,l);return}if(!l.html)return;if(a.part==="original"){const t=e.querySelector("[data-mle-media-lab-preview-original]");if(console.log('replace "original" with updated html',t),!t){consolw.warn("replaced not found");return}t.outerHTML=l.html}else if(a.part==="base"){const t=e.querySelector("[data-mle-media-lab-preview-base]");if(console.log('replace "base" with updated html',t),!t){consolw.warn("replaced not found");return}t.outerHTML=l.html}else console.log("replace all with updated html"),e.innerHTML=l.html;document.dispatchEvent(new CustomEvent("mediaManagerLabPreviewsUpdated",{bubbles:!1,detail:{mediaManager:n,previewsContainer:e}}))}catch(d){console.error("Error refreshing media manager:",d)}}document.addEventListener("imageUpdated",n=>{var o;const i=document.getElementById(n.detail.initiatorId).closest("[data-mle-media-manager-lab]"),a=(o=n.detail)==null?void 0:o.mediumId;if(!i){console.warn("Media manager lab not found");return}if(!a){console.warn("No mediumId found");return}const e=m(i);if(!e){console.warn("Could not get config");return}c(i,e,a,{part:"all"})});export{c as u};
