import{r as v,a as h,i as P,s as T}from"./_modal-core.js";import{g as S}from"./plain-media-carousel.js";import"./_helpers.js";let m={},g={};function q(r){const a=r.querySelector("[data-mle-carousel]");T(r),r.addEventListener("mleModalOpened",e=>{const t=e.detail.trigger;if(!t)return;const o=e.detail.modal;if(!o)return;const i=o.id;if(!o.hasAttribute("data-mle-autoplay"))return;const y=o.querySelector("[data-mle-carousel]");if(!y)return;const s=y.querySelector("[data-mle-carousel-item]:first-child");if(!s)return;if(parseInt(t.getAttribute("data-mle-slide-to")||"0",10)===0){const M=d(s);n(M,"play");const b=s.querySelector("[data-mle-youtube-video]");if(b){const k=b.getAttribute("data-mle-youtube-video-id"),E=`${i}-${k}`;k&&l(E,"playVideo")}}}),r.addEventListener("mleModalClosed",e=>{u();const t=e.detail.modal,o=S(t.querySelector("[data-mle-carousel]"));o&&(o.goToSlide(0,!0,!0),u())});function d(e){const t=e.querySelector("audio"),o=e.querySelector("video");let i=null;return t&&(i=t.id,g[i]=t),o&&(i=o.id,g[i]=o),i}a==null||a.addEventListener("mleCarouselSlided",e=>{const t=e.detail.carousel,o=e.detail.currentSlide,i=t.closest("[data-mle-modal]"),f=i.hasAttribute("data-mle-autoplay");if(!f||(c(),!f))return;const y=d(o);n(y,"play");const s=o.querySelector("[data-mle-youtube-video]");if(s){const p=i.id,M=s.getAttribute("data-mle-youtube-video-id"),b=p+"-"+M;l(b,"playVideo")}});function n(e,t){const o=g[e];if(o)try{t==="play"?o.play():t==="pause"&&o.pause()}catch(i){console.warn(`Failed to ${t} media:`,i)}}function l(e,t="playVideo",o=0,i=10,f=200){const y={playVideo:"playVideo",pauseVideo:"pauseVideo",stopVideo:"stopVideo"},s=y[t];if(!y[t]){console.warn(`Unknown action: ${t}`);return}const p=m[e];if(!p||!p.isReady){o<i&&setTimeout(()=>l(e,t,o+1,i,f*1.2),f);return}s&&p[s]()}function c(){Object.keys(m).forEach(e=>l(e,"pauseVideo")),Object.keys(g).forEach(e=>n(e,"pause"))}function u(){Object.keys(m).forEach(e=>l(e,"stopVideo")),Object.keys(g).forEach(e=>n(e,"pause"))}}function w(){P()}function I(r){const a=r.target.closest("[data-mle-media-modal].active");if(!a)return;const d=S(a.querySelector("[data-mle-carousel]"));if(!d)return;const n=a.querySelector("[data-mle-carousel]").contains(r.target);(r.key==="ArrowLeft"||r.key==="ArrowRight")&&n||(r.key==="ArrowLeft"?d.goToPreviousSlide():r.key==="ArrowRight"&&d.goToNextSlide())}function A(r){const a=r.target.closest("[data-mle-modal-trigger]");if(!a)return;const d=a.getAttribute("data-mle-modal-trigger"),n=parseInt(a.getAttribute("data-mle-slide-to")||"0",10),l=document.querySelector(d),c=l==null?void 0:l.querySelector("[data-mle-carousel]"),u=S(c);u&&u.goToSlide(n,!0)}function V(r){var e,t;const a=r.target.closest("[data-mle-youtube-video-id]");if(!a)return;const d=a.closest("[data-mle-modal]");if(!d)return;const n=d.id,l=a.getAttribute("data-mle-youtube-video-id");if(!l)return;const c=n+"-"+l;if(m[c])return;const u=(t=(e=a.querySelector("lite-youtube"))==null?void 0:e.shadowRoot)==null?void 0:t.querySelector("iframe");u&&(m[c]=new YT.Player(u,{events:{onReady:()=>m[c].isReady=!0}}))}v("click",A);v("keydown",I);document.addEventListener("liteYoutubeIframeLoaded",V);w();document.querySelectorAll("[data-mle-media-modal]").forEach(q);document.addEventListener("mediaManagerPreviewsUpdated",r=>{m={},g={};const a=r.detail.mediaManager;h(),v("click",A),v("keydown",I),a.querySelectorAll("[data-mle-media-modal]").forEach(q)});
