import{r as v,a as h,i as P,s as T}from"./_modal-core.js";import{g as S}from"./plain-media-carousel.js";import"./_helpers.js";let f={},g={};function q(r){const a=r.querySelector("[data-carousel]");T(r),r.addEventListener("mleModalOpened",e=>{const t=e.detail.trigger;if(!t)return;const o=e.detail.modal;if(!o)return;const i=o.id;if(!o.hasAttribute("data-autoplay"))return;const y=o.querySelector("[data-carousel]");if(!y)return;const s=y.querySelector(".media-carousel-item:first-child");if(!s)return;if(parseInt(t.getAttribute("data-slide-to")||"0",10)===0){const M=n(s);l(M,"play");const b=s.querySelector("[data-mle-youtube-video]");if(b){const k=b.getAttribute("data-youtube-video-id"),E=`${i}-${k}`;k&&d(E,"playVideo")}}}),r.addEventListener("mleModalClosed",e=>{u();const t=e.detail.modal,o=S(t.querySelector("[data-carousel]"));o&&(o.goToSlide(0,!0,!0),u())});function n(e){const t=e.querySelector("audio"),o=e.querySelector("video");let i=null;return t&&(i=t.id,g[i]=t),o&&(i=o.id,g[i]=o),i}a==null||a.addEventListener("mleCarouselSlided",e=>{const t=e.detail.carousel,o=e.detail.currentSlide,i=t.closest("[data-modal]"),m=i.hasAttribute("data-autoplay");if(!m||(c(),!m))return;const y=n(o);l(y,"play");const s=o.querySelector("[data-mle-youtube-video]");if(s){const p=i.id,M=s.getAttribute("data-youtube-video-id"),b=p+"-"+M;d(b,"playVideo")}});function l(e,t){const o=g[e];if(o)try{t==="play"?o.play():t==="pause"&&o.pause()}catch(i){console.warn(`Failed to ${t} media:`,i)}}function d(e,t="playVideo",o=0,i=10,m=200){const y={playVideo:"playVideo",pauseVideo:"pauseVideo",stopVideo:"stopVideo"},s=y[t];if(!y[t]){console.warn(`Unknown action: ${t}`);return}const p=f[e];if(!p||!p.isReady){o<i&&setTimeout(()=>d(e,t,o+1,i,m*1.2),m);return}s&&p[s]()}function c(){Object.keys(f).forEach(e=>d(e,"pauseVideo")),Object.keys(g).forEach(e=>l(e,"pause"))}function u(){Object.keys(f).forEach(e=>d(e,"stopVideo")),Object.keys(g).forEach(e=>l(e,"pause"))}}function w(){P()}function I(r){const a=r.target.closest("[data-media-modal].active");if(!a)return;const n=S(a.querySelector("[data-carousel]"));if(!n)return;const l=a.querySelector("[data-carousel]").contains(r.target);(r.key==="ArrowLeft"||r.key==="ArrowRight")&&l||(r.key==="ArrowLeft"?n.goToPreviousSlide():r.key==="ArrowRight"&&n.goToNextSlide())}function A(r){const a=r.target.closest("[data-modal-trigger]");if(!a)return;const n=a.getAttribute("data-modal-trigger"),l=parseInt(a.getAttribute("data-slide-to")||"0",10),d=document.querySelector(n),c=d==null?void 0:d.querySelector("[data-carousel]"),u=S(c);u&&u.goToSlide(l,!0)}function V(r){var e,t;const a=r.target.closest("[data-youtube-video-id]");if(!a)return;const n=a.closest("[data-modal]");if(!n)return;const l=n.id,d=a.getAttribute("data-youtube-video-id");if(!d)return;const c=l+"-"+d;if(f[c])return;const u=(t=(e=a.querySelector("lite-youtube"))==null?void 0:e.shadowRoot)==null?void 0:t.querySelector("iframe");u&&(f[c]=new YT.Player(u,{events:{onReady:()=>f[c].isReady=!0}}))}v("click",A);v("keydown",I);document.addEventListener("liteYoutubeIframeLoaded",V);w();document.querySelectorAll("[data-media-modal]").forEach(q);document.addEventListener("mediaManagerPreviewsUpdated",r=>{f={},g={};const a=r.detail.mediaManager;h(),v("click",A),v("keydown",I),a.querySelectorAll("[data-media-modal]").forEach(q)});
