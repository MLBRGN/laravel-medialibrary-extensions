var u=e=>{throw TypeError(e)};var g=(e,t,o)=>t.has(e)||u("Cannot "+o);var s=(e,t,o)=>(g(e,t,"read from private field"),o?o.call(e):t.get(e)),p=(e,t,o)=>t.has(e)?u("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,o),f=(e,t,o,a)=>(g(e,t,"write to private field"),a?a.call(e,o):t.set(e,o),o);import{h as E,r as I}from"./general-helpers.js";var i;class _{constructor(){p(this,i);f(this,i,document.createElement("div"))}register(t,o){s(this,i).addEventListener(t,o)}remove(t,o){s(this,i).removeEventListener(t,o)}fire(t,o={}){s(this,i).dispatchEvent(new CustomEvent(t,{detail:o}))}}i=new WeakMap;const r=new _;document.addEventListener("imageEditorReady",e=>{console.log("Image editor is ready:",e.detail.instance);const t=e.detail.instance,o=t.getAttribute("data-initiator-id"),a=t.getAttribute("data-medium-name"),c=t.getAttribute("data-medium-path");debugger;t.setImage(a,c,o),t.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:["16:9","4:3"],selectionAspectRatio:"16:9"})});r.register("onImageSave",e=>{const t=document.getElementById(e.detail.id);y(e.detail),t.dispatchEvent(new CustomEvent("onImageUpdated",{bubbles:!0,composed:!0,detail:e.detail})),console.log("onImageSave using event bus",e.detail)});r.register("onCanvasStatusMessage",e=>{console.log("onCanvasStatusMessage using event bus",e.detail)});r.register("onCloseImageEditor",e=>{console.log("onCloseImageEditor using event bus",e.detail)});const y=e=>{const t=document.getElementById(e.id),o=t.querySelector(".image-editor-modal-config");if(!o)return;let a={};try{a=JSON.parse(o.value)}catch{console.error("Invalid JSON config")}const{model_type:c,model_id:A,medium_id:C,collection:M,csrf_token:v,save_updated_medium_route:b,media_manager_id:h}=a,m=e.file;console.log("file",m);const d=new FormData;d.append("model_type",a.model_type),d.append("model_id",a.model_id),d.append("medium_id",a.medium_id),d.append("collection",a.collection),d.append("file",m),fetch(b,{method:"POST",headers:{"X-CSRF-TOKEN":v,Accept:"application/json"},body:d}).then(async n=>{const l=await n.json();if(!n.ok){console.log("response",n,"data",l),E(n,l,function(){console.log("callback image editor handleAjaxError",l)});return}S(t),I(h)}).then(n=>{console.log("Upload successful:",n)}).catch(n=>{console.error("Upload failed:",n)})},S=e=>{e.querySelector(".image-editor-modal-close-button").click()};export{r as b};
