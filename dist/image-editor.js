import{b as l}from"./EventBus.js";document.addEventListener("DOMContentLoaded",async()=>{console.log("dom content loaded"),await customElements.whenDefined("image-editor");const t=document.getElementById("imageEditor");console.log(t);const d=t.getAttribute("data-medium-name"),c=t.getAttribute("data-medium-path"),m="no-title";console.log("Calling setImage:",{name:d,path:c,title:m}),console.log(l),typeof t.setImage=="function"?t.setImage(d,c,m):console.warn("setImage() is not available on imageEditor",t),typeof t.setConfiguration=="function"?(console.log("setting configuration"),t.setConfiguration({debug:!0}),console.log(t.configuration)):console.warn("setConfiguration() is not available on imageEditor",t),l.register("onImageSave",o=>{f(o.detail),console.log("onImageSave using event bus",o.detail)}),l.register("onCanvasStatusMessage",o=>{console.log("onCanvasStatusMessage using event bus",o.detail)}),l.register("onCloseImageEditor",o=>{console.log("onCloseImageEditor using event bus",o.detail)});const f=o=>{const n=t.parentNode.querySelector(".image-editor-modal-config");if(!n)return;let e={};try{e=JSON.parse(n.value)}catch{console.error("Invalid JSON config")}const{model_type:r,model_id:b,medium_id:h,collection:y,csrf_token:_,save_updated_medium_route:g}=e;console.log("modelType",r),console.log("saveUpdatedMediumRoute",g);const v=o.file,i=new FormData;i.append("model_type",e.model_type),i.append("model_id",e.model_id),i.append("medium_id",e.medium_id),i.append("collection",e.collection),i.append("file",v),fetch(g,{method:"POST",headers:{"X-CSRF-TOKEN":_,Accept:"application/json"},body:i}).then(async s=>{const u=await s.json();if(!s.ok){p(s,u);return}console.log("data",u)}).then(s=>{console.log("Upload successful:",s)}).catch(s=>{console.error("Upload failed:",s)})};function p(o,n){let e=a("upload_failed");switch(o.status){case 419:e=a("csrf_token_mismatch");break;case 401:e=a("unauthenticated");break;case 403:e=a("forbidden");break;case 404:e=a("not_found");break;case 422:if(n.errors){for(const r in n.errors)n.errors[r].forEach(b=>{});return}e=n.message||a("validation_failed");break;case 429:e=a("too_many_requests");break;case 500:case 503:e=a("server_error");break;default:e=n.message||e;break}console.log(e)}function a(o){var n;return((n=window.mediaLibraryTranslations)==null?void 0:n[o])||o}});
