import"./image-fallback.js";import"./image-editor-listener.js";import{a as M}from"./index.es.js";import"./xhrStatus.js";document.addEventListener("DOMContentLoaded",()=>{let d={},s={};const g=function(t){if(t.dataset.imageEditorInitialized)return;const o=t.querySelector(".media-carousel"),l=t.id;function b(e){const a=e.getAttribute("data-youtube-video-id"),i=l+"-"+a,r=e.querySelector("lite-youtube").shadowRoot.querySelector("iframe");d[i]=new YT.Player(r,{events:{onReady:()=>{d[i].isReady=!0}}})}function y(e){const a=e.querySelector("audio"),i=e.querySelector("video");let r=null;return a&&(r=a.id,s[r]=a),i&&(r=i.id,s[r]=i),r}function m(e,a){const i=s[e];if(i)try{a==="play"?i.play():a==="pause"&&i.pause()}catch(r){console.warn(`Failed to ${a} media:`,r)}}t.addEventListener("liteYoutubeIframeLoaded",e=>{const a=e.target.closest("[data-youtube-video-id]");a&&b(a)}),t.addEventListener("shown.bs.modal",e=>{if(!t.hasAttribute("data-autoplay"))return;const a=e.relatedTarget;if(!a)return;const i=a.querySelector("[data-bs-slide-to]");if(!i||i.getAttribute("data-bs-slide-to")!=="0")return;const u=o.querySelector(".carousel-item:first-child");if(!u)return;const f=y(u);m(f,"play");const v=u.querySelector("[data-mle-youtube-video]");if(v){const p=v.getAttribute("data-youtube-video-id");if(!p)return;const I=`${l}-${p}`;c(I,"playVideo")}}),t.addEventListener("hidden.bs.modal",()=>{const e=t.querySelector(".media-carousel");if(!e)return;const a=bootstrap.Carousel.getInstance(e);a&&(h(),o.removeEventListener("slide.bs.carousel",n),a.to(0),o.addEventListener("slide.bs.carousel",n))});const n=e=>{if(!t.hasAttribute("data-autoplay"))return;E();const a=e.relatedTarget;if(!a)return;const i=y(a);m(i,"play");const r=a.querySelector("[data-mle-youtube-video]");if(r&&r.hasAttribute("data-youtube-video-id")){let u=r.getAttribute("data-youtube-video-id");const f=l+"-"+u;c(f,"playVideo")}};o.addEventListener("slide.bs.carousel",n),t.addEventListener("keydown",e=>{if(!t.classList.contains("show"))return;const a=t.querySelector(".media-carousel");if(!a)return;const i=bootstrap.Carousel.getInstance(a);if(!i)return;const r=o.contains(e.target);(e.key==="ArrowLeft"||e.key==="ArrowRight")&&r||(e.key==="ArrowLeft"?(e.preventDefault(),e.stopPropagation(),i.prev()):e.key==="ArrowRight"&&(e.preventDefault(),e.stopPropagation(),i.next()))}),t.dataset.imageEditorInitialized="true";function c(e,a="playVideo",i=0,r=10,u=200){const f={playVideo:"playVideo",pauseVideo:"pauseVideo",stopVideo:"stopVideo"},v=f[a];if(!f[a]){console.warn(`Unknown action: ${a}`);return}const p=d[e];if(!p||!p.isReady){i<r&&setTimeout(()=>c(e,a,i+1,r,u*1.2),u);return}v&&p[v]()}function E(){Object.keys(d).forEach(e=>c(e,"pauseVideo")),Object.keys(s).forEach(e=>m(e,"pause"))}function h(){console.log("stopAllMediaPlayBack"),Object.keys(d).forEach(e=>c(e,"stopVideo")),Object.keys(s).forEach(e=>m(e,"pause"))}};document.addEventListener("mediaManagerPreviewsUpdated",t=>{d={},s={},t.detail.mediaManager.querySelectorAll(".media-modal").forEach(g)}),document.querySelectorAll(".media-modal").forEach(g)});document.addEventListener("DOMContentLoaded",()=>{const d=t=>{if(typeof bootstrap>"u"||!bootstrap.Modal){console.warn("Bootstrap Modal is not available.");return}bootstrap.Modal.getInstance(t).hide()};function s(t){const o=t.imageEditorInstance,l=o.getAttribute("data-initiator-id"),b=o.getAttribute("data-medium-display-name"),y=o.getAttribute("data-medium-path");o.setImage(b,y,l),o.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:["16:9","4:3"],selectionAspectRatio:"16:9"})}function g(t){if(t.dataset.imageEditorInitialized)return;const o=t.querySelector("[data-image-editor-placeholder]");t.addEventListener("show.bs.modal",function(){const l=JSON.parse(t.querySelector(".image-editor-modal-config").value),b=t.getAttribute("data-medium-path"),y=t.getAttribute("data-medium-display-name"),m=l.initiatorId,n=document.createElement("image-editor");n.setAttribute("id","my-image-editor"),n.setAttribute("data-medium-display-name",y),n.setAttribute("data-medium-path",b),n.setAttribute("data-initiator-id",m),n.addEventListener("imageEditorReady",c=>{s(c.detail)}),o.appendChild(n)}),t.addEventListener("hidden.bs.modal",function(){o.innerHTML=""}),t.dataset.imageEditorInitialized="true"}document.addEventListener("mediaManagerPreviewsUpdated",t=>{t.detail.mediaManager.querySelectorAll("[data-image-editor-modal]").forEach(g)}),document.addEventListener("imageEditorModalCloseRequest",t=>{const o=t.detail.modal;d(o)}),document.querySelectorAll("[data-image-editor-modal]").forEach(g)});M.translationsPath="/js/vendor/image-editor/lang";
