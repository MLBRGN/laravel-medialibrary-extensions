import"./image-fallback.js";import"./image-editor-listener.js";import{a as M}from"./index.es.js";import"./xhrStatus.js";document.addEventListener("DOMContentLoaded",()=>{let s={},u={};const p=function(t){if(t.dataset.imageEditorInitialized)return;const o=t.querySelector(".media-carousel"),l=t.id;function b(e){const a=e.getAttribute("data-youtube-video-id"),i=l+"-"+a,r=e.querySelector("lite-youtube").shadowRoot.querySelector("iframe");s[i]=new YT.Player(r,{events:{onReady:()=>{s[i].isReady=!0}}})}function g(e){const a=e.querySelector("audio"),i=e.querySelector("video");let r=null;return a&&(r=a.id,u[r]=a),i&&(r=i.id,u[r]=i),r}function v(e,a){const i=u[e];if(i)try{a==="play"?i.play():a==="pause"&&i.pause()}catch(r){console.warn(`Failed to ${a} media:`,r)}}t.addEventListener("liteYoutubeIframeLoaded",e=>{const a=e.target.closest("[data-youtube-video-id]");a&&b(a)}),t.addEventListener("shown.bs.modal",e=>{if(!t.hasAttribute("data-autoplay"))return;const a=e.relatedTarget;if(!a)return;const i=a.querySelector("[data-bs-slide-to]");if(!i||i.getAttribute("data-bs-slide-to")!=="0")return;const d=o.querySelector(".carousel-item:first-child");if(!d)return;const y=d.querySelector("[data-mle-audio]"),E=d.querySelector("[data-mle-video]"),m=d.querySelector("[data-mle-youtube-video]");if(y)try{y.play()}catch(f){console.warn("Audio autoplay failed:",f)}if(E)try{E.play()}catch(f){console.warn("Video autoplay failed:",f)}if(m){const f=m.getAttribute("data-youtube-video-id");if(!f)return;const I=`${l}-${f}`;c(I,"playVideo")}}),t.addEventListener("hidden.bs.modal",()=>{const e=t.querySelector(".media-carousel");if(!e)return;const a=bootstrap.Carousel.getInstance(e);a&&(A(),o.removeEventListener("slide.bs.carousel",n),a.to(0),o.addEventListener("slide.bs.carousel",n))});const n=e=>{if(!t.hasAttribute("data-autoplay"))return;h();const a=e.relatedTarget;if(!a)return;const i=g(a);v(i,"play");const r=a.querySelector("[data-mle-youtube-video]");if(r&&r.hasAttribute("data-youtube-video-id")){let d=r.getAttribute("data-youtube-video-id");const y=l+"-"+d;c(y,"playVideo")}};o.addEventListener("slide.bs.carousel",n),t.addEventListener("keydown",e=>{if(!t.classList.contains("show"))return;const a=t.querySelector(".media-carousel");if(!a)return;const i=bootstrap.Carousel.getInstance(a);if(!i)return;const r=o.contains(e.target);(e.key==="ArrowLeft"||e.key==="ArrowRight")&&r||(e.key==="ArrowLeft"?(e.preventDefault(),e.stopPropagation(),i.prev()):e.key==="ArrowRight"&&(e.preventDefault(),e.stopPropagation(),i.next()))}),t.dataset.imageEditorInitialized="true";function c(e,a="playVideo",i=0,r=10,d=200){const y={playVideo:"playVideo",pauseVideo:"pauseVideo",stopVideo:"stopVideo"},E=y[a];if(!y[a]){console.warn(`Unknown action: ${a}`);return}const m=s[e];if(!m||!m.isReady){i<r&&setTimeout(()=>c(e,a,i+1,r,d*1.2),d);return}E&&m[E]()}function h(){Object.keys(s).forEach(e=>c(e,"pauseVideo")),Object.keys(u).forEach(e=>v(e,"pause"))}function A(){Object.keys(s).forEach(e=>c(e,"stopVideo")),Object.keys(u).forEach(e=>v(e,"pause"))}};document.addEventListener("mediaManagerPreviewsUpdated",t=>{s={},u={},t.detail.mediaManager.querySelectorAll(".media-modal").forEach(p)}),document.querySelectorAll(".media-modal").forEach(p)});document.addEventListener("DOMContentLoaded",()=>{const s=t=>{if(typeof bootstrap>"u"||!bootstrap.Modal){console.warn("Bootstrap Modal is not available.");return}bootstrap.Modal.getInstance(t).hide()};function u(t){const o=t.imageEditorInstance,l=o.getAttribute("data-initiator-id"),b=o.getAttribute("data-medium-display-name"),g=o.getAttribute("data-medium-path");o.setImage(b,g,l),o.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:["16:9","4:3"],selectionAspectRatio:"16:9"})}function p(t){if(t.dataset.imageEditorInitialized)return;const o=t.querySelector("[data-image-editor-placeholder]");t.addEventListener("show.bs.modal",function(){const l=JSON.parse(t.querySelector(".image-editor-modal-config").value),b=t.getAttribute("data-medium-path"),g=t.getAttribute("data-medium-display-name"),v=l.initiator_id,n=document.createElement("image-editor");n.setAttribute("id","my-image-editor"),n.setAttribute("data-medium-display-name",g),n.setAttribute("data-medium-path",b),n.setAttribute("data-initiator-id",v),n.addEventListener("imageEditorReady",c=>{u(c.detail)}),o.appendChild(n)}),t.addEventListener("hidden.bs.modal",function(){o.innerHTML=""}),t.dataset.imageEditorInitialized="true"}document.addEventListener("mediaManagerPreviewsUpdated",t=>{t.detail.mediaManager.querySelectorAll("[data-image-editor-modal]").forEach(p)}),document.addEventListener("imageEditorModalCloseRequest",t=>{const o=t.detail.modal;s(o)}),document.querySelectorAll("[data-image-editor-modal]").forEach(p)});M.translationsPath="/js/vendor/image-editor/lang";
