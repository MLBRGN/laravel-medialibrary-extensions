import"./image-editor-listener.js";import{a as h}from"./index.es.js";import"./xhrStatus.js";document.addEventListener("DOMContentLoaded",()=>{const n=document.querySelectorAll(".media-modal"),a={};n.forEach(e=>{const o=e.querySelector(".media-carousel");e.hasAttribute("data-video-autoplay");const d=e.id;function s(t){const i=t.getAttribute("data-youtube-video-id"),r=d+"-"+i,y=t.querySelector("lite-youtube").shadowRoot.querySelector("iframe");a[r]=new YT.Player(y,{events:{onReady:()=>{a[r].isReady=!0}}})}e.addEventListener("liteYoutubeIframeLoaded",t=>{const i=t.target.closest("[data-youtube-video-id]");i&&s(i)}),e.addEventListener("shown.bs.modal",t=>{if(!e.hasAttribute("data-video-autoplay"))return;const r=t.relatedTarget.querySelector("[data-bs-slide-to]");if(r&&r.getAttribute("data-bs-slide-to")==="0"){const v=o.querySelector(".carousel-item .media-video-container").getAttribute("data-youtube-video-id"),E=d+"-"+v;p(E)}}),e.addEventListener("hidden.bs.modal",()=>{const t=e.querySelector(".media-carousel");if(!t)return;const i=bootstrap.Carousel.getInstance(t);i&&(g(),o.removeEventListener("slide.bs.carousel",l),i.to(0),o.addEventListener("slide.bs.carousel",l))});const l=t=>{if(c(),e.hasAttribute("data-video-autoplay")){const i=t.relatedTarget.querySelector(".media-video-container");if(i&&i.hasAttribute("data-youtube-video-id")){let r=i.getAttribute("data-youtube-video-id");const y=d+"-"+r;p(y)}}};o.addEventListener("slide.bs.carousel",l),e.addEventListener("keydown",t=>{if(!e.classList.contains("show"))return;const i=e.querySelector(".media-carousel");if(!i)return;const r=bootstrap.Carousel.getInstance(i);if(!r)return;const y=o.contains(t.target);(t.key==="ArrowLeft"||t.key==="ArrowRight")&&y||(t.key==="ArrowLeft"?(t.preventDefault(),t.stopPropagation(),r.prev()):t.key==="ArrowRight"&&(t.preventDefault(),t.stopPropagation(),r.next()))})});function u(e,o="playVideo",d=0,s=10,l=200){const t={playVideo:"playVideo",pauseVideo:"pauseVideo",stopVideo:"stopVideo"},i=t[o];if(!t[o]){console.warn(`Unknown action: ${o}`);return}const r=a[e];if(!r||!r.isReady){d<s&&setTimeout(()=>u(e,o,d+1,s,l*1.2),l);return}i&&r[i]()}function m(e,o=0,d=10,s=200){u(e,"pauseVideo",o,d,s)}function f(e,o=0,d=10,s=200){u(e,"stopVideo",o,d,s)}function p(e,o=0,d=10,s=200){u(e,"playVideo",o,d,s)}function c(){Object.keys(a).forEach(e=>m(e,0,10,200))}function g(){Object.keys(a).forEach(e=>f(e,0,10,200))}});function A(n){const a=n.imageEditorInstance,u=a.getAttribute("data-initiator-id"),m=a.getAttribute("data-medium-display-name"),f=a.getAttribute("data-medium-path");a.setImage(m,f,u),a.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:["16:9","4:3"],selectionAspectRatio:"16:9"})}function b(n){if(n.dataset.imageEditorInitialized)return;const a=n.querySelector("#image-editor-placeholder");n.addEventListener("show.bs.modal",function(){const u=JSON.parse(n.querySelector(".image-editor-modal-config").value),m=n.getAttribute("data-medium-path"),f=n.getAttribute("data-medium-display-name"),p=u.initiator_id,c=document.createElement("image-editor");c.setAttribute("id","my-image-editor"),c.setAttribute("data-medium-display-name",f),c.setAttribute("data-medium-path",m),c.setAttribute("data-initiator-id",p),c.addEventListener("imageEditorReady",g=>{A(g.detail)}),a.appendChild(c)}),n.addEventListener("hidden.bs.modal",function(){a.innerHTML=""}),n.dataset.imageEditorInitialized="true"}document.addEventListener("initializeImageEditorModal",n=>{const a=n.detail.modal;console.log("initializeImageEditorModal",a),b(a)});document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-image-editor-modal]").forEach(b)});h.translationsPath="/js/vendor/image-editor/lang";
