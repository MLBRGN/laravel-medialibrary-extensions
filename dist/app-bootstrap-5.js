import"./image-editor-listener.js";import{a as h}from"./index.es.js";import"./xhrStatus.js";document.addEventListener("DOMContentLoaded",()=>{const n=document.querySelectorAll(".media-modal"),a={};n.forEach(e=>{const r=e.querySelector(".media-carousel");let s=e.hasAttribute("data-video-autoplay");const d=e.id;console.log("initializing media modal",{carousel:r,autoPlay:s});function f(t){const i=t.getAttribute("data-youtube-video-id"),o=d+"-"+i,u=t.querySelector("lite-youtube").shadowRoot.querySelector("iframe");a[o]=new YT.Player(u,{events:{onReady:()=>{a[o].isReady=!0}}})}e.addEventListener("liteYoutubeIframeLoaded",t=>{const i=t.target.closest("[data-youtube-video-id]");i&&f(i)}),e.addEventListener("shown.bs.modal",t=>{if(!e.hasAttribute("data-video-autoplay"))return;const o=t.relatedTarget.querySelector("[data-bs-slide-to]");if(o&&o.getAttribute("data-bs-slide-to")==="0"){const E=r.querySelector(".carousel-item .media-video-container").getAttribute("data-youtube-video-id"),v=d+"-"+E;g(v)}}),e.addEventListener("hidden.bs.modal",()=>{const t=e.querySelector(".media-carousel");if(!t)return;const i=bootstrap.Carousel.getInstance(t);i&&(console.log("carouselInstance",i),i.to(0),p())}),r.addEventListener("slide.bs.carousel",t=>{if(console.log("slide event detected",t.target),c(),e.hasAttribute("data-video-autoplay")){const i=t.relatedTarget.querySelector(".media-video-container");if(i&&i.hasAttribute("data-youtube-video-id")){let o=i.getAttribute("data-youtube-video-id");const u=d+"-"+o;g(u)}}}),e.addEventListener("keydown",t=>{if(!e.classList.contains("show"))return;const i=e.querySelector(".media-carousel");if(!i)return;const o=bootstrap.Carousel.getInstance(i);if(!o)return;const u=r.contains(t.target);(t.key==="ArrowLeft"||t.key==="ArrowRight")&&u||(t.key==="ArrowLeft"?(t.preventDefault(),t.stopPropagation(),o.prev()):t.key==="ArrowRight"&&(t.preventDefault(),t.stopPropagation(),o.next()))})});function l(e,r="playVideo",s=0,d=10,f=200){const t={playVideo:"playVideo",pauseVideo:"pauseVideo",stopVideo:"stopVideo"},i=t[r];if(!t[r]){console.warn(`Unknown action: ${r}`);return}const o=a[e];if(!o||!o.isReady){console.log("No player, or player not ready yet",e,"player",o,"playerIsReady",o==null?void 0:o.isReady),s<d&&setTimeout(()=>l(e,r,s+1,d,f*1.2),f);return}console.log(r,e),i&&o[i]()}function y(e,r=0,s=10,d=200){l(e,"pauseVideo",r,s,d)}function m(e,r=0,s=10,d=200){l(e,"stopVideo",r,s,d)}function g(e,r=0,s=10,d=200){l(e,"playVideo",r,s,d)}function c(){Object.keys(a).forEach(e=>y(e,0,10,200))}function p(){Object.keys(a).forEach(e=>m(e,0,10,200))}});function A(n){const a=n.imageEditorInstance,l=a.getAttribute("data-initiator-id"),y=a.getAttribute("data-medium-display-name"),m=a.getAttribute("data-medium-path");a.setImage(y,m,l),a.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:["16:9","4:3"],selectionAspectRatio:"16:9"})}function b(n){if(n.dataset.imageEditorInitialized)return;const a=n.querySelector("#image-editor-placeholder");n.addEventListener("show.bs.modal",function(){const l=JSON.parse(n.querySelector(".image-editor-modal-config").value),y=n.getAttribute("data-medium-path"),m=n.getAttribute("data-medium-display-name"),g=l.initiator_id,c=document.createElement("image-editor");c.setAttribute("id","my-image-editor"),c.setAttribute("data-medium-display-name",m),c.setAttribute("data-medium-path",y),c.setAttribute("data-initiator-id",g),c.addEventListener("imageEditorReady",p=>{A(p.detail)}),a.appendChild(c)}),n.addEventListener("hidden.bs.modal",function(){a.innerHTML=""}),n.dataset.imageEditorInitialized="true"}document.addEventListener("initializeImageEditorModal",n=>{const a=n.detail.modal;console.log("initializeImageEditorModal",a),b(a)});document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-image-editor-modal]").forEach(b)});h.translationsPath="/js/vendor/image-editor/lang";
