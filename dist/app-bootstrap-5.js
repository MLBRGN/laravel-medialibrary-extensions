import"./image-fallback.js";import"./image-editor-listener.js";import{a as M}from"./index.es.js";import"./xhrStatus.js";document.addEventListener("DOMContentLoaded",()=>{let l={},u={};const p=function(t){if(t.dataset.imageEditorInitialized)return;const i=t.querySelector(".media-carousel"),c=t.id;function g(e){const a=e.getAttribute("data-youtube-video-id"),o=c+"-"+a,r=e.querySelector("lite-youtube").shadowRoot.querySelector("iframe");l[o]=new YT.Player(r,{events:{onReady:()=>{l[o].isReady=!0}}})}function b(e){const a=e.querySelector("audio"),o=e.querySelector("video");let r=null;return a&&(r=a.id,u[r]=a),o&&(r=o.id,u[r]=o),console.log("nativeMediaPlayerId",r),r}function v(e,a){const o=u[e];if(o)try{a==="play"?o.play():a==="pause"&&o.pause()}catch(r){console.warn(`Failed to ${a} media:`,r)}}t.addEventListener("liteYoutubeIframeLoaded",e=>{const a=e.target.closest("[data-youtube-video-id]");a&&g(a)}),t.addEventListener("shown.bs.modal",e=>{if(!t.hasAttribute("data-autoplay"))return;const a=e.relatedTarget;if(!a)return;const o=a.querySelector("[data-bs-slide-to]");if(!o||o.getAttribute("data-bs-slide-to")!=="0")return;const s=i.querySelector(".carousel-item:first-child");if(!s)return;const m=s.querySelector("[data-mle-audio]"),E=s.querySelector("[data-mle-video]"),d=s.querySelector("[data-mle-youtube-video]");if(m)try{m.play()}catch(f){console.warn("Audio autoplay failed:",f)}if(E)try{E.play()}catch(f){console.warn("Video autoplay failed:",f)}if(d){const f=d.getAttribute("data-youtube-video-id");if(!f)return;const I=`${c}-${f}`;y(I,"playVideo")}}),t.addEventListener("hidden.bs.modal",()=>{const e=t.querySelector(".media-carousel");if(!e)return;const a=bootstrap.Carousel.getInstance(e);a&&(A(),i.removeEventListener("slide.bs.carousel",n),a.to(0),i.addEventListener("slide.bs.carousel",n))});const n=e=>{if(!t.hasAttribute("data-autoplay"))return;h(),console.log("autoplay");const a=e.relatedTarget;if(!a)return;const o=b(a);v(o,"play");const r=a.querySelector("[data-mle-youtube-video]");if(r&&r.hasAttribute("data-youtube-video-id")){let s=r.getAttribute("data-youtube-video-id");const m=c+"-"+s;y(m,"playVideo")}};i.addEventListener("slide.bs.carousel",n),t.addEventListener("keydown",e=>{if(!t.classList.contains("show"))return;const a=t.querySelector(".media-carousel");if(!a)return;const o=bootstrap.Carousel.getInstance(a);if(!o)return;const r=i.contains(e.target);(e.key==="ArrowLeft"||e.key==="ArrowRight")&&r||(e.key==="ArrowLeft"?(e.preventDefault(),e.stopPropagation(),o.prev()):e.key==="ArrowRight"&&(e.preventDefault(),e.stopPropagation(),o.next()))}),t.dataset.imageEditorInitialized="true";function y(e,a="playVideo",o=0,r=10,s=200){const m={playVideo:"playVideo",pauseVideo:"pauseVideo",stopVideo:"stopVideo"},E=m[a];if(!m[a]){console.warn(`Unknown action: ${a}`);return}const d=l[e];if(!d||!d.isReady){console.log("No player, or player not ready yet",e,"player",d,"playerIsReady",d==null?void 0:d.isReady),o<r&&setTimeout(()=>y(e,a,o+1,r,s*1.2),s);return}E&&d[E]()}function h(){Object.keys(l).forEach(e=>y(e,"pauseVideo")),Object.keys(u).forEach(e=>v(e,"pause"))}function A(){Object.keys(l).forEach(e=>y(e,"stopVideo")),Object.keys(u).forEach(e=>v(e,"pause"))}};document.addEventListener("mediaManagerPreviewsUpdated",t=>{l={},u={};const i=t.detail.mediaManager;console.log("reinitialize modals for media manager",i),i.querySelectorAll(".media-modal").forEach(p)}),document.querySelectorAll(".media-modal").forEach(p)});document.addEventListener("DOMContentLoaded",()=>{const l=t=>{if(typeof bootstrap>"u"||!bootstrap.Modal){console.warn("Bootstrap Modal is not available.");return}bootstrap.Modal.getInstance(t).hide()};function u(t){const i=t.imageEditorInstance,c=i.getAttribute("data-initiator-id"),g=i.getAttribute("data-medium-display-name"),b=i.getAttribute("data-medium-path");i.setImage(g,b,c),i.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:["16:9","4:3"],selectionAspectRatio:"16:9"})}function p(t){if(t.dataset.imageEditorInitialized)return;const i=t.querySelector("[data-image-editor-placeholder]");t.addEventListener("show.bs.modal",function(){const c=JSON.parse(t.querySelector(".image-editor-modal-config").value),g=t.getAttribute("data-medium-path"),b=t.getAttribute("data-medium-display-name"),v=c.initiator_id,n=document.createElement("image-editor");n.setAttribute("id","my-image-editor"),n.setAttribute("data-medium-display-name",b),n.setAttribute("data-medium-path",g),n.setAttribute("data-initiator-id",v),n.addEventListener("imageEditorReady",y=>{u(y.detail)}),i.appendChild(n)}),t.addEventListener("hidden.bs.modal",function(){i.innerHTML=""}),t.dataset.imageEditorInitialized="true"}document.addEventListener("mediaManagerPreviewsUpdated",t=>{const i=t.detail.mediaManager;i.querySelectorAll("[data-image-editor-modal]").forEach(p),console.log("reinitialize image editor modals for media manager",i)}),document.addEventListener("imageEditorModalCloseRequest",t=>{const i=t.detail.modal;console.log("imageEditorModalCloseRequest",i),l(i)}),document.querySelectorAll("[data-image-editor-modal]").forEach(p)});M.translationsPath="/js/vendor/image-editor/lang";
