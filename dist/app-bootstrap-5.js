import"./image-editor-listener.js";import{a as E}from"./index.es.js";import"./xhrStatus.js";document.addEventListener("DOMContentLoaded",()=>{const a=document.querySelectorAll(".media-modal"),o={};a.forEach(e=>{const i=e.querySelector(".media-carousel");let s=e.hasAttribute("data-video-autoplay");const n=e.id;console.log("initializing media modal",{carousel:i,autoPlay:s});function u(t){const r=t.getAttribute("data-youtube-video-id"),d=n+"-"+r,y=t.querySelector("lite-youtube").shadowRoot.querySelector("iframe");o[d]=new YT.Player(y,{events:{onReady:()=>{o[d].isReady=!0}}})}e.addEventListener("liteYoutubeIframeLoaded",t=>{const r=t.target.closest("[data-youtube-video-id]");r&&u(r)}),e.addEventListener("hidden.bs.modal",()=>{m()}),console.log("addEventListener slide.bs.carousel",e.id,i.id),i.addEventListener("slide.bs.carousel",t=>{if(console.log("slide event detected",t.target),c(),e.hasAttribute("data-video-autoplay")){const r=t.relatedTarget.querySelector(".media-video-container");if(r&&r.hasAttribute("data-youtube-video-id")){let d=r.getAttribute("data-youtube-video-id");const y=n+"-"+d;f(y)}}}),e.addEventListener("keydown",t=>{if(!e.classList.contains("show"))return;const r=e.querySelector(".media-carousel");if(!i)return;const d=bootstrap.Carousel.getInstance(r);if(!d)return;const y=i.contains(t.target);console.log("isInsideCarousel",y),!((t.key==="ArrowLeft"||t.key==="ArrowRight")&&y)&&(t.key==="ArrowLeft"?(t.preventDefault(),t.stopPropagation(),d.prev()):t.key==="ArrowRight"&&(t.preventDefault(),t.stopPropagation(),d.next()))})});function l(e,i="playVideo",s=0,n=10,u=200){console.log({youtubeId:e,action:i,attempt:s,maxAttempts:n,timeOut:u});const t={playVideo:"playVideo",pauseVideo:"pauseVideo",stopVideo:"stopVideo"},r=t[i];if(!t[i]){console.warn(`Unknown action: ${i}`);return}const d=o[e];if(console.log(`${i}VideoPlayBack`,{youTubeId:e,attempt:s,maxAttempts:n,timeOut:u}),!d||!d.isReady){console.log("No player, or player not ready yet",e),s<n&&setTimeout(()=>l(e,i,s+1,n,u*1.5),u);return}console.log(`${i}ing video`,e),console.log("player",d),r&&d[r]()}function g(e,i=0,s=10,n=200){l(e,"pauseVideo",i,s,n)}function p(e,i=0,s=10,n=200){l(e,"stopVideo",i,s,n)}function f(e,i=0,s=10,n=200){l(e,"playVideo",i,s,n)}function c(){Object.keys(o).forEach(e=>g(e,0,10,200))}function m(){Object.keys(o).forEach(e=>p(e,0,10,200))}});function v(a){const o=a.imageEditorInstance,l=o.getAttribute("data-initiator-id"),g=o.getAttribute("data-medium-display-name"),p=o.getAttribute("data-medium-path");o.setImage(g,p,l),o.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:["16:9","4:3"],selectionAspectRatio:"16:9"})}function b(a){if(a.dataset.imageEditorInitialized)return;const o=a.querySelector("#image-editor-placeholder");a.addEventListener("show.bs.modal",function(){const l=JSON.parse(a.querySelector(".image-editor-modal-config").value),g=a.getAttribute("data-medium-path"),p=a.getAttribute("data-medium-display-name"),f=l.initiator_id,c=document.createElement("image-editor");c.setAttribute("id","my-image-editor"),c.setAttribute("data-medium-display-name",p),c.setAttribute("data-medium-path",g),c.setAttribute("data-initiator-id",f),c.addEventListener("imageEditorReady",m=>{v(m.detail)}),o.appendChild(c)}),a.addEventListener("hidden.bs.modal",function(){o.innerHTML=""}),a.dataset.imageEditorInitialized="true"}document.addEventListener("initializeImageEditorModal",a=>{const o=a.detail.modal;console.log("initializeImageEditorModal",o),b(o)});document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-image-editor-modal]").forEach(b)});E.translationsPath="/js/vendor/image-editor/lang";
