import{r as p,i as b,c as u,s as I}from"./_modal-core.js";import"./_helpers.js";const l=new WeakMap;function g(e,t){if(!e)return t;const[a,n]=e.split(/[x:]/).map(Number);return{width:a||t.width,height:n||t.height}}function M(e){console.log("initializeImageEditor config",e);const t=e.imageEditorInstance;if(!t){console.warn("No imageEditorInstance provided.");return}const{name:a,path:n,initiatorId:i,requiredAspectRatio:c,minDimensions:r,maxDimensions:d}=e;t.setImage(a,n,i),t.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:[c],minWidth:r.width,minHeight:r.height,maxWidth:d.width,maxHeight:d.height,imagePropertiesEnabled:!1,fileFormatEnabled:!1,rotationEnabled:!0,mirroringEnabled:!0,selectingEnabled:!0,croppingEnabled:!0,gridEnabled:!1,downloadingEnabled:!1,freeRotationEnabled:!1,resizingEnabled:!1,filtersEnabled:!1,selectionInfoEnabled:!1,selectionAspectRatioEnabled:!1,helpEnabled:!1})}function m(e){if(e.dataset.imageEditorInitialized)return;const t=e.querySelector("[data-image-editor-placeholder]");I(e,()=>{const i=l.get(e);i&&(i.remove(),l.delete(e)),t.innerHTML=""},()=>{if(l.has(e))return;let i={};try{const o=e.querySelector("[data-image-editor-modal-config]");o&&(i=JSON.parse(o.value))}catch(o){console.error("Invalid or missing data-image-editor-modal-config:",o)}const c=e.dataset.mediumPath,r=e.dataset.mediumDisplayName,d=e.dataset.mediumForcedAspectRatio??"16:9",f=g(e.dataset.mediumMinimalDimensions,{width:800,height:600}),h=g(e.dataset.mediumMaximalDimensions,{width:7040,height:3960}),E=i.initiatorId,s=document.createElement("image-editor");s.id="my-image-editor",s.addEventListener("imageEditorReady",o=>{M({imageEditorInstance:o.detail.imageEditorInstance,name:r,path:c,initiatorId:E,requiredAspectRatio:d,minDimensions:f,maxDimensions:h})},{once:!0}),t.appendChild(s),l.set(e,s)}),e.dataset.imageEditorInitialized="true"}function v(e){const t=e.target.closest("[data-image-editor-modal]");t&&u(t)}p("onImageUpdated",v);b();document.querySelectorAll("[data-image-editor-modal]").forEach(m);document.addEventListener("mediaManagerPreviewsUpdated",e=>{e.detail.mediaManager.querySelectorAll("[data-image-editor-modal]").forEach(m)});document.addEventListener("imageEditorModalCloseRequest",e=>{const t=e.detail.modal;u(t)});const D=()=>{new MutationObserver(t=>{var a;for(const n of t)for(const i of n.addedNodes)i instanceof HTMLElement&&(i.matches("[data-image-editor-modal]")&&m(i),(a=i.querySelectorAll)==null||a.call(i,"[data-image-editor-modal]").forEach(m))}).observe(document.body,{childList:!0,subtree:!0})};D();
