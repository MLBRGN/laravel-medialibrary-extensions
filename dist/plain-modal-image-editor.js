import{r as f,i as E,c as l,s as I}from"./_modal-core.js";import"./_helpers.js";const n=new WeakMap;function u(e){if(e.dataset.imageEditorInitialized)return;const t=e.querySelector("[data-image-editor-placeholder]");I(e,()=>{const d=n.get(e);d&&(d.remove(),n.delete(e))},()=>{if(n.has(e))return;let d={};try{const a=e.querySelector("[data-image-editor-modal-config]");a&&(d=JSON.parse(a.value))}catch(a){console.error("Invalid or missing data-image-editor-modal-config:",a)}const s=e.dataset.mediumPath,o=e.dataset.mediumDisplayName,r=d.initiatorId,i=document.createElement("image-editor");i.id="my-image-editor",i.dataset.mediumDisplayName=o,i.dataset.mediumPath=s,i.dataset.initiatorId=r,i.addEventListener("imageEditorReady",a=>{y(a.detail)},{once:!0}),t.appendChild(i),n.set(e,i)}),e.dataset.imageEditorInitialized="true"}function y(e){const t=e.imageEditorInstance;if(!t)return;const c=t.dataset.initiatorId,g=t.dataset.mediumDisplayName,d=t.dataset.mediumPath,s=imageEditor.getAttribute("data-medium-forced-aspect-ratio")??"16:9",o=(a,m)=>{if(!a)return m;const[h,p]=a.split(/[x:]/).map(Number);return{width:h||m.width,height:p||m.height}},r=o(imageEditor.getAttribute("data-medium-min"),{width:800,height:600}),i=o(imageEditor.getAttribute("data-medium-max"),{width:7040,height:3960});t.setImage(g,d,c),t.setConfiguration({debug:!1,rotateDegreesStep:90,freeSelectDisabled:!0,freeRotateDisabled:!0,freeResizeDisabled:!0,filtersDisabled:!0,selectionAspectRatios:[s],minWidth:r.width,minHeight:r.height,maxWidth:i.width,maxHeight:i.height})}function D(e){const t=e.target.closest("[data-image-editor-modal]");t&&l(t)}f("onImageUpdated",D);E();document.querySelectorAll("[data-image-editor-modal]").forEach(u);document.addEventListener("mediaManagerPreviewsUpdated",e=>{e.detail.mediaManager.querySelectorAll("[data-image-editor-modal]").forEach(u)});document.addEventListener("imageEditorModalCloseRequest",e=>{const t=e.detail.modal;l(t)});
