import{s as d,t as m,x as S,h as E,a as b}from"./xhrStatus.js";import{u as h}from"./media-manager-previews-refresher.js";import{g as A}from"./form.js";import{g as y}from"./media-manager-config.js";const q=document.querySelectorAll("[data-media-manager]");q.forEach(e=>{const t=e.querySelector("[data-status-area-container]");e.addEventListener("click",async function(r){const o=y(e);if(!o||!o.useXhr)return;const s=r.target.closest("[data-action]");if(!s)return;r.preventDefault();const l=s.getAttribute("data-action");if(l==="debugger-toggle"){const n=o.id;document.querySelector("#"+n).querySelector(".mle-debug").classList.toggle("hidden");return}const c=s.closest("[data-xhr-form]"),g=(c==null?void 0:c.getAttribute("data-xhr-method"))??"post",f=R(l,s,o);if(!f){d(t,{type:"error",message:m("invalid_action")});return}S(t);try{const n=A(c),i=g.toUpperCase();["DELETE","PUT","PATCH"].includes(i)&&n.append("_method",i);const u=await fetch(f,{method:"POST",headers:{"X-CSRF-TOKEN":o.csrfToken,Accept:"application/json"},body:n,cache:"no-store"}),p=await u.json();if(!u.ok){E(u,p,t);return}d(t,p),h(e,o,{}),v(c)}catch(n){console.error("Error during upload:",n),d(t,{type:"error",message:m("upload_failed")})}finally{b(t)}}),e.addEventListener("refreshRequest",function(r){const o=r.detail,a=y(e);h(e,a,o)})});function R(e,t,r){var a,s;return{"upload-media":r.mediaUploadRoute,"upload-youtube-medium":r.youtubeUploadRoute,"destroy-medium":(a=t==null?void 0:t.dataset)==null?void 0:a.route,"set-as-first":(s=t==null?void 0:t.dataset)==null?void 0:s.route}[e]||null}function v(e){e.querySelectorAll("input").forEach(t=>{t.type!=="hidden"&&(t.value="")})}
