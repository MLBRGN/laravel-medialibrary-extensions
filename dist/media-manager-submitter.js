import{s as d,t as p,x as S,h as E,a as b}from"./xhrStatus.js";import{u as h}from"./media-manager-previews-refresher.js";import{g as A}from"./form.js";import{g as y}from"./media-manager-config.js";const R=document.querySelectorAll("[data-mle-media-manager]");R.forEach(t=>{const e=t.querySelector("[data-mle-status-area-container]");t.addEventListener("click",async function(r){const o=y(t);if(!o||!o.useXhr)return;const s=r.target.closest("[data-mle-action]");if(!s)return;r.preventDefault();const l=s.getAttribute("data-mle-action");if(l==="debugger-toggle"){const n=o.id;document.querySelector("#"+n).querySelector(".mle-debug").classList.toggle("hidden");return}const c=s.closest("[data-mle-xhr-form]"),g=(c==null?void 0:c.getAttribute("data-xhr-method"))??"post",m=q(l,s,o);if(!m){d(e,{type:"error",message:p("invalid_action")});return}S(e);try{const n=A(c),i=g.toUpperCase();["DELETE","PUT","PATCH"].includes(i)&&n.append("_method",i);const u=await fetch(m,{method:"POST",headers:{"X-CSRF-TOKEN":o.csrfToken,Accept:"application/json"},body:n,cache:"no-store"}),f=await u.json();if(!u.ok){E(u,f,e);return}d(e,f),h(t,o,{}),v(c)}catch(n){console.error("Error during upload:",n),d(e,{type:"error",message:p("upload_failed")})}finally{b(e)}}),t.addEventListener("refreshRequest",function(r){const o=r.detail,a=y(t);h(t,a,o)})});function q(t,e,r){var a,s;return{"upload-media":r.mediaUploadRoute,"upload-youtube-medium":r.youtubeUploadRoute,"destroy-medium":(a=e==null?void 0:e.dataset)==null?void 0:a.mleRoute,"set-as-first":(s=e==null?void 0:e.dataset)==null?void 0:s.mleRoute}[t]||null}function v(t){t.querySelectorAll("input").forEach(e=>{e.type!=="hidden"&&(e.value="")})}
