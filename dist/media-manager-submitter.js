import{a as d,t as m,s as S,h as b,b as A}from"./xhrStatus.js";import{u as h}from"./media-manager-previews-refresher.js";import{g as E}from"./form.js";import{g as y}from"./media-manager-config.js";const q=document.querySelectorAll("[data-media-manager]");q.forEach(t=>{const e=t.querySelector("[data-status-area-container]");t.addEventListener("click",async function(r){const o=y(t);if(!o||!o.useXhr)return;const s=r.target.closest("[data-action]");if(!s)return;r.preventDefault();const l=s.getAttribute("data-action");if(l==="debugger-toggle"){const n=o.id;document.querySelector("#"+n).querySelector(".mle-debug").classList.toggle("hidden");return}const c=s.closest("[data-xhr-form]"),g=(c==null?void 0:c.getAttribute("data-xhr-method"))??"post",p=v(l,s,o);if(!p){d(e,{type:"error",message:m("invalid_action")});return}S(e);try{const n=E(c),u=g.toUpperCase();["DELETE","PUT","PATCH"].includes(u)&&n.append("_method",u);const i=await fetch(p,{method:"POST",headers:{"X-CSRF-TOKEN":o.csrfToken,Accept:"application/json"},body:n,cache:"no-store"}),f=await i.json();if(!i.ok){b(i,f,e);return}d(e,f),h(t,o,{}),T(c)}catch(n){console.error("Error during upload:",n),d(e,{type:"error",message:m("upload_failed")})}finally{A(e)}}),t.addEventListener("refreshRequest",function(r){const o=r.detail,a=y(t);h(t,a,o)})});function v(t,e,r){var a,s;return{"upload-media":r.mediaUploadRoute,"upload-youtube-medium":r.youtubeUploadRoute,"destroy-medium":(a=e==null?void 0:e.dataset)==null?void 0:a.route,"set-as-first":(s=e==null?void 0:e.dataset)==null?void 0:s.route}[t]||null}function T(t){t.querySelectorAll("input").forEach(e=>{e.type!=="hidden"&&(e.value="")})}
