import{a as d,t as m,s as S,h as b,b as A}from"./xhrStatus.js";import{u as h}from"./media-manager-previews-refresher.js";import{g as E}from"./form.js";import{g as y}from"./media-manager-config.js";const q=document.querySelectorAll("[data-media-manager]");q.forEach(e=>{const t=e.querySelector("[data-status-area-container]");e.addEventListener("click",async function(r){const o=y(e);if(!o||!o.useXhr)return;const s=r.target.closest("[data-action]");if(!s)return;r.preventDefault();const l=s.getAttribute("data-action");if(l==="debugger-toggle"){const n=o.id;document.querySelector("#"+n).querySelector(".mle-debug").classList.toggle("hidden");return}const c=s.closest("[data-xhr-form]"),g=(c==null?void 0:c.getAttribute("data-xhr-method"))??"post",p=v(l,s,o);if(!p){d(t,{type:"error",message:m("invalid_action")});return}S(t);try{const n=E(c),u=g.toUpperCase();["DELETE","PUT","PATCH"].includes(u)&&n.append("_method",u);const i=await fetch(p,{method:"POST",headers:{"X-CSRF-TOKEN":o.csrfToken,Accept:"application/json"},body:n}),f=await i.json();if(!i.ok){b(i,f,t);return}d(t,f),h(e,o,{}),T(c)}catch(n){console.error("Error during upload:",n),d(t,{type:"error",message:m("upload_failed")})}finally{A(t)}}),e.addEventListener("refreshRequest",function(r){const o=r.detail,a=y(e);h(e,a,o)})});function v(e,t,r){var a,s;return{"upload-media":r.mediaUploadRoute,"upload-youtube-medium":r.youtubeUploadRoute,"destroy-medium":(a=t==null?void 0:t.dataset)==null?void 0:a.route,"set-as-first":(s=t==null?void 0:t.dataset)==null?void 0:s.route}[e]||null}function T(e){e.querySelectorAll("input").forEach(t=>{t.type!=="hidden"&&(t.value="")})}
