window.mleFilePicker=(o,b,a)=>{if(a.filetype==="image"){let l=function(t){if(!t.data||!t.data.mce)return;const e=t.data.content;if(!e){console.warn("No file");return}if(a.filetype==="image"){const n=new Image;n.src=e.url,n.onload=()=>{const w=n.naturalWidth,f=n.naturalHeight,h={alt:e.alt||"",classes:"",width:w+"px",height:f+"px",vspace:e.vspace||"0px",hspace:e.hspace||"0px",border:e.border||"0px",borderstyle:e.borderstyle||"none"};o(e.url,h)},n.onerror=()=>{console.warn("Could not load image for dimensions"),o(e.url,{alt:e.alt||""})}}else a.filetype==="media"?o(e.url,{source2:e.source2||"",poster:e.poster||""}):a.filetype==="file"&&o(e.url,{text:e.name||"",title:e.title||""});window.removeEventListener("message",l),y.close()};var v=l;const i=tinymce.activeEditor.getElement(),r=i.getAttribute("data-mle-model-id")==="";console.log("temporaryUploadMode",r);const c=i.getAttribute("data-mle-initiator-id"),m=i.getAttribute("data-mle-model-type")??"",p=i.getAttribute("data-mle-model-id"),g="myMediaManager";let s={};try{const t=i.getAttribute("data-mle-collections");t&&(s=JSON.parse(t))}catch(t){console.warn("Invalid data-mle-collections JSON",t);return}const u={initiator_id:c,model_type:m,model_id:p,media_manager_id:g,collections:JSON.stringify(s),temporary_upload_mode:r,options:JSON.stringify({temporaryUploadMode:r,frontendTheme:"plain"})},d=new URL("/mlbrgn-mle/media-manager-tinymce",window.location.origin);d.search=new URLSearchParams(u).toString();const y=tinymce.activeEditor.windowManager.openUrl({title:"Select images",url:d.toString(),buttons:[{type:"cancel",text:"Close"}]});window.addEventListener("message",l)}};window.addEventListener("message",o=>{console.log("RAW postMessage seen by parent:",o)});
