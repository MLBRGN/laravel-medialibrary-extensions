window.mleFilePicker=(t,p,a)=>{if(a.filetype==="image"){let n=function(r){if(!r.data||!r.data.mce)return;const e=r.data.content;if(!e){console.warn("No file");return}if(console.log("just before callback"),console.log("file",e),a.filetype==="image"){console.log("image",e);const i=new Image;i.src=e.url,i.onload=()=>{const g=i.naturalWidth,m=i.naturalHeight,d={alt:e.alt||"",classes:"",width:g+"px",height:m+"px",vspace:e.vspace||"0px",hspace:e.hspace||"0px",border:e.border||"0px",borderstyle:e.borderstyle||"none"};console.log("data",d),t(e.url,d)},i.onerror=()=>{console.warn("Could not load image for dimensions"),t(e.url,{alt:e.alt||""})}}else a.filetype==="media"?t(e.url,{source2:e.source2||"",poster:e.poster||""}):a.filetype==="file"&&t(e.url,{text:e.name||"",title:e.title||""});window.removeEventListener("message",n),c.close()};var u=n;const o=tinymce.activeEditor.getElement(),l={initiator_id:o.getAttribute("data-initiator-id"),model_type:o.getAttribute("data-model-type"),model_id:o.getAttribute("data-model-id"),media_manager_id:"myMediaManager",collections:JSON.stringify({image:o.getAttribute("data-image-collection"),video:o.getAttribute("data-video-collection"),audio:o.getAttribute("data-audio-collection")}),temporary_upload_mode:!1,options:JSON.stringify({temporaryUploadMode:!1,frontendTheme:"plain"})};console.log(l);const s=new URL("/mlbrgn-mle/media-manager-tinymce",window.location.origin);s.search=new URLSearchParams(l).toString();const c=tinymce.activeEditor.windowManager.openUrl({title:"Select images",url:s.toString(),buttons:[{type:"cancel",text:"Close"}]});window.addEventListener("message",n)}};window.addEventListener("message",t=>{console.log("RAW postMessage seen by parent:",t)});
