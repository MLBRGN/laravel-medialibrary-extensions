document.addEventListener("DOMContentLoaded",function(){let p=null;document.querySelectorAll("[data-media-manager]").forEach(e=>{const t=e.id,o=e.getAttribute("data-media-upload-route"),r=e.getAttribute("data-media-youtube-upload-route"),s=e.getAttribute("data-preview-refresh-route"),a=e.querySelector(".media-manager-form"),m=e.getAttribute("data-csrf-token");e.getAttribute("data-frontend-theme");const E=e.getAttribute("data-initiator-id"),d=e.getAttribute("data-model-type"),y=e.getAttribute("data-model-id"),A=e.getAttribute("data-image-collection"),v=e.getAttribute("data-document-collection"),_=e.getAttribute("data-youtube-collection"),I=e.getAttribute("data-frontend-theme"),R=e.getAttribute("data-destroy-enabled"),F=e.getAttribute("data-set-as-first-enabled"),x=e.getAttribute("data-show-media-url"),O=e.getAttribute("data-show-order");console.log("adding click listener for:",t),e.addEventListener("click",function(f){const n=f.target.closest("[data-action]");if(console.log("click",n),!n)return;console.log("target",n);const u=n.closest("[data-xhr-form]");console.log("formElement",u),f.preventDefault();const c=n.getAttribute("data-action");console.log(c),T(a);const $=C(u),i=n.closest(".media-manager-preview-media-container");console.log("mediaManagerPreviewMediaContainer",i);const S={"upload-media":o,"destroy-medium":(i==null?void 0:i.getAttribute("data-destroy-route"))||"","set-as-first":(i==null?void 0:i.getAttribute("data-set-as-first-route"))||"","upload-youtube-medium":r}[c]||"";S?fetch(S,{method:"POST",headers:{"X-CSRF-TOKEN":m,Accept:"application/json"},body:$}).then(async g=>{const h=await g.json();if(!g.ok){L(g,h,a,theme);return}b(a,h);const k=document.getElementById(u.dataset.target+"-flash");k&&h.message&&(k.innerHTML=`<div class="alert alert-${h.type}">${h.message}</div>`),U(),D(u)}).catch(g=>{console.error("Error during upload:",g)}).finally(()=>{q(a)}):b(a,{type:"error",message:"invalid action"})});function U(){const f=e.querySelector(".media-manager-preview-grid");if(!f)return;if(!d||!y||!A||!_||!v||!t)throw console.log("modelType",d),console.log("modelId",y),console.log("imageCollection",A),console.log("youtubeCollection",_),console.log("documentCollection",v),console.log("mediaManagerId",t),new Error("missing required params");const n={model_type:d,model_id:y,image_collection:A,youtube_collection:_,document_collection:v,initiator_id:E,destroy_enabled:R==="true",set_as_first_enabled:F==="true",show_media_url:x==="true",show_order:O==="true",frontend_theme:I};console.log("params",n);const u=new URLSearchParams(n);fetch(`${s}?${u}?`,{headers:{Accept:"text/html"}}).then(c=>c.json()).then(c=>{console.log("fetch",c),f.innerHTML=c.html}).catch(c=>{console.error("Error refreshing media manager:",c)}).finally(()=>{console.log("refresh finally preview refresh")})}});function T(e){w(e);const t=e.querySelector("div[data-spinner-container]");t&&t.classList.add("active")}function q(e){const t=e.querySelector("div[data-spinner-container]");t&&t.classList.remove("active")}const b=(e,t)=>{const o=e.querySelector("[data-status-container]"),r=o==null?void 0:o.querySelector("[data-status-message]");if(!o||!r)return;const s=r.getAttribute("data-base-classes")||"",a=r.getAttribute("data-success-classes")||"",m=r.getAttribute("data-error-classes")||"";r.className=s,(t.type==="success"?a:m).split(" ").forEach(d=>{d.trim()&&r.classList.add(d.trim())}),r.textContent=t.message,o.classList.add("visible"),p&&clearTimeout(p),p=setTimeout(()=>{w(e)},5e3)},w=e=>{const t=e.querySelector("[data-status-container]");t&&t.classList.remove("visible")};function L(e,t,o,r){let s=l("upload_failed");switch(e.status){case 419:s=l("csrf_token_mismatch");break;case 401:s=l("unauthenticated");break;case 403:s=l("forbidden");break;case 404:s=l("not_found");break;case 422:if(t.errors){for(const a in t.errors)t.errors[a].forEach(m=>{b(o,{message:m,type:"error"})});return}s=t.message||l("validation_failed");break;case 429:s=l("too_many_requests");break;case 500:case 503:s=l("server_error");break;default:s=t.message||s;break}b(o,{message:s,type:"error"})}function l(e){var t;return((t=window.mediaLibraryTranslations)==null?void 0:t[e])||e}function C(e){const t=new FormData;return e.querySelectorAll("input").forEach(o=>{o.type==="file"?[...o.files].forEach(r=>{t.append(o.name,r)}):t.append(o.name,o.value)}),t}function D(e){e.querySelectorAll("input").forEach(t=>{t.type!=="hidden"&&(t.value="")})}});
