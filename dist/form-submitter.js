document.addEventListener("DOMContentLoaded",function(){const h=document.querySelectorAll("[data-media-manager]");console.log(h),h.forEach(e=>{const t=e.id,p=e.getAttribute("data-media-upload-route"),a=e.getAttribute("data-preview-refresh-route"),o=e.querySelector(".media-manager-upload-form"),l=e.getAttribute("data-csrf-token"),u=e.getAttribute("data-theme"),E=e.getAttribute("data-model-type"),w=e.getAttribute("data-model-id"),L=e.getAttribute("data-collection"),y=e.getAttribute("data-youtube-collection"),v=e.getAttribute("data-document-collection");console.log("adding click listener for:",t),e.addEventListener("click",function(i){const d=i.target.closest("[data-action]"),s=d.closest("[data-xhr-form]");if(d)i.stopPropagation();else return;i.preventDefault();const R=d.getAttribute("data-action");A(s);const g=new FormData;s.querySelectorAll("input").forEach(r=>{r.type==="file"?[...r.files].forEach(c=>{g.append(r.name,c)}):g.append(r.name,r.value)});const n=d.closest(".media-manager-preview-media-container");console.log(n);const b={"upload-media":p,"destroy-medium":(n==null?void 0:n.getAttribute("data-destroy-route"))||"","set-as-first":(n==null?void 0:n.getAttribute("data-set-as-first-route"))||""}[R]||"";b?fetch(b,{method:"POST",headers:{"X-CSRF-TOKEN":l,Accept:"application/json"},body:g}).then(async r=>{const c=await r.json();if(r.ok){f(o,c,u);const m=document.getElementById(s.dataset.target+"-flash");m&&c.message&&(m.innerHTML=`<div class="alert alert-${c.type}">${c.message}</div>`),q()}else{console.log("response not ok");const m=(c==null?void 0:c.message)||"Upload failed";f(o,{message:m,type:"error"},u)}}).catch(r=>{console.error("Error during upload:",r)}).finally(()=>{S(s)}):f(o,{type:"error",message:"invalid action"},u)});function q(){console.log("refresh");const i=e.querySelector(".media-manager-preview-grid");if(!i)return;console.log("youtube_collection",y),console.log("document_collection",v);const d=new URLSearchParams({model_type:E,model_id:w,collection:L,youtube_collection:y,document_collection:v,target_id:t});console.log("previewRefreshRoute",a),fetch(`${a}?${d}`,{headers:{Accept:"text/html"}}).then(s=>s.text()).then(s=>{i.innerHTML=s}).catch(s=>{console.error("Error refreshing media manager:",s)}).finally(()=>{console.log("refresh finally preview refresh")})}});function A(e){const t=e.querySelector("div[data-spinner-container]");t&&t.classList.add("active")}function S(e){const t=e.querySelector("div[data-spinner-container]");t&&t.classList.remove("active")}const f=(e,t,p)=>{console.log("showStatusMessage",t.message);const a=e.querySelector("div[data-status-message]");a==null||a.remove();const o=document.createElement("div");o.setAttribute("data-status-message",""),o.classList.add("mle-status-message"),o.classList.add(`mle-status-message-${t.type}`);let l="";p==="bootstrap-5"&&(l+="alert w-100 ",l+=t.type==="success"?"alert-success":"alert-danger"),l&&l.split(" ").forEach(u=>o.classList.add(u)),o.textContent=t.message,e.prepend(o)}});
