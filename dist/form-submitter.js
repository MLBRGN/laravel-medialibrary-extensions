document.addEventListener("DOMContentLoaded",function(){let p=null;document.querySelectorAll("[data-media-manager]").forEach(e=>{const t=e.id,s=e.getAttribute("data-media-upload-route"),r=e.getAttribute("data-media-youtube-upload-route"),o=e.getAttribute("data-preview-refresh-route"),c=e.querySelector(".media-manager-form"),d=e.getAttribute("data-csrf-token");e.getAttribute("data-theme");const b=e.getAttribute("data-model-type"),u=e.getAttribute("data-model-id"),A=e.getAttribute("data-collection"),v=e.getAttribute("data-youtube-collection"),S=e.getAttribute("data-document-collection");console.log("adding click listener for:",t),e.addEventListener("click",function(f){const i=f.target.closest("[data-action]");if(console.log("click",i),!i)return;console.log("target",i);const a=i.closest("[data-xhr-form]");console.log("formElement",a),f.preventDefault();const E=i.getAttribute("data-action");console.log(E),_(c);const R=T(a),l=i.closest(".media-manager-preview-media-container");console.log("mediaManagerPreviewMediaContainer",l);const k={"upload-media":s,"destroy-medium":(l==null?void 0:l.getAttribute("data-destroy-route"))||"","set-as-first":(l==null?void 0:l.getAttribute("data-set-as-first-route"))||"","upload-youtube-medium":r}[E]||"";k?fetch(k,{method:"POST",headers:{"X-CSRF-TOKEN":d,Accept:"application/json"},body:R}).then(async m=>{const g=await m.json();if(!m.ok){L(m,g,c);return}h(c,g);const w=document.getElementById(a.dataset.target+"-flash");w&&g.message&&(w.innerHTML=`<div class="alert alert-${g.type}">${g.message}</div>`),D(),C(a)}).catch(m=>{console.error("Error during upload:",m)}).finally(()=>{q(c)}):h(c,{type:"error",message:"invalid action"})});function D(){const f=e.querySelector(".media-manager-preview-grid");if(!f)return;if(!b||!u||!A||!v||!S||!t){debugger;throw new Error("missing required params")}const i=new URLSearchParams({model_type:b,model_id:u,collection:A,youtube_collection:v,document_collection:S,initiator_id:t});fetch(`${o}?${i}`,{headers:{Accept:"text/html"}}).then(a=>a.json()).then(a=>{f.innerHTML=a.html}).catch(a=>{console.error("Error refreshing media manager:",a)}).finally(()=>{console.log("refresh finally preview refresh")})}});function _(e){y(e);const t=e.querySelector("div[data-spinner-container]");t&&t.classList.add("active")}function q(e){const t=e.querySelector("div[data-spinner-container]");t&&t.classList.remove("active")}const h=(e,t)=>{const s=e.querySelector("[data-status-container]"),r=s==null?void 0:s.querySelector("[data-status-message]");if(!s||!r)return;const o=r.getAttribute("data-base-classes")||"",c=r.getAttribute("data-success-classes")||"",d=r.getAttribute("data-error-classes")||"";r.className=o,(t.type==="success"?c:d).split(" ").forEach(u=>{u.trim()&&r.classList.add(u.trim())}),r.textContent=t.message,s.classList.add("visible"),p&&clearTimeout(p),p=setTimeout(()=>{y(e)},5e3)},y=e=>{const t=e.querySelector("[data-status-container]");t&&t.classList.remove("visible")};function L(e,t,s,r){let o=n("upload_failed");switch(e.status){case 419:o=n("csrf_token_mismatch");break;case 401:o=n("unauthenticated");break;case 403:o=n("forbidden");break;case 404:o=n("not_found");break;case 422:if(t.errors){for(const c in t.errors)t.errors[c].forEach(d=>{h(s,{message:d,type:"error"})});return}o=t.message||n("validation_failed");break;case 429:o=n("too_many_requests");break;case 500:case 503:o=n("server_error");break;default:o=t.message||o;break}h(s,{message:o,type:"error"})}function n(e){var t;return((t=window.mediaLibraryTranslations)==null?void 0:t[e])||e}function T(e){const t=new FormData;return e.querySelectorAll("input").forEach(s=>{s.type==="file"?[...s.files].forEach(r=>{t.append(s.name,r)}):t.append(s.name,s.value)}),t}function C(e){e.querySelectorAll("input").forEach(t=>{t.type!=="hidden"&&(t.value="")})}});
