document.addEventListener("DOMContentLoaded",function(){let b=null;document.querySelectorAll("[data-media-manager]").forEach(e=>{const t=e.id,o=e.getAttribute("data-media-upload-route"),r=e.getAttribute("data-media-youtube-upload-route"),s=e.getAttribute("data-preview-refresh-route"),c=e.querySelector(".media-manager-form"),d=e.getAttribute("data-csrf-token");e.getAttribute("data-theme");const p=e.getAttribute("data-model-type"),y=e.getAttribute("data-model-id"),u=e.getAttribute("data-collection"),v=e.getAttribute("data-youtube-collection"),S=e.getAttribute("data-document-collection");console.log("adding click listener for:",t),e.addEventListener("click",function(f){const i=f.target.closest("[data-action]");if(console.log("click",i),!i)return;console.log("target",i);const a=i.closest("[data-xhr-form]");console.log("formElement",a),f.preventDefault();const E=i.getAttribute("data-action");console.log(E),_(c);const R=T(a),l=i.closest(".media-manager-preview-media-container");console.log("mediaManagerPreviewMediaContainer",l);const k={"upload-media":o,"destroy-medium":(l==null?void 0:l.getAttribute("data-destroy-route"))||"","set-as-first":(l==null?void 0:l.getAttribute("data-set-as-first-route"))||"","upload-youtube-medium":r}[E]||"";k?fetch(k,{method:"POST",headers:{"X-CSRF-TOKEN":d,Accept:"application/json"},body:R}).then(async m=>{const g=await m.json();if(!m.ok){L(m,g,c);return}h(c,g);const w=document.getElementById(a.dataset.target+"-flash");w&&g.message&&(w.innerHTML=`<div class="alert alert-${g.type}">${g.message}</div>`),D(),C(a)}).catch(m=>{console.error("Error during upload:",m)}).finally(()=>{q(c)}):h(c,{type:"error",message:"invalid action"})});function D(){const f=e.querySelector(".media-manager-preview-grid");if(!f)return;if(!p||!y||!u||!v||!S||!t){debugger;throw new Error("missing required params")}const i=new URLSearchParams({model_type:p,model_id:y,collection:u,youtube_collection:v,document_collection:S,target_id:t});fetch(`${s}?${i}`,{headers:{Accept:"text/html"}}).then(a=>a.json()).then(a=>{f.innerHTML=a.html}).catch(a=>{console.error("Error refreshing media manager:",a)}).finally(()=>{console.log("refresh finally preview refresh")})}});function _(e){A(e);const t=e.querySelector("div[data-spinner-container]");t&&t.classList.add("active")}function q(e){const t=e.querySelector("div[data-spinner-container]");t&&t.classList.remove("active")}const h=(e,t,o)=>{const r=e.querySelector("[data-status-container]"),s=r==null?void 0:r.querySelector("[data-status-message]");if(!r||!s)return;const c=s.getAttribute("data-base-classes")||"",d=s.getAttribute("data-success-classes")||"",p=s.getAttribute("data-error-classes")||"";s.className=c,(t.type==="success"?d:p).split(" ").forEach(u=>{u.trim()&&s.classList.add(u.trim())}),s.textContent=t.message,r.classList.add("visible"),b&&clearTimeout(b),b=setTimeout(()=>{A(e)},5e3)},A=e=>{const t=e.querySelector("[data-status-container]");t&&t.classList.remove("visible")};function L(e,t,o,r){let s=n("upload_failed");switch(e.status){case 419:s=n("csrf_token_mismatch");break;case 401:s=n("unauthenticated");break;case 403:s=n("forbidden");break;case 404:s=n("not_found");break;case 422:if(t.errors){for(const c in t.errors)t.errors[c].forEach(d=>{h(o,{message:d,type:"error"})});return}s=t.message||n("validation_failed");break;case 429:s=n("too_many_requests");break;case 500:case 503:s=n("server_error");break;default:s=t.message||s;break}h(o,{message:s,type:"error"})}function n(e){var t;return((t=window.mediaLibraryTranslations)==null?void 0:t[e])||e}function T(e){const t=new FormData;return e.querySelectorAll("input").forEach(o=>{o.type==="file"?[...o.files].forEach(r=>{t.append(o.name,r)}):t.append(o.name,o.value)}),t}function C(e){e.querySelectorAll("input").forEach(t=>{t.type!=="hidden"&&(t.value="")})}});
