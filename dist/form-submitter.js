import{s as m,t as h,a as E,h as S,b as v}from"./xhrStatus.js";const w=document.querySelectorAll("[data-media-manager]");w.forEach(o=>{const e=o.querySelector("[data-media-manager-layout]");o.addEventListener("click",async function(r){const t=y(o);if(!t||!t.useXhr)return;const s=r.target.closest("[data-action]");if(!s)return;r.preventDefault();const a=s.getAttribute("data-action");if(a==="debugger-toggle"){const l=t.id;console.log("componentId",l);const i=document.querySelector("#"+l).querySelector(".mle-debug");console.log("debugSection",i),i.classList.toggle("hidden"),console.log("toggle debugger TODO");return}const n=s.closest("[data-xhr-form]"),c=(n==null?void 0:n.getAttribute("data-xhr-method"))??"post",p=A(a,s,t);if(!p){m(e,{type:"error",message:h("invalid_action")});return}E(e);try{const l=q(n),u=c.toUpperCase();["DELETE","PUT","PATCH"].includes(u)&&l.append("_method",u);const i=await fetch(p,{method:"POST",headers:{"X-CSRF-TOKEN":t.csrfToken,Accept:"application/json"},body:l}),f=await i.json();if(!i.ok){S(i,f,e);return}m(e,f),g(o,t,{}),R(n)}catch(l){console.error("Error during upload:",l),m(e,{type:"error",message:h("upload_failed")})}finally{v(e)}}),o.addEventListener("refreshRequest",function(r){const t=r.detail,d=y(o);g(o,d,t)})});function y(o){const e=o.querySelector("[data-media-manager-config]");if(!e)return null;try{return JSON.parse(e.value)}catch(r){return console.error(`Invalid JSON config for ${o.id}:`,r),null}}function A(o,e,r){var s,a,n,c;const t=e.closest("[data-media-manager-preview-media-container]");return{"upload-media":r.mediaUploadRoute,"upload-youtube-medium":r.youtubeUploadRoute,"temporary-upload-destroy":(s=t==null?void 0:t.dataset)==null?void 0:s.temporaryUploadDestroyRoute,"destroy-medium":(a=t==null?void 0:t.dataset)==null?void 0:a.destroyRoute,"set-as-first":(n=t==null?void 0:t.dataset)==null?void 0:n.setAsFirstRoute,"temporary-upload-set-as-first":(c=t==null?void 0:t.dataset)==null?void 0:c.temporaryUploadSetAsFirstRoute}[o]||null}function g(o,e,r={}){const t=o.querySelector("[data-media-manager-preview-grid]"),d=o.querySelectorAll("[data-form], [data-xhr-form]");if(!t)return;const s=new URLSearchParams({model_type:e.modelType,model_id:e.modelId,single_medium_id:r.singleMediumId??null,temporary_upload_mode:e.temporaryUploadMode,initiator_id:e.id,collections:JSON.stringify(e.collections),options:JSON.stringify(e.options)});fetch(`${e.previewUpdateRoute}?${s}`,{headers:{Accept:"application/json"}}).then(async a=>{const n=await a.json();if(!a.ok){S(a,n);return}return n}).then(a=>{a.html&&(t.innerHTML=a.html,e.multiple||a.mediaCount!==void 0&&a.mediaCount!==null&&(a.mediaCount<1?U(d):F(d)),document.dispatchEvent(new CustomEvent("mediaManagerPreviewsUpdated",{bubbles:!1,detail:{mediaManager:o,previewGrid:t}})))}).catch(a=>{console.error("Error refreshing media manager:",a)}).finally(()=>{})}function q(o){const e=new FormData;return o.querySelectorAll("input").forEach(r=>{r.type==="file"?Array.from(r.files).forEach(t=>{e.append(r.name,t)}):e.append(r.name,r.value)}),e}function R(o){o.querySelectorAll("input").forEach(e=>{e.type!=="hidden"&&(e.value="")})}function b(o,e){o.forEach(r=>{r.querySelectorAll('input:not([type="hidden"]), button').forEach(t=>t.disabled=e)})}function F(o){b(o,!0)}function U(o){b(o,!1)}
