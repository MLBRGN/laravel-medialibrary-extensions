document.addEventListener("DOMContentLoaded",function(){let p=null;document.querySelectorAll("[data-media-manager]").forEach(e=>{const t=e.id,o=e.getAttribute("data-media-upload-route"),r=e.getAttribute("data-media-youtube-upload-route"),s=e.getAttribute("data-preview-refresh-route"),c=e.querySelector(".media-manager-form"),d=e.getAttribute("data-csrf-token");e.getAttribute("data-theme");const b=e.getAttribute("data-model-type"),A=e.getAttribute("data-model-id"),h=e.getAttribute("data-collection"),q=e.getAttribute("data-youtube-collection"),C=e.getAttribute("data-document-collection");console.log("adding click listener for:",t),e.addEventListener("click",function(u){const i=u.target.closest("[data-action]");if(console.log("click",i),!i)return;console.log("target",i);const a=i.closest("[data-xhr-form]");console.log("formElement",a),u.preventDefault();const v=i.getAttribute("data-action");console.log(v),k(c);const R=L(a),l=i.closest(".media-manager-preview-media-container");console.log("mediaManagerPreviewMediaContainer",l);const S={"upload-media":o,"destroy-medium":(l==null?void 0:l.getAttribute("data-destroy-route"))||"","set-as-first":(l==null?void 0:l.getAttribute("data-set-as-first-route"))||"","upload-youtube-medium":r}[v]||"";S?fetch(S,{method:"POST",headers:{"X-CSRF-TOKEN":d,Accept:"application/json"},body:R}).then(async f=>{const m=await f.json();if(!f.ok){w(f,m,c);return}g(c,m);const E=document.getElementById(a.dataset.target+"-flash");E&&m.message&&(E.innerHTML=`<div class="alert alert-${m.type}">${m.message}</div>`),D(),T(a)}).catch(f=>{console.error("Error during upload:",f)}).finally(()=>{_(c)}):g(c,{type:"error",message:"invalid action"})});function D(){const u=e.querySelector(".media-manager-preview-grid");if(!u)return;const i=new URLSearchParams({model_type:b,model_id:A,collection:h,youtube_collection:q,document_collection:C,target_id:t});fetch(`${s}?${i}`,{headers:{Accept:"text/html"}}).then(a=>a.json()).then(a=>{u.innerHTML=a.html}).catch(a=>{console.error("Error refreshing media manager:",a)}).finally(()=>{console.log("refresh finally preview refresh")})}});function k(e){y(e);const t=e.querySelector("div[data-spinner-container]");t&&t.classList.add("active")}function _(e){const t=e.querySelector("div[data-spinner-container]");t&&t.classList.remove("active")}const g=(e,t,o)=>{const r=e.querySelector("[data-status-container]"),s=r==null?void 0:r.querySelector("[data-status-message]");if(!r||!s)return;const c=s.getAttribute("data-base-classes")||"",d=s.getAttribute("data-success-classes")||"",b=s.getAttribute("data-error-classes")||"";s.className=c,(t.type==="success"?d:b).split(" ").forEach(h=>{h.trim()&&s.classList.add(h.trim())}),s.textContent=t.message,r.classList.add("visible"),p&&clearTimeout(p),p=setTimeout(()=>{y(e)},5e3)},y=e=>{const t=e.querySelector("[data-status-container]");t&&t.classList.remove("visible")};function w(e,t,o,r){let s=n("upload_failed");switch(e.status){case 419:s=n("csrf_token_mismatch");break;case 401:s=n("unauthenticated");break;case 403:s=n("forbidden");break;case 404:s=n("not_found");break;case 422:if(t.errors){for(const c in t.errors)t.errors[c].forEach(d=>{g(o,{message:d,type:"error"})});return}s=t.message||n("validation_failed");break;case 429:s=n("too_many_requests");break;case 500:case 503:s=n("server_error");break;default:s=t.message||s;break}g(o,{message:s,type:"error"})}function n(e){var t;return((t=window.mediaLibraryTranslations)==null?void 0:t[e])||e}function L(e){const t=new FormData;return e.querySelectorAll("input").forEach(o=>{o.type==="file"?[...o.files].forEach(r=>{t.append(o.name,r)}):t.append(o.name,o.value)}),t}function T(e){e.querySelectorAll("input").forEach(t=>{t.type!=="hidden"&&(t.value="")})}});
