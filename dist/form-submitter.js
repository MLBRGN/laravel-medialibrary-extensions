document.addEventListener("DOMContentLoaded",function(){let p=null;document.querySelectorAll("[data-media-manager]").forEach(e=>{const t=e.id,s=e.getAttribute("data-media-upload-route"),r=e.getAttribute("data-media-youtube-upload-route"),o=e.getAttribute("data-preview-refresh-route"),a=e.querySelector(".media-manager-form"),u=e.getAttribute("data-csrf-token");e.getAttribute("data-frontend-theme");const A=e.getAttribute("data-initiator-id"),f=e.getAttribute("data-model-type"),v=e.getAttribute("data-model-id"),_=e.getAttribute("data-image-collection"),w=e.getAttribute("data-document-collection"),E=e.getAttribute("data-youtube-collection"),R=e.getAttribute("data-frontend-theme"),F=e.getAttribute("data-destroy-enabled"),x=e.getAttribute("data-set-as-first-enabled"),I=e.getAttribute("data-show-media-url"),O=e.getAttribute("data-show-order");console.log("adding click listener for:",t),e.addEventListener("click",function(m){const n=m.target.closest("[data-action]");if(console.log("click",n),!n)return;console.log("target",n);const d=n.closest("[data-xhr-form]");console.log("formElement",d),m.preventDefault();const c=n.getAttribute("data-action");console.log(c),T(a);const $=C(d),l=n.closest(".media-manager-preview-media-container");console.log("mediaManagerPreviewMediaContainer",l);const S={"upload-media":s,"destroy-medium":(l==null?void 0:l.getAttribute("data-destroy-route"))||"","set-as-first":(l==null?void 0:l.getAttribute("data-set-as-first-route"))||"","upload-youtube-medium":r}[c]||"";S?fetch(S,{method:"POST",headers:{"X-CSRF-TOKEN":u,Accept:"application/json"},body:$}).then(async h=>{const b=await h.json();if(!h.ok){L(h,b,a,theme);return}g(a,b);const k=document.getElementById(d.dataset.target+"-flash");k&&b.message&&(k.innerHTML=`<div class="alert alert-${b.type}">${b.message}</div>`),U(),D(d)}).catch(h=>{console.error("Error during upload:",h)}).finally(()=>{q(a)}):g(a,{type:"error",message:"invalid action"})});function U(){const m=e.querySelector(".media-manager-preview-grid");if(!m)return;if(!f||!v||!_||!E||!w||!t){debugger;throw new Error("missing required params")}const n={model_type:f,model_id:v,image_collection:_,youtube_collection:E,document_collection:w,initiator_id:A,destroy_enabled:F==="true",set_as_first_enabled:x==="true",show_media_url:I==="true",show_order:O==="true",frontend_theme:R};console.log("params",n);const d=new URLSearchParams(n);fetch(`${o}?${d}?`,{headers:{Accept:"text/html"}}).then(c=>c.json()).then(c=>{console.log("fetch",c),m.innerHTML=c.html}).catch(c=>{console.error("Error refreshing media manager:",c)}).finally(()=>{console.log("refresh finally preview refresh")})}});function T(e){y(e);const t=e.querySelector("div[data-spinner-container]");t&&t.classList.add("active")}function q(e){const t=e.querySelector("div[data-spinner-container]");t&&t.classList.remove("active")}const g=(e,t)=>{const s=e.querySelector("[data-status-container]"),r=s==null?void 0:s.querySelector("[data-status-message]");if(!s||!r)return;const o=r.getAttribute("data-base-classes")||"",a=r.getAttribute("data-success-classes")||"",u=r.getAttribute("data-error-classes")||"";r.className=o,(t.type==="success"?a:u).split(" ").forEach(f=>{f.trim()&&r.classList.add(f.trim())}),r.textContent=t.message,s.classList.add("visible"),p&&clearTimeout(p),p=setTimeout(()=>{y(e)},5e3)},y=e=>{const t=e.querySelector("[data-status-container]");t&&t.classList.remove("visible")};function L(e,t,s,r){let o=i("upload_failed");switch(e.status){case 419:o=i("csrf_token_mismatch");break;case 401:o=i("unauthenticated");break;case 403:o=i("forbidden");break;case 404:o=i("not_found");break;case 422:if(t.errors){for(const a in t.errors)t.errors[a].forEach(u=>{g(s,{message:u,type:"error"})});return}o=t.message||i("validation_failed");break;case 429:o=i("too_many_requests");break;case 500:case 503:o=i("server_error");break;default:o=t.message||o;break}g(s,{message:o,type:"error"})}function i(e){var t;return((t=window.mediaLibraryTranslations)==null?void 0:t[e])||e}function C(e){const t=new FormData;return e.querySelectorAll("input").forEach(s=>{s.type==="file"?[...s.files].forEach(r=>{t.append(s.name,r)}):t.append(s.name,s.value)}),t}function D(e){e.querySelectorAll("input").forEach(t=>{t.type!=="hidden"&&(t.value="")})}});
