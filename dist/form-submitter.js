document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("[data-ajax-upload-form]").forEach(e=>{const o=e.getAttribute("data-form-action-route"),a=e.getAttribute("data-preview-refresh-route"),l=e.querySelector("button"),c=e.parentNode,r=e.getAttribute("data-media-manager-id"),b=e.getAttribute("data-csrf-token"),A=e.getAttribute("data-theme"),i=e.getAttribute("data-model-type"),d=e.getAttribute("data-model-id"),u=e.getAttribute("data-collection"),g=e.getAttribute("data-youtube-collection"),m=e.getAttribute("data-document-collection");console.log(i,d,u,g,m),l.addEventListener("click",function(p){p.preventDefault(),f(e);const n=new FormData;e.querySelectorAll("input").forEach(t=>{t.type==="file"?[...t.files].forEach(s=>{n.append(t.name,s)}):n.append(t.name,t.value)}),fetch(o,{method:"POST",headers:{"X-CSRF-TOKEN":b,Accept:"application/json"},body:n}).then(t=>t.json()).then(t=>{console.log("data",t),extraClasses="",A==="bootstrap-5"&&(extraClasses+="alert w-100 ",extraClasses+=t.type==="success"?"alert-success":"alert-danger"),v(c,t,extraClasses),console.log(t.message);const s=document.getElementById(e.dataset.target+"-flash");s&&t.message&&(s.innerHTML=`<div class="alert alert-success">${t.message}</div>`),h()}).catch(t=>{console.log("catch",t),console.log(t.response),h()}).finally(()=>{console.log("finally"),y(e)})});function h(){console.log("refresh");const n=document.getElementById(r).querySelector(".media-manager-preview-grid");if(!n)return;const t=new URLSearchParams({model_type:i,model_id:d,collection:u,youtube_collection:g,document_collection:m,target_id:r});fetch(`${a}?${t}`,{headers:{Accept:"text/html"}}).then(s=>s.text()).then(s=>{console.log("html",s),n.innerHTML=s}).catch(s=>{console.error("Error refreshing media manager:",s)}).finally(()=>{console.log("refresh finally preview refresh")})}});function f(e){const o=e.querySelector("div[data-spinner-container]");o&&o.classList.add("active")}function y(e){const o=e.querySelector("div[data-spinner-container]");o&&o.classList.remove("active")}const v=(e,o,a="")=>{console.log("showStatusMessage");const l=e.querySelector("div[data-status-message]");l==null||l.remove();const c=document.createElement("div");c.setAttribute("data-status-message",""),c.classList.add("mle-status-message"),c.classList.add(`mle-status-message-${o.type}`),a&&a.split(" ").forEach(r=>c.classList.add(r)),c.textContent=o.message,e.prepend(c)}});
