document.addEventListener("DOMContentLoaded",function(){const b=document.querySelectorAll("[data-media-manager]");console.log(b),b.forEach(e=>{const t=e.id,f=e.getAttribute("data-media-upload-route"),i=e.getAttribute("data-media-youtube-upload-route"),n=e.getAttribute("data-preview-refresh-route"),o=e.querySelector(".media-manager-form"),g=e.getAttribute("data-csrf-token"),p=e.getAttribute("data-theme"),L=e.getAttribute("data-model-type"),C=e.getAttribute("data-model-id"),R=e.getAttribute("data-collection"),v=e.getAttribute("data-youtube-collection"),A=e.getAttribute("data-document-collection");console.log("adding click listener for:",t),e.addEventListener("click",function(d){const l=d.target.closest("[data-action]");if(!l)return;console.log("target",l);const r=l.closest("[data-xhr-form]");console.log("formElement",r),d.preventDefault();const E=l.getAttribute("data-action");console.log(E),S(o);const h=new FormData;r.querySelectorAll("input").forEach(s=>{s.type==="file"?[...s.files].forEach(c=>{h.append(s.name,c)}):h.append(s.name,s.value)});const a=l.closest(".media-manager-preview-media-container");console.log("mediaManagerPreviewMediaContainer",a);const y={"upload-media":f,"destroy-medium":(a==null?void 0:a.getAttribute("data-destroy-route"))||"","set-as-first":(a==null?void 0:a.getAttribute("data-set-as-first-route"))||"","upload-youtube-medium":i}[E]||"";console.log(y),y?fetch(y,{method:"POST",headers:{"X-CSRF-TOKEN":g,Accept:"application/json"},body:h}).then(async s=>{const c=await s.json();if(s.ok){m(o,c,p);const u=document.getElementById(r.dataset.target+"-flash");u&&c.message&&(u.innerHTML=`<div class="alert alert-${c.type}">${c.message}</div>`),q()}else{console.log("response not ok");const u=(c==null?void 0:c.message)||"Upload failed";m(o,{message:u,type:"error"},p)}}).catch(s=>{console.error("Error during upload:",s)}).finally(()=>{w(o)}):m(o,{type:"error",message:"invalid action"},p)});function q(){console.log("refresh");const d=e.querySelector(".media-manager-preview-grid");if(!d)return;console.log("youtube_collection",v),console.log("document_collection",A);const l=new URLSearchParams({model_type:L,model_id:C,collection:R,youtube_collection:v,document_collection:A,target_id:t});console.log("previewRefreshRoute",n),fetch(`${n}?${l}`,{headers:{Accept:"text/html"}}).then(r=>r.text()).then(r=>{d.innerHTML=r}).catch(r=>{console.error("Error refreshing media manager:",r)}).finally(()=>{console.log("refresh finally preview refresh")})}});function S(e){console.log("container",e);const t=e.querySelector("div[data-spinner-container]");console.log("spinnerContainer",t),t&&t.classList.add("active")}function w(e){const t=e.querySelector("div[data-spinner-container]");t&&t.classList.remove("active")}const m=(e,t,f)=>{console.log("showStatusMessage",t.message);const i=e.querySelector("div[data-status-message]");i==null||i.remove();const n=document.createElement("div");n.setAttribute("data-status-message",""),n.classList.add("mle-status-message"),n.classList.add(`mle-status-message-${t.type}`);let o="";f==="bootstrap-5"&&(o+="alert w-100 ",o+=t.type==="success"?"alert-success":"alert-danger"),o&&o.split(" ").forEach(g=>n.classList.add(g)),n.textContent=t.message,e.prepend(n)}});
