document.addEventListener("DOMContentLoaded",function(){let f=null;const A=document.querySelectorAll("[data-media-manager]");console.log(A),A.forEach(e=>{const t=e.id,S=e.getAttribute("data-media-upload-route"),a=e.getAttribute("data-media-youtube-upload-route"),o=e.getAttribute("data-preview-refresh-route"),n=e.querySelector(".media-manager-form"),p=e.getAttribute("data-csrf-token");e.getAttribute("data-theme");const h=e.getAttribute("data-model-type"),E=e.getAttribute("data-model-id"),u=e.getAttribute("data-collection"),L=e.getAttribute("data-youtube-collection"),T=e.getAttribute("data-document-collection");console.log("adding click listener for:",t),e.addEventListener("click",function(d){const l=d.target.closest("[data-action]");if(!l)return;console.log("target",l);const c=l.closest("[data-xhr-form]");console.log("formElement",c),d.preventDefault();const w=l.getAttribute("data-action");console.log(w),q(n);const y=new FormData;c.querySelectorAll("input").forEach(s=>{s.type==="file"?[...s.files].forEach(r=>{y.append(s.name,r)}):y.append(s.name,s.value)});const i=l.closest(".media-manager-preview-media-container");console.log("mediaManagerPreviewMediaContainer",i);const b={"upload-media":S,"destroy-medium":(i==null?void 0:i.getAttribute("data-destroy-route"))||"","set-as-first":(i==null?void 0:i.getAttribute("data-set-as-first-route"))||"","upload-youtube-medium":a}[w]||"";console.log(b),b?fetch(b,{method:"POST",headers:{"X-CSRF-TOKEN":p,Accept:"application/json"},body:y}).then(async s=>{const r=await s.json();if(s.ok){g(n,r);const m=document.getElementById(c.dataset.target+"-flash");m&&r.message&&(m.innerHTML=`<div class="alert alert-${r.type}">${r.message}</div>`),R()}else{console.log("response not ok");const m=(r==null?void 0:r.message)||"Upload failed";g(n,{message:m,type:"error"})}}).catch(s=>{console.error("Error during upload:",s)}).finally(()=>{C(n)}):g(n,{type:"error",message:"invalid action"})});function R(){console.log("refresh");const d=e.querySelector(".media-manager-preview-grid");if(!d)return;console.log("youtube_collection",L),console.log("document_collection",T);const l=new URLSearchParams({model_type:h,model_id:E,collection:u,youtube_collection:L,document_collection:T,target_id:t});console.log("previewRefreshRoute",o),fetch(`${o}?${l}`,{headers:{Accept:"text/html"}}).then(c=>c.text()).then(c=>{d.innerHTML=c}).catch(c=>{console.error("Error refreshing media manager:",c)}).finally(()=>{console.log("refresh finally preview refresh")})}});function q(e){v(e);const t=e.querySelector("div[data-spinner-container]");t&&t.classList.add("active")}function C(e){const t=e.querySelector("div[data-spinner-container]");t&&t.classList.remove("active")}const g=(e,t,S)=>{const a=e.querySelector("[data-status-container]"),o=a==null?void 0:a.querySelector("[data-status-message]");if(!a||!o)return;const n=o.getAttribute("data-base-classes")||"",p=o.getAttribute("data-success-classes")||"",h=o.getAttribute("data-error-classes")||"";o.className=n,(t.type==="success"?p:h).split(" ").forEach(u=>{u.trim()&&o.classList.add(u.trim())}),o.textContent=t.message,a.classList.add("visible"),f&&clearTimeout(f),f=setTimeout(()=>{v(e)},5e3)},v=e=>{const t=e.querySelector("[data-status-container]");t&&t.classList.remove("visible")}});
