document.addEventListener("DOMContentLoaded",function(){const b=document.querySelectorAll("[data-media-manager]");console.log(b),b.forEach(e=>{const t=e.id,f=e.getAttribute("data-media-upload-route"),i=e.getAttribute("data-media-youtube-upload-route"),n=e.getAttribute("data-preview-refresh-route"),c=e.querySelector(".media-manager-upload-form"),g=e.getAttribute("data-csrf-token"),p=e.getAttribute("data-theme"),L=e.getAttribute("data-model-type"),R=e.getAttribute("data-model-id"),q=e.getAttribute("data-collection"),v=e.getAttribute("data-youtube-collection"),A=e.getAttribute("data-document-collection");console.log("adding click listener for:",t),e.addEventListener("click",function(d){const a=d.target.closest("[data-action]");if(!a)return;console.log("target",a);const o=a.closest("[data-xhr-form]");console.log("formElement",o),d.preventDefault();const E=a.getAttribute("data-action");console.log(E),S(o);const h=new FormData;o.querySelectorAll("input").forEach(s=>{s.type==="file"?[...s.files].forEach(r=>{h.append(s.name,r)}):h.append(s.name,s.value)});const l=a.closest(".media-manager-preview-media-container");console.log("mediaManagerPreviewMediaContainer",l);const y={"upload-media":f,"destroy-medium":(l==null?void 0:l.getAttribute("data-destroy-route"))||"","set-as-first":(l==null?void 0:l.getAttribute("data-set-as-first-route"))||"","upload-youtube-medium":i}[E]||"";console.log(y),y?fetch(y,{method:"POST",headers:{"X-CSRF-TOKEN":g,Accept:"application/json"},body:h}).then(async s=>{const r=await s.json();if(s.ok){m(c,r,p);const u=document.getElementById(o.dataset.target+"-flash");u&&r.message&&(u.innerHTML=`<div class="alert alert-${r.type}">${r.message}</div>`),C()}else{console.log("response not ok");const u=(r==null?void 0:r.message)||"Upload failed";m(c,{message:u,type:"error"},p)}}).catch(s=>{console.error("Error during upload:",s)}).finally(()=>{w(o)}):m(c,{type:"error",message:"invalid action"},p)});function C(){console.log("refresh");const d=e.querySelector(".media-manager-preview-grid");if(!d)return;console.log("youtube_collection",v),console.log("document_collection",A);const a=new URLSearchParams({model_type:L,model_id:R,collection:q,youtube_collection:v,document_collection:A,target_id:t});console.log("previewRefreshRoute",n),fetch(`${n}?${a}`,{headers:{Accept:"text/html"}}).then(o=>o.text()).then(o=>{d.innerHTML=o}).catch(o=>{console.error("Error refreshing media manager:",o)}).finally(()=>{console.log("refresh finally preview refresh")})}});function S(e){const t=e.querySelector("div[data-spinner-container]");t&&t.classList.add("active")}function w(e){const t=e.querySelector("div[data-spinner-container]");t&&t.classList.remove("active")}const m=(e,t,f)=>{console.log("showStatusMessage",t.message);const i=e.querySelector("div[data-status-message]");i==null||i.remove();const n=document.createElement("div");n.setAttribute("data-status-message",""),n.classList.add("mle-status-message"),n.classList.add(`mle-status-message-${t.type}`);let c="";f==="bootstrap-5"&&(c+="alert w-100 ",c+=t.type==="success"?"alert-success":"alert-danger"),c&&c.split(" ").forEach(g=>n.classList.add(g)),n.textContent=t.message,e.prepend(n)}});
