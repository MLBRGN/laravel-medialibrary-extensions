document.addEventListener("DOMContentLoaded",function(){let f=null;const g=document.querySelectorAll("[data-media-manager]");console.log("mediaManagers:",g),console.log(g),g.forEach(e=>{console.log("MediaManager:",e);const t=e.id,S=e.getAttribute("data-media-upload-route"),n=e.getAttribute("data-media-youtube-upload-route"),o=e.getAttribute("data-preview-refresh-route"),l=e.querySelector(".media-manager-form"),h=e.getAttribute("data-csrf-token");e.getAttribute("data-theme");const y=e.getAttribute("data-model-type"),E=e.getAttribute("data-model-id"),u=e.getAttribute("data-collection"),L=e.getAttribute("data-youtube-collection"),T=e.getAttribute("data-document-collection");console.log("adding click listener for:",t),e.addEventListener("click",function(d){const a=d.target.closest("[data-action]");if(console.log("click",a),!a)return;console.log("target",a);const c=a.closest("[data-xhr-form]");console.log("formElement",c),d.preventDefault();const w=a.getAttribute("data-action");console.log(w),q(l);const b=new FormData;c.querySelectorAll("input").forEach(s=>{s.type==="file"?[...s.files].forEach(r=>{b.append(s.name,r)}):b.append(s.name,s.value)});const i=a.closest(".media-manager-preview-media-container");console.log("mediaManagerPreviewMediaContainer",i);const A={"upload-media":S,"destroy-medium":(i==null?void 0:i.getAttribute("data-destroy-route"))||"","set-as-first":(i==null?void 0:i.getAttribute("data-set-as-first-route"))||"","upload-youtube-medium":n}[w]||"";console.log(A),A?fetch(A,{method:"POST",headers:{"X-CSRF-TOKEN":h,Accept:"application/json"},body:b}).then(async s=>{const r=await s.json();if(s.ok){p(l,r);const m=document.getElementById(c.dataset.target+"-flash");m&&r.message&&(m.innerHTML=`<div class="alert alert-${r.type}">${r.message}</div>`),R()}else{console.log("response not ok");const m=(r==null?void 0:r.message)||"Upload failed";p(l,{message:m,type:"error"})}}).catch(s=>{console.error("Error during upload:",s)}).finally(()=>{C(l)}):p(l,{type:"error",message:"invalid action"})});function R(){console.log("refresh");const d=e.querySelector(".media-manager-preview-grid");if(!d)return;console.log("youtube_collection",L),console.log("document_collection",T);const a=new URLSearchParams({model_type:y,model_id:E,collection:u,youtube_collection:L,document_collection:T,target_id:t});console.log("previewRefreshRoute",o),fetch(`${o}?${a}`,{headers:{Accept:"text/html"}}).then(c=>c.text()).then(c=>{d.innerHTML=c}).catch(c=>{console.error("Error refreshing media manager:",c)}).finally(()=>{console.log("refresh finally preview refresh")})}});function q(e){v(e);const t=e.querySelector("div[data-spinner-container]");t&&t.classList.add("active")}function C(e){const t=e.querySelector("div[data-spinner-container]");t&&t.classList.remove("active")}const p=(e,t,S)=>{const n=e.querySelector("[data-status-container]"),o=n==null?void 0:n.querySelector("[data-status-message]");if(!n||!o)return;const l=o.getAttribute("data-base-classes")||"",h=o.getAttribute("data-success-classes")||"",y=o.getAttribute("data-error-classes")||"";o.className=l,(t.type==="success"?h:y).split(" ").forEach(u=>{u.trim()&&o.classList.add(u.trim())}),o.textContent=t.message,n.classList.add("visible"),f&&clearTimeout(f),f=setTimeout(()=>{v(e)},5e3)},v=e=>{const t=e.querySelector("[data-status-container]");t&&t.classList.remove("visible")}});
