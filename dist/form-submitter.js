import{s as u,t as f,a as b,h as w,b as g}from"./xhrStatus.js";document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("[data-media-manager]").forEach(r=>{const e=r.querySelector(".media-manager-row");r.addEventListener("click",async function(o){console.log("bla bla");const t=m(r);if(!t)return;const a=o.target.closest("[data-action]");if(!a)return;o.preventDefault();const n=a.getAttribute("data-action");console.log("action",n);const s=a.closest("[data-xhr-form]"),d=(s==null?void 0:s.getAttribute("data-xhr-method"))??"post",l=y(n,a,t);if(!l){u(e,{type:"error",message:f("invalid_action")});return}b(e);try{const c=v(s),_=d.toUpperCase();["DELETE","PUT","PATCH"].includes(_)&&c.append("_method",_);const i=await fetch(l,{method:"POST",headers:{"X-CSRF-TOKEN":t.csrf_token,Accept:"application/json"},body:c}),h=await i.json();if(!i.ok){w(i,h,e);return}u(e,h),p(r,t),E(s)}catch(c){console.error("Error during upload:",c),u(e,{type:"error",message:f("upload_failed")})}finally{g(e)}}),r.addEventListener("refreshRequest",function(o){const t=m(r);console.log("Refresh requested:",o),p(r,t)})});function m(r){const e=r.querySelector(".media-manager-config");if(!e)return null;try{return JSON.parse(e.value)}catch(o){return console.error(`Invalid JSON config for ${r.id}:`,o),null}}function y(r,e,o){var n,s,d,l;const t=e.closest(".media-manager-preview-media-container");return{"upload-media":o.media_upload_route,"upload-youtube-medium":o.youtube_upload_route,"temporary-upload-destroy":(n=t==null?void 0:t.dataset)==null?void 0:n.temporaryUploadDestroyRoute,"destroy-medium":(s=t==null?void 0:t.dataset)==null?void 0:s.destroyRoute,"set-as-first":(d=t==null?void 0:t.dataset)==null?void 0:d.setAsFirstRoute,"temporary-upload-set-as-first":(l=t==null?void 0:t.dataset)==null?void 0:l.temporaryUploadSetAsFirstRoute}[r]||null}function p(r,e){const o=r.querySelector(".media-manager-preview-grid");if(!o)return;const t=new URLSearchParams({model_type:e.model_type,model_id:e.model_id,image_collection:e.image_collection,youtube_collection:e.youtube_collection,document_collection:e.document_collection,video_collection:e.video_collection,audio_collection:e.audio_collection,initiator_id:e.id,frontend_theme:e.frontend_theme,destroy_enabled:e.destroy_enabled,set_as_first_enabled:e.set_as_first_enabled,show_media_url:e.show_media_url,show_order:e.show_order,temporary_uploads:e.temporary_upload});fetch(`${e.preview_update_route}?${t}`,{headers:{Accept:"application/json"}}).then(a=>a.json()).then(a=>{o.innerHTML=a.html,o.querySelectorAll("[data-image-editor-modal]").forEach(n=>{console.log("dispatch initializeImageEditorModal"),document.dispatchEvent(new CustomEvent("initializeImageEditorModal",{bubbles:!1,detail:{modal:n}}))})}).catch(a=>{console.error("Error refreshing media manager:",a)})}function v(r){const e=new FormData;return r.querySelectorAll("input").forEach(o=>{console.log("input",o),o.type==="file"?Array.from(o.files).forEach(t=>{e.append(o.name,t)}):e.append(o.name,o.value)}),e}function E(r){r.querySelectorAll("input").forEach(e=>{e.type!=="hidden"&&(e.value="")})}});
