document.addEventListener("DOMContentLoaded",function(){const b=document.querySelectorAll("[data-ajax-upload-form]");console.log(b),b.forEach(t=>{const o=t.getAttribute("data-media-manager-id"),e=document.getElementById(o),i=e.getAttribute("data-media-upload-route"),s=e.getAttribute("data-preview-refresh-route");e.querySelector(".media-manager-previews");const r=t.querySelector("button"),l=e.querySelector(".media-manager-upload-form"),C=e.getAttribute("data-csrf-token"),f=e.getAttribute("data-theme"),v=e.getAttribute("data-model-type"),A=e.getAttribute("data-model-id"),S=e.getAttribute("data-collection"),p=e.getAttribute("data-youtube-collection"),h=e.getAttribute("data-document-collection");console.log(v,A,S,p,h),r.addEventListener("click",function(d){d.preventDefault();const y=d.target.closest("button");console.log(y);const c=r.getAttribute("data-action");L(t);const u=new FormData;t.querySelectorAll("input").forEach(a=>{a.type==="file"?[...a.files].forEach(n=>{u.append(a.name,n)}):u.append(a.name,a.value)}),console.log("formData",u);const w={"upload-media":i,"destroy-medium":r.getAttribute("data-destroy-route")||"","set-as-first":r.getAttribute("data-set-as-first-route")||""}[c]||"";if(w){debugger;fetch(w,{method:"POST",headers:{"X-CSRF-TOKEN":C,Accept:"application/json"},body:u}).then(async a=>{const n=await a.json();if(a.ok){g(l,n,f);const m=document.getElementById(t.dataset.target+"-flash");m&&n.message&&(m.innerHTML=`<div class="alert alert-${n.type}">${n.message}</div>`),M()}else{console.log("response not ok");const m=(n==null?void 0:n.message)||"Upload failed";g(l,{message:m,type:"error"},f)}}).catch(a=>{console.error("Error during upload:",a)}).finally(()=>{q(t)})}else g(l,{type:"error",message:"invalid action"},f)});function M(){console.log("refresh");const d=e.querySelector(".media-manager-preview-grid");if(!d)return;console.log("youtube_collection",p),console.log("document_collection",h);const y=new URLSearchParams({model_type:v,model_id:A,collection:S,youtube_collection:p,document_collection:h,target_id:o});console.log("previewRefreshRoute",s),fetch(`${s}?${y}`,{headers:{Accept:"text/html"}}).then(c=>c.text()).then(c=>{d.innerHTML=c}).catch(c=>{console.error("Error refreshing media manager:",c)}).finally(()=>{console.log("refresh finally preview refresh")})}});function L(t){const o=t.querySelector("div[data-spinner-container]");o&&o.classList.add("active")}function q(t){const o=t.querySelector("div[data-spinner-container]");o&&o.classList.remove("active")}const g=(t,o,e)=>{console.log("showStatusMessage",o.message);const i=t.querySelector("div[data-status-message]");i==null||i.remove();const s=document.createElement("div");s.setAttribute("data-status-message",""),s.classList.add("mle-status-message"),s.classList.add(`mle-status-message-${o.type}`);let r="";e==="bootstrap-5"&&(r+="alert w-100 ",r+=o.type==="success"?"alert-success":"alert-danger"),r&&r.split(" ").forEach(l=>s.classList.add(l)),s.textContent=o.message,t.prepend(s)}});
