import{s as d,t as g,x as b,h as A,a as S}from"./xhrStatus.js";import{u as x}from"./media-manager-lab-previews-refresher.js";import{g as D}from"./form.js";import{g as q}from"./media-manager-config.js";const T=document.querySelectorAll("[data-mle-media-manager-lab]");T.forEach(s=>{const e=s.querySelector("[data-mle-status-area-container]");s.addEventListener("click",async function(i){const n=q(s);if(!n||!n.useXhr)return;const o=i.target.closest("[data-mle-action]"),c=o==null?void 0:o.getAttribute("data-mle-action");if(!c)return;console.log("action",c),i.preventDefault();const p=o.dataset.mleMediumId;if(!o)return;const a=o.closest("[data-mle-xhr-form]"),h=(a==null?void 0:a.getAttribute("data-xhr-method"))??"post",m=C(c,o);if(c==="debugger-toggle"){const r=n.id,t=document.querySelector("#"+r).querySelector("[data-mle-debug]");console.log("mleDebug",t),t.parentNode.style.outline="10px solid hotpink",t.classList.toggle("hidden"),t.classList.toggle("mle-hidden");return}if(!m){d(e,{type:"error",message:g("invalid_action")});return}b(e);try{console.log(a);const r=D(a);console.log("just before formData"),r.forEach((y,E)=>{console.log(E,y)});const u=h.toUpperCase();["DELETE","PUT","PATCH"].includes(u)&&r.append("_method",u);const t=await fetch(m,{method:"POST",headers:{"X-CSRF-TOKEN":n.csrfToken,Accept:"application/json"},body:r,cache:"no-store"}),f=await t.json();if(!t.ok){A(t,f,e);return}x(s,n,p,{part:"base"}),d(e,f)}catch(r){console.error("Error during upload:",r),d(e,{type:"error",message:g("upload_failed")})}finally{S(e)}})});function C(s,e,i){var l;return{"medium-restore":(l=e==null?void 0:e.dataset)==null?void 0:l.mleRoute}[s]||null}
